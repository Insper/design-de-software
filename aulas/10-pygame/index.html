


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <link rel="canonical" href="https://insper.github.io/design-de-software/aulas/10-pygame/">
      
      
        <meta name="author" content="Andrew Kurauchi, Lucianos Soares">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.5.2">
    
    
      
        <title>10 - PyGame - Design de Software - Insper 2020/2</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.25b81cc6.min.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/palette.80a78273.min.css">
      
      
        
        
        <meta name="theme-color" content="#3f51b5">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../../css/printing.css">
    
      <link rel="stylesheet" href="../../css/dessoft.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="indigo" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#10-pygame" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      











<!--
  Copyright (c) 2016-2020 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Application header -->

<script>
  window.site_url = "https://insper.github.io/design-de-software/";
</script>

<div class="md-printing-header">
  <img class="cabecalho" src="https://insper.github.io/design-de-software/css/cabecalho.png">
  <img class="logo" src="https://insper.github.io/design-de-software/css/logo.png">

  <div class="frontmatter">
    <div class="materia"> Design de Software </div>
    <div class="professor"> Andrew Kurauchi, Luciano Soares </div>
    <div class="semestre"> 2020/2 </div>
  </div>
</div>

<header class="md-header" data-md-component="header">

  <!-- Top-level navigation -->
  <nav class="md-header-nav md-grid" aria-label="Header">

    <!-- Link to home -->
    <a
      href="https://insper.github.io/design-de-software/"
      title="Design de Software - Insper 2020/2"
      class="md-header-nav__button md-logo"
      aria-label="Design de Software - Insper 2020/2"
    >
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>

    <!-- Button to open drawer -->
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>

    <!-- Header title -->
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Design de Software - Insper 2020/2
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              10 - PyGame
            
          </span>
        </div>
      
    </div>

    <!-- Button to open search dialogue -->
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>

      <!-- Search interface -->
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    

    <!-- Repository containing source -->
    
  </nav>
</header>




    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://insper.github.io/design-de-software/" title="Design de Software - Insper 2020/2" class="md-nav__button md-logo" aria-label="Design de Software - Insper 2020/2">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Design de Software - Insper 2020/2
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Turmas
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Turmas" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Turmas
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../turma-a/" title="Turma A" class="md-nav__link">
      Turma A
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../turma-b/" title="Turma B" class="md-nav__link">
      Turma B
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../turma-c/" title="Turma C" class="md-nav__link">
      Turma C
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Aulas
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Aulas" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Aulas
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../01-funcoes/" title="01 - Introdução ao Python, Variáveis, Operações Matemáticas e Funções" class="md-nav__link">
      01 - Introdução ao Python, Variáveis, Operações Matemáticas e Funções
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../02-io/" title="02 - Input e String" class="md-nav__link">
      02 - Input e String
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../03-if/" title="03 - Desvios Condicionais (if)" class="md-nav__link">
      03 - Desvios Condicionais (if)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../04-while/" title="04 - Laços de Repetição (while)" class="md-nav__link">
      04 - Laços de Repetição (while)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../05-listas/" title="05 - Listas" class="md-nav__link">
      05 - Listas
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../06-for/" title="06 - For" class="md-nav__link">
      06 - For
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../07-dicionarios/" title="07 - Dicionários" class="md-nav__link">
      07 - Dicionários
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../08-strings/" title="08 - Strings e Fatiamento" class="md-nav__link">
      08 - Strings e Fatiamento
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../09-arquivos/" title="09 - Arquivos" class="md-nav__link">
      09 - Arquivos
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        10 - PyGame
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg>
        </span>
      </label>
    
    <a href="./" title="10 - PyGame" class="md-nav__link md-nav__link--active">
      10 - PyGame
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#estrutura-basica-de-um-jogo" class="md-nav__link">
    Estrutura básica de um jogo
  </a>
  
    <nav class="md-nav" aria-label="Estrutura básica de um jogo">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inicializacao" class="md-nav__link">
    Inicialização
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loop-principal" class="md-nav__link">
    Loop principal
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#finalizacao" class="md-nav__link">
    Finalização
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#instalacao" class="md-nav__link">
    Instalação
  </a>
  
    <nav class="md-nav" aria-label="Instalação">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#windows-e-linux" class="md-nav__link">
    Windows e Linux
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mac-osx" class="md-nav__link">
    Mac OSX
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preparo-para-o-tutorial" class="md-nav__link">
    Preparo para o tutorial
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#criando-uma-janela" class="md-nav__link">
    Criando uma janela
  </a>
  
    <nav class="md-nav" aria-label="Criando uma janela">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercicio-1" class="md-nav__link">
    EXERCÍCIO 1
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#desenhando-na-tela" class="md-nav__link">
    Desenhando na tela
  </a>
  
    <nav class="md-nav" aria-label="Desenhando na tela">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercicio-2" class="md-nav__link">
    EXERCÍCIO 2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#desenhando-um-texto" class="md-nav__link">
    Desenhando um texto
  </a>
  
    <nav class="md-nav" aria-label="Desenhando um texto">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercicio-3" class="md-nav__link">
    EXERCÍCIO 3
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#desenhando-uma-imagem" class="md-nav__link">
    Desenhando uma imagem
  </a>
  
    <nav class="md-nav" aria-label="Desenhando uma imagem">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercicio-4" class="md-nav__link">
    EXERCÍCIO 4
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recriando-o-asteroids" class="md-nav__link">
    Recriando o Asteroids
  </a>
  
    <nav class="md-nav" aria-label="Recriando o Asteroids">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercicio-5" class="md-nav__link">
    EXERCÍCIO 5
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#controlando-a-velocidade-do-jogo" class="md-nav__link">
    Controlando a velocidade do jogo
  </a>
  
    <nav class="md-nav" aria-label="Controlando a velocidade do jogo">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercicio-6" class="md-nav__link">
    EXERCÍCIO 6
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adicionando-mais-meteoros" class="md-nav__link">
    Adicionando mais meteoros
  </a>
  
    <nav class="md-nav" aria-label="Adicionando mais meteoros">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#classes-em-python" class="md-nav__link">
    Classes em Python
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#classes-no-pygame" class="md-nav__link">
    Classes no pygame
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exercicio-7" class="md-nav__link">
    EXERCÍCIO 7
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adicionando-mais-meteoros-ainda" class="md-nav__link">
    Adicionando mais meteoros ainda
  </a>
  
    <nav class="md-nav" aria-label="Adicionando mais meteoros ainda">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercicio-8" class="md-nav__link">
    EXERCÍCIO 8
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adicionando-a-nave" class="md-nav__link">
    Adicionando a nave
  </a>
  
    <nav class="md-nav" aria-label="Adicionando a nave">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercicio-9" class="md-nav__link">
    EXERCÍCIO 9
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#movimento-da-nave" class="md-nav__link">
    Movimento da nave
  </a>
  
    <nav class="md-nav" aria-label="Movimento da nave">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercicio-10" class="md-nav__link">
    EXERCÍCIO 10
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tratamento-de-colisoes-da-nave-com-os-meteoros" class="md-nav__link">
    Tratamento de colisões da nave com os meteoros
  </a>
  
    <nav class="md-nav" aria-label="Tratamento de colisões da nave com os meteoros">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercicio-11" class="md-nav__link">
    EXERCÍCIO 11
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fazendo-a-nave-atirar" class="md-nav__link">
    Fazendo a nave atirar
  </a>
  
    <nav class="md-nav" aria-label="Fazendo a nave atirar">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercicio-12" class="md-nav__link">
    EXERCÍCIO 12
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adicionando-som" class="md-nav__link">
    Adicionando som
  </a>
  
    <nav class="md-nav" aria-label="Adicionando som">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercicio-13" class="md-nav__link">
    EXERCÍCIO 13
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#refatorando-mais-uma-vez-o-codigo" class="md-nav__link">
    Refatorando mais uma vez o código
  </a>
  
    <nav class="md-nav" aria-label="Refatorando mais uma vez o código">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercicio-14" class="md-nav__link">
    EXERCÍCIO 14
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adicionando-animacoes" class="md-nav__link">
    Adicionando animações
  </a>
  
    <nav class="md-nav" aria-label="Adicionando animações">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercicio-15" class="md-nav__link">
    EXERCÍCIO 15
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adicionando-estados" class="md-nav__link">
    Adicionando estados
  </a>
  
    <nav class="md-nav" aria-label="Adicionando estados">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercicio-16" class="md-nav__link">
    EXERCÍCIO 16
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adicionando-um-placar" class="md-nav__link">
    Adicionando um placar
  </a>
  
    <nav class="md-nav" aria-label="Adicionando um placar">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercicio-17" class="md-nav__link">
    EXERCÍCIO 17
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sistema-de-vidas" class="md-nav__link">
    Sistema de vidas
  </a>
  
    <nav class="md-nav" aria-label="Sistema de vidas">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercicio-18" class="md-nav__link">
    EXERCÍCIO 18
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#melhorando-a-colisao" class="md-nav__link">
    Melhorando a colisão
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#separando-o-codigo-em-mais-funcoes" class="md-nav__link">
    Separando o código em mais funções
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#separando-o-codigo-em-arquivos-diferentes" class="md-nav__link">
    Separando o código em arquivos diferentes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adicionando-uma-tela-inicial" class="md-nav__link">
    Adicionando uma tela inicial
  </a>
  
    <nav class="md-nav" aria-label="Adicionando uma tela inicial">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercicio-19" class="md-nav__link">
    EXERCÍCIO 19
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Tutoriais
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Tutoriais" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Tutoriais
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4-1" type="checkbox" id="nav-4-1">
    
    <label class="md-nav__link" for="nav-4-1">
      Navegando pelo terminal
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Navegando pelo terminal" data-md-level="2">
      <label class="md-nav__title" for="nav-4-1">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Navegando pelo terminal
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutoriais/terminal-win/" title="Windows" class="md-nav__link">
      Windows
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutoriais/terminal-macos/" title="macOS" class="md-nav__link">
      macOS
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Dicas
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Dicas" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Dicas
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../dicas/buscando-ajuda/" title="Buscando Ajuda" class="md-nav__link">
      Buscando Ajuda
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#estrutura-basica-de-um-jogo" class="md-nav__link">
    Estrutura básica de um jogo
  </a>
  
    <nav class="md-nav" aria-label="Estrutura básica de um jogo">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inicializacao" class="md-nav__link">
    Inicialização
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loop-principal" class="md-nav__link">
    Loop principal
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#finalizacao" class="md-nav__link">
    Finalização
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#instalacao" class="md-nav__link">
    Instalação
  </a>
  
    <nav class="md-nav" aria-label="Instalação">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#windows-e-linux" class="md-nav__link">
    Windows e Linux
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mac-osx" class="md-nav__link">
    Mac OSX
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preparo-para-o-tutorial" class="md-nav__link">
    Preparo para o tutorial
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#criando-uma-janela" class="md-nav__link">
    Criando uma janela
  </a>
  
    <nav class="md-nav" aria-label="Criando uma janela">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercicio-1" class="md-nav__link">
    EXERCÍCIO 1
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#desenhando-na-tela" class="md-nav__link">
    Desenhando na tela
  </a>
  
    <nav class="md-nav" aria-label="Desenhando na tela">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercicio-2" class="md-nav__link">
    EXERCÍCIO 2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#desenhando-um-texto" class="md-nav__link">
    Desenhando um texto
  </a>
  
    <nav class="md-nav" aria-label="Desenhando um texto">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercicio-3" class="md-nav__link">
    EXERCÍCIO 3
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#desenhando-uma-imagem" class="md-nav__link">
    Desenhando uma imagem
  </a>
  
    <nav class="md-nav" aria-label="Desenhando uma imagem">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercicio-4" class="md-nav__link">
    EXERCÍCIO 4
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recriando-o-asteroids" class="md-nav__link">
    Recriando o Asteroids
  </a>
  
    <nav class="md-nav" aria-label="Recriando o Asteroids">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercicio-5" class="md-nav__link">
    EXERCÍCIO 5
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#controlando-a-velocidade-do-jogo" class="md-nav__link">
    Controlando a velocidade do jogo
  </a>
  
    <nav class="md-nav" aria-label="Controlando a velocidade do jogo">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercicio-6" class="md-nav__link">
    EXERCÍCIO 6
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adicionando-mais-meteoros" class="md-nav__link">
    Adicionando mais meteoros
  </a>
  
    <nav class="md-nav" aria-label="Adicionando mais meteoros">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#classes-em-python" class="md-nav__link">
    Classes em Python
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#classes-no-pygame" class="md-nav__link">
    Classes no pygame
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exercicio-7" class="md-nav__link">
    EXERCÍCIO 7
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adicionando-mais-meteoros-ainda" class="md-nav__link">
    Adicionando mais meteoros ainda
  </a>
  
    <nav class="md-nav" aria-label="Adicionando mais meteoros ainda">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercicio-8" class="md-nav__link">
    EXERCÍCIO 8
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adicionando-a-nave" class="md-nav__link">
    Adicionando a nave
  </a>
  
    <nav class="md-nav" aria-label="Adicionando a nave">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercicio-9" class="md-nav__link">
    EXERCÍCIO 9
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#movimento-da-nave" class="md-nav__link">
    Movimento da nave
  </a>
  
    <nav class="md-nav" aria-label="Movimento da nave">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercicio-10" class="md-nav__link">
    EXERCÍCIO 10
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tratamento-de-colisoes-da-nave-com-os-meteoros" class="md-nav__link">
    Tratamento de colisões da nave com os meteoros
  </a>
  
    <nav class="md-nav" aria-label="Tratamento de colisões da nave com os meteoros">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercicio-11" class="md-nav__link">
    EXERCÍCIO 11
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fazendo-a-nave-atirar" class="md-nav__link">
    Fazendo a nave atirar
  </a>
  
    <nav class="md-nav" aria-label="Fazendo a nave atirar">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercicio-12" class="md-nav__link">
    EXERCÍCIO 12
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adicionando-som" class="md-nav__link">
    Adicionando som
  </a>
  
    <nav class="md-nav" aria-label="Adicionando som">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercicio-13" class="md-nav__link">
    EXERCÍCIO 13
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#refatorando-mais-uma-vez-o-codigo" class="md-nav__link">
    Refatorando mais uma vez o código
  </a>
  
    <nav class="md-nav" aria-label="Refatorando mais uma vez o código">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercicio-14" class="md-nav__link">
    EXERCÍCIO 14
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adicionando-animacoes" class="md-nav__link">
    Adicionando animações
  </a>
  
    <nav class="md-nav" aria-label="Adicionando animações">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercicio-15" class="md-nav__link">
    EXERCÍCIO 15
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adicionando-estados" class="md-nav__link">
    Adicionando estados
  </a>
  
    <nav class="md-nav" aria-label="Adicionando estados">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercicio-16" class="md-nav__link">
    EXERCÍCIO 16
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adicionando-um-placar" class="md-nav__link">
    Adicionando um placar
  </a>
  
    <nav class="md-nav" aria-label="Adicionando um placar">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercicio-17" class="md-nav__link">
    EXERCÍCIO 17
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sistema-de-vidas" class="md-nav__link">
    Sistema de vidas
  </a>
  
    <nav class="md-nav" aria-label="Sistema de vidas">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercicio-18" class="md-nav__link">
    EXERCÍCIO 18
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#melhorando-a-colisao" class="md-nav__link">
    Melhorando a colisão
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#separando-o-codigo-em-mais-funcoes" class="md-nav__link">
    Separando o código em mais funções
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#separando-o-codigo-em-arquivos-diferentes" class="md-nav__link">
    Separando o código em arquivos diferentes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adicionando-uma-tela-inicial" class="md-nav__link">
    Adicionando uma tela inicial
  </a>
  
    <nav class="md-nav" aria-label="Adicionando uma tela inicial">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercicio-19" class="md-nav__link">
    EXERCÍCIO 19
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                <h1 id="10-pygame">10 - PyGame<a class="headerlink" href="#10-pygame" title="Permanent link">&para;</a></h1>
<p>Neste handout vamos começar a nos preparar para desenvolver o projeto final de Design de Software. Para isso vamos apresentar uma biblioteca de desenvolvimento de jogos em Python chamada pygame. Ao final deste handout você terá implementado um jogo simples baseado no Asteroids usando pygame.</p>
<h2 id="estrutura-basica-de-um-jogo">Estrutura básica de um jogo<a class="headerlink" href="#estrutura-basica-de-um-jogo" title="Permanent link">&para;</a></h2>
<p>Vamos começar entendendo a estrutura de um jogo qualquer. Note que este conhecimento independe da biblioteca ou linguagem de programação utilizada. Essa estrutura pode ser resumida da seguinte maneira:</p>
<p><img alt="" class="center" src="estrutura.png" width="50%" /></p>
<p>Nas seções a seguir explicamos o que o programa faz em cada um desses blocos.</p>
<h3 id="inicializacao">Inicialização<a class="headerlink" href="#inicializacao" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Importa e inicia pacotes:</strong> por exemplo, realiza os <code class="highlight"><span class="n">imports</span></code> no Python;</li>
<li><strong>Inicia estruturas de dados:</strong> por exemplo, inicia listas, dicionários, variáveis, etc. com seus valores padrão;</li>
<li><strong>Inicia assets:</strong> exemplos de <em>assets</em> são imagens, sons, sprites, modelos 3D, etc. que são utilizados pelo jogo;</li>
<li><strong>Gera tela principal:</strong> criar a janela onde o jogo será apresentado;</li>
<li><strong>Dispara loop principal:</strong> depois que toda a inicialização está concluída o jogo propriamente dito se inicia.</li>
</ul>
<h3 id="loop-principal">Loop principal<a class="headerlink" href="#loop-principal" title="Permanent link">&para;</a></h3>
<p>O jogo e toda a interação acontece durante esta fase. O loop principal, também chamado de <em>game loop</em>, se repete enquanto o jogo estiver rodando. Em geral, ao final de uma iteração do loop principal será gerado um novo frame para ser apresentado para o usuário.</p>
<ul>
<li><strong>Trata eventos:</strong> por exemplo, movimentos/cliques de mouse, input de teclado, timer, clique do usuário no X para fechar a janela, etc.</li>
<li><strong>Verifica consequências:</strong> verifica se houve colisões, aplica as ações do usuário (por exemplo, muda a direção do personagem se o jogador apertou uma tecla), etc. de acordo com as regras e mecânica do jogo;</li>
<li><strong>Atualiza estado do jogo:</strong> move os objetos na tela, atualiza os estados dos <em>assets</em> (por exemplo, muda a animação) e as estruturas de dados utilizadas (por exemplo, atualiza a lista de personagens vivos);</li>
<li><strong>Gera saídas:</strong> exibe as mudanças para o jogador (gera uma nova imagem/frame, toca um som, etc.).</li>
</ul>
<h3 id="finalizacao">Finalização<a class="headerlink" href="#finalizacao" title="Permanent link">&para;</a></h3>
<p>Na finalização pode ser realizado o fechamento de arquivos, salvar o placar do jogo, fechar a janela do jogo, etc.</p>
<p><img alt="" class="center" src="pygame-logo.png" width="30%" /></p>
<p>O <a href="https://www.pygame.org/docs/">pygame</a> é um <em>framework</em> (ou <em>game engine</em>) para desenvolvimento de jogos em Python, baseado na biblioteca SDL2 (Simple DirectMedia Layer).</p>
<h2 id="instalacao">Instalação<a class="headerlink" href="#instalacao" title="Permanent link">&para;</a></h2>
<h3 id="windows-e-linux">Windows e Linux<a class="headerlink" href="#windows-e-linux" title="Permanent link">&para;</a></h3>
<p>Abra o seu terminal (Linux) ou Anaconda Prompt (Windows) e digite:</p>
<div class="codehilite"><pre><span></span><code>pip install pygame
</code></pre></div>


<h3 id="mac-osx">Mac OSX<a class="headerlink" href="#mac-osx" title="Permanent link">&para;</a></h3>
<p>A instalação no Mac é um pouco mais complicada, infelizmente. Se você não tiver o Homebrew instalado, instale-o seguindo as instruções disponíveis neste link (se você não sabe se tem o Homebrew instalado, provavelmente não tem): <a href="https://brew.sh/">https://brew.sh/</a></p>
<p>Abra o terminal e digite:</p>
<div class="codehilite"><pre><span></span><code>brew install sdl2 sdl2_gfx sdl2_image sdl2_mixer sdl2_net sdl2_ttf
brew install Caskroom/cask/xquartz
git clone -b 1.9.6 --single-branch https://github.com/pygame/pygame.git
cd pygame
python setup.py -config -auto -sdl2
python setup.py install
cd ..
rm -rf pygame
</code></pre></div>


<p>Para mais detalhes e outras opções de instalação no Mac, consulte a documentação: <a href="https://www.pygame.org/wiki/MacCompile">https://www.pygame.org/wiki/MacCompile</a></p>
<h2 id="preparo-para-o-tutorial">Preparo para o tutorial<a class="headerlink" href="#preparo-para-o-tutorial" title="Permanent link">&para;</a></h2>
<p>Antes de seguir com o tutorial de pygame, faça o download do arquivo <a href="referencia.zip"><code>referencia.zip</code> (disponível neste link)</a>. Descompacte os arquivos em uma pasta, sem alterar a estrutura de pastas.</p>
<div class="admonition warning">
<p class="admonition-title">Importante</p>
<p>Consulte a <a href="https://www.pygame.org/docs">documentação</a> se não entender algum dos comandos.</p>
</div>
<h2 id="criando-uma-janela">Criando uma janela<a class="headerlink" href="#criando-uma-janela" title="Permanent link">&para;</a></h2>
<p>Veremos que será necessário utilizarmos muitos comandos para fazer coisas aparentemente simples, como mostrar uma janela em branco. Não se assuste. Muito desse código se repete de maneira muito semelhante em qualquer jogo que você for desenvolver. Vamos começar então com o exemplo que acabamos de comentar: como mostrar uma janela do pygame. Abra o arquivo <code class="highlight"><span class="n">referencia</span><span class="o">/</span><span class="n">jogo_v1</span><span class="o">.</span><span class="n">py</span></code>. Esse arquivo contém comentários que separam o código nos blocos descritos no início deste handout. Vamos entender o que esses comandos fazem:</p>
<details class="cite"><summary><code>referencia/jogo_v1.py</code></summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># ===== Inicialização =====</span>
<span class="c1"># ----- Importa e inicia pacotes</span>
<span class="kn">import</span> <span class="nn">pygame</span>

<span class="n">pygame</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>

<span class="c1"># ----- Gera tela principal</span>
<span class="n">window</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_mode</span><span class="p">((</span><span class="mi">500</span><span class="p">,</span> <span class="mi">400</span><span class="p">))</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s1">&#39;Hello World!&#39;</span><span class="p">)</span>

<span class="c1"># ----- Inicia estruturas de dados</span>
<span class="n">game</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># ===== Loop principal =====</span>
<span class="k">while</span> <span class="n">game</span><span class="p">:</span>
    <span class="c1"># ----- Trata eventos</span>
    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">pygame</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
        <span class="c1"># ----- Verifica consequências</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">QUIT</span><span class="p">:</span>
            <span class="n">game</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># ----- Gera saídas</span>
    <span class="n">window</span><span class="o">.</span><span class="n">fill</span><span class="p">((</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">))</span>  <span class="c1"># Preenche com a cor branca</span>

    <span class="c1"># ----- Atualiza estado do jogo</span>
    <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>  <span class="c1"># Mostra o novo frame para o jogador</span>

<span class="c1"># ===== Finalização =====</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>  <span class="c1"># Função do PyGame que finaliza os recursos utilizados</span>
</code></pre></div>
</td></tr></table>

</details>
<ul>
<li><code class="highlight"><span class="n">pygame</span><span class="o">.</span><span class="n">init</span><span class="p">()</span></code> (linha 5): o framework pygame é iniciado. Apenas após este comando é que os recursos do pacote podem ser utilizados;</li>
<li><code class="highlight"><span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_mode</span><span class="p">((</span><span class="mi">500</span><span class="p">,</span> <span class="mi">400</span><span class="p">))</span></code> (linha 8): cria uma janela com 500 pixels de largura e 400 pixels de altura;</li>
<li><code class="highlight"><span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s1">&#39;Hello World!&#39;</span><span class="p">)</span></code> (linha 9): define o título da janela (que aparece na barra superior) como o texto <code class="highlight"><span class="s1">&#39;Hello World!&#39;</span></code>;</li>
<li><code class="highlight"><span class="n">game</span> <span class="o">=</span> <span class="kc">True</span></code> (linha 12): a variável <code class="highlight"><span class="n">game</span></code> será utilizada para indicar que o jogo deve continuar;</li>
<li><code class="highlight"><span class="k">while</span> <span class="n">game</span><span class="p">:</span></code> (linha 15): continua o jogo enquanto <code class="highlight"><span class="n">game</span></code> for <code class="highlight"><span class="kc">True</span></code>;</li>
<li><code class="highlight"><span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">pygame</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">():</span></code> (linha 17): <code class="highlight"><span class="n">pygame</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></code> devolve uma lista com todos os eventos (cliques/movimentos de mouse, teclas apertadas, botões da janela apertados, etc.) que ocorreram desde a última vez que essa função foi chamada. O <code class="highlight"><span class="k">for</span></code> percorre cada um desses eventos, aplicando as consequências necessárias a cada caso;</li>
<li><code class="highlight"><span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">QUIT</span><span class="p">:</span></code> (linha 19): verifica se o tipo do evento é <code class="highlight"><span class="n">pygame</span><span class="o">.</span><span class="n">QUIT</span></code>, ou seja, se o usuário clicou no botão de fechar a janela (consulte a <a href="https://www.pygame.org/docs/ref/event.html#pygame.event.EventType">documentação</a> para ver mais eventos possíveis);</li>
<li><code class="highlight"><span class="n">game</span> <span class="o">=</span> <span class="kc">False</span></code> (linha 20): muda o valor para <code class="highlight"><span class="kc">False</span></code> para que a próxima iteração do loop principal não seja mais executada. Depois disso o programa termina;</li>
<li><code class="highlight"><span class="n">window</span><span class="o">.</span><span class="n">fill</span><span class="p">((</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">))</span></code> (linha 23): preenche a janela com a cor branca. As cores são valores RGB (Red, Green, Blue) que variam entre 0 e 255. Note que existe um parênteses ao redor dos três valores. Esse parênteses é muito importante, pois define uma <em>tupla</em> (uma sequência de valores, semelhante a uma lista);</li>
<li><code class="highlight"><span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">update</span><span class="p">()</span></code> (linha 26): tudo o que é feito na tela (<code class="highlight"><span class="n">window</span></code>) não é mostrado para o usuário imediatamente, assim é possível desenhar várias coisas e somente depois de terminar de desenhar mostramos a nova tela (ou frame) para o usuário. Essa função é responsável por mostrar a nova tela que foi desenhada;</li>
<li><code class="highlight"><span class="n">pygame</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span></code> (linha 29): finaliza o pygame. É importante chamar essa função para que ele feche todos os recursos que abriu (por exemplo a janela).</li>
</ul>
<div class="admonition example">
<h3 id="exercicio-1">EXERCÍCIO 1<a class="headerlink" href="#exercicio-1" title="Permanent link">&para;</a></h3>
<p>Aplique as seguintes modificações ao código do <code class="highlight"><span class="n">jogo_v1</span><span class="o">.</span><span class="n">py</span></code>:</p>
<ol>
<li>Utilize uma janela de 600 X 300 pixels;</li>
<li>Mude o título para <code class="highlight"><span class="n">Jogo</span> <span class="n">da</span><span class="o">/</span><span class="n">do</span> <span class="n">NOME</span></code> (onde <code class="highlight"><span class="n">NOME</span></code> é o seu nome);</li>
<li>Mude a cor da janela para azul ao invés de branco;</li>
<li>Faça o jogo fechar assim que o usuário apertar qualquer tecla do teclado. Dica: procure pelo evento <code class="highlight"><span class="n">pygame</span><span class="o">.</span><span class="n">KEYUP</span></code>.</li>
</ol>
</div>
<h2 id="desenhando-na-tela">Desenhando na tela<a class="headerlink" href="#desenhando-na-tela" title="Permanent link">&para;</a></h2>
<p>Vamos começar desenhando polígono na tela. Para isso precisamos entender o sistema de coordenadas da tela do pygame (imagem extraída de: <a href="https://medium.com/iothincvit/pygame-for-beginners-234da7d3c56f">https://medium.com/iothincvit/pygame-for-beginners-234da7d3c56f</a>):</p>
<p><img alt="" class="center" src="coordenadas.png" /></p>
<p>No pygame, o canto superior esquerdo da janela é a origem (ponto <code class="highlight"><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></code>). O eixo X aumenta <strong>para a direita</strong> e o eixo Y aumenta <strong>para baixo</strong>. Assim, se queremos mostrar uma informação "mais para baixo", devemos <strong>aumentar</strong> o valor de Y.</p>
<p>Abra o arquivo <code class="highlight"><span class="n">jogo_v2</span><span class="o">.</span><span class="n">py</span></code>. A única diferença para a versão 1 são as linhas 24 a 26. Nas linhas 24 e 25 nós definimos uma cor (vermelha) e os vértices de um polígono. Na linha 26 chamamos a função <code class="highlight"><span class="n">pygame</span><span class="o">.</span><span class="n">draw</span><span class="o">.</span><span class="n">polygon</span></code>, que recebe uma superfície na qual o polígono será desenhado (no nosso caso, a janela), a cor e os vértices do polígono.</p>
<details class="cite"><summary><code>referencia/jogo_v2.py</code></summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># ===== Inicialização =====</span>
<span class="c1"># ----- Importa e inicia pacotes</span>
<span class="kn">import</span> <span class="nn">pygame</span>

<span class="n">pygame</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>

<span class="c1"># ----- Gera tela principal</span>
<span class="n">window</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_mode</span><span class="p">((</span><span class="mi">500</span><span class="p">,</span> <span class="mi">400</span><span class="p">))</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s1">&#39;Hello World!&#39;</span><span class="p">)</span>

<span class="c1"># ----- Inicia estruturas de dados</span>
<span class="n">game</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># ===== Loop principal =====</span>
<span class="k">while</span> <span class="n">game</span><span class="p">:</span>
    <span class="c1"># ----- Trata eventos</span>
    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">pygame</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
        <span class="c1"># ----- Verifica consequências</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">QUIT</span><span class="p">:</span>
            <span class="n">game</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># ----- Gera saídas</span>
    <span class="n">window</span><span class="o">.</span><span class="n">fill</span><span class="p">((</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">))</span>  <span class="c1"># Preenche com a cor branca</span>
    <span class="n">cor</span> <span class="o">=</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">vertices</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">250</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span> <span class="p">(</span><span class="mi">250</span><span class="p">,</span> <span class="mi">400</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">)]</span>
    <span class="n">pygame</span><span class="o">.</span><span class="n">draw</span><span class="o">.</span><span class="n">polygon</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">cor</span><span class="p">,</span> <span class="n">vertices</span><span class="p">)</span>

    <span class="c1"># ----- Atualiza estado do jogo</span>
    <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>  <span class="c1"># Mostra o novo frame para o jogador</span>

<span class="c1"># ===== Finalização =====</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>  <span class="c1"># Função do PyGame que finaliza os recursos utilizados</span>
</code></pre></div>
</td></tr></table>

</details>
<div class="admonition example">
<h3 id="exercicio-2">EXERCÍCIO 2<a class="headerlink" href="#exercicio-2" title="Permanent link">&para;</a></h3>
<p>Modifique o código do <code class="highlight"><span class="n">jogo_v2</span><span class="o">.</span><span class="n">py</span></code> para que ele desenhe a bandeira do Brasil (simplificada, só a parte verde, amarela e azul). Dica: você provavelmente vai querer utilizar a função <code class="highlight"><span class="n">pygame</span><span class="o">.</span><span class="n">draw</span><span class="o">.</span><span class="n">circle</span></code>(consulte a <a href="https://www.pygame.org/docs/ref/draw.html">documentação</a> para entender como utilizá-la).</p>
<p>Tente mudar a ordem dos desenhos (desenhe primeiro o círculo, depois o polígono). O que acontece? A ordem dos desenhos importa. O novo desenho é sempre feito sobrepondo os desenhos anteriores.</p>
</div>
<h2 id="desenhando-um-texto">Desenhando um texto<a class="headerlink" href="#desenhando-um-texto" title="Permanent link">&para;</a></h2>
<p>Talvez você tenha estranhado o título desta seção, mas qualquer texto deve realmente ser desenhado para aparecer na tela. Os caracteres de um texto também são desenhados como pixels. Vamos entender o arquivo <code class="highlight"><span class="n">jogo_v3</span><span class="o">.</span><span class="n">py</span></code>. Antes de abrir o arquivo, execute-o para ver o resultado.</p>
<details class="cite"><summary><code>referencia/jogo_v3.py</code></summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># ===== Inicialização =====</span>
<span class="c1"># ----- Importa e inicia pacotes</span>
<span class="kn">import</span> <span class="nn">pygame</span>

<span class="n">pygame</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>

<span class="c1"># ----- Gera tela principal</span>
<span class="n">window</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_mode</span><span class="p">((</span><span class="mi">500</span><span class="p">,</span> <span class="mi">400</span><span class="p">))</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s1">&#39;Hello World!&#39;</span><span class="p">)</span>

<span class="c1"># ----- Inicia estruturas de dados</span>
<span class="n">game</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># ----- Inicia assets</span>
<span class="n">font</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">SysFont</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">48</span><span class="p">)</span>
<span class="n">text</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s1">&#39;HELLO WORLD&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">))</span>

<span class="c1"># ===== Loop principal =====</span>
<span class="k">while</span> <span class="n">game</span><span class="p">:</span>
    <span class="c1"># ----- Trata eventos</span>
    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">pygame</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
        <span class="c1"># ----- Verifica consequências</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">QUIT</span><span class="p">:</span>
            <span class="n">game</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># ----- Gera saídas</span>
    <span class="n">window</span><span class="o">.</span><span class="n">fill</span><span class="p">((</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">))</span>  <span class="c1"># Preenche com a cor branca</span>
    <span class="n">window</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

    <span class="c1"># ----- Atualiza estado do jogo</span>
    <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>  <span class="c1"># Mostra o novo frame para o jogador</span>

<span class="c1"># ===== Finalização =====</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>  <span class="c1"># Função do PyGame que finaliza os recursos utilizados</span>
</code></pre></div>
</td></tr></table>

</details>
<p>Agora que você já viu o <code class="highlight"><span class="n">HELLO</span> <span class="n">WORLD</span></code> na tela, vamos entender o código. As mudanças estão nas linhas 15, 16 e 28:</p>
<ul>
<li><code class="highlight"><span class="n">font</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">SysFont</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">48</span><span class="p">)</span></code> (linha 15): carrega uma nova fonte de texto. Como não passamos nada como o primeiro argumento (<code class="highlight"><span class="kc">None</span></code>), o PyGame vai utilizar a fonte padrão. O segundo argumento é o tamanho da fonte;</li>
<li><code class="highlight"><span class="n">text</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s1">&#39;HELLO WORLD&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">))</span></code> (linha 16): cria uma imagem a partir da fonte criada na linha anterior com o texto <code class="highlight"><span class="s1">&#39;HELLO WORLD&#39;</span></code>. O segundo argumento neste momento pode ser sempre <code class="highlight"><span class="kc">True</span></code> (ele faz com que as curvas sejam desenhadas de maneira mais suave). O terceiro argumento é a cor;</li>
<li><code class="highlight"><span class="n">window</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span></code> (linha 28): desenha em <code class="highlight"><span class="n">window</span></code> a imagem <code class="highlight"><span class="n">text</span></code> na posição <code class="highlight"><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span></code> (lembrando que a origem - ponto (0, 0) - é no canto superior esquerdo). A imagem é delimitada por um retângulo. A posição passada como segundo argumento define a localização do ponto superior esquerdo desse retângulo. Por padrão, sempre que nos referimos à posição da imagem (coordenada <span><span class="MathJax_Preview">(x, y)</span><script type="math/tex">(x, y)</script></span>) queremos dizer o seu canto superior esquerdo.</li>
</ul>
<div class="admonition example">
<h3 id="exercicio-3">EXERCÍCIO 3<a class="headerlink" href="#exercicio-3" title="Permanent link">&para;</a></h3>
<p>Modifique o <code class="highlight"><span class="n">jogo_v3</span><span class="o">.</span><span class="n">py</span></code> para que ele desenhe o texto <code class="highlight"><span class="n">HELLO</span></code> em uma posição (por exemplo, no ponto (10, 10), onde ele já está) e o texto <code class="highlight"><span class="n">WORLD</span></code> em outro lugar da janela (por exemplo, no ponto (100, 100)).</p>
</div>
<h2 id="desenhando-uma-imagem">Desenhando uma imagem<a class="headerlink" href="#desenhando-uma-imagem" title="Permanent link">&para;</a></h2>
<p>Como vimos na seção anterior, <code class="highlight"><span class="n">text</span></code> já era uma imagem que foi desenhada na tela. Assim, não precisamos mudar muito o código para desenhar uma imagem qualquer. Execute o arquivo <code class="highlight"><span class="n">jogo_v4</span><span class="o">.</span><span class="n">py</span></code> e depois abra o código. A principal mudança está na linha 17, na qual carregamos uma imagem de um arquivo ao invés de desenhar um texto em uma imagem. O <code class="highlight"><span class="o">.</span><span class="n">convert</span><span class="p">()</span></code> no final da linha é uma otimização para acelerar o desenho da imagem. É uma boa prática sempre chamar esse método ao carregar uma imagem. Alternativamente pode-se utilizar o <code class="highlight"><span class="o">.</span><span class="n">convert_alpha</span><span class="p">()</span></code> quando a imagem possui transparência.</p>
<details class="cite"><summary><code>referencia/jogo_v4.py</code></summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># ===== Inicialização =====</span>
<span class="c1"># ----- Importa e inicia pacotes</span>
<span class="kn">import</span> <span class="nn">pygame</span>

<span class="n">pygame</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>

<span class="c1"># ----- Gera tela principal</span>
<span class="n">WIDTH</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">HEIGHT</span> <span class="o">=</span> <span class="mi">400</span>
<span class="n">window</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_mode</span><span class="p">((</span><span class="n">WIDTH</span><span class="p">,</span> <span class="n">HEIGHT</span><span class="p">))</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s1">&#39;Hello World!&#39;</span><span class="p">)</span>

<span class="c1"># ----- Inicia estruturas de dados</span>
<span class="n">game</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># ----- Inicia assets</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/logo-madfox.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span>

<span class="c1"># ===== Loop principal =====</span>
<span class="k">while</span> <span class="n">game</span><span class="p">:</span>
    <span class="c1"># ----- Trata eventos</span>
    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">pygame</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
        <span class="c1"># ----- Verifica consequências</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">QUIT</span><span class="p">:</span>
            <span class="n">game</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># ----- Gera saídas</span>
    <span class="n">window</span><span class="o">.</span><span class="n">fill</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>  <span class="c1"># Preenche com a cor branca</span>
    <span class="n">window</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

    <span class="c1"># ----- Atualiza estado do jogo</span>
    <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>  <span class="c1"># Mostra o novo frame para o jogador</span>

<span class="c1"># ===== Finalização =====</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>  <span class="c1"># Função do PyGame que finaliza os recursos utilizados</span>
</code></pre></div>
</td></tr></table>

</details>
<p>Aproveitamos para começar a organizar melhor o código. Foram criadas duas constantes, <code class="highlight"><span class="n">WIDTH</span></code> e <code class="highlight"><span class="n">HEIGHT</span></code>, para guardar o valor da largura e altura da janela. Assim, sempre que precisarmos dessa informação podemos usar as constantes ao invés de colocar os números diretamente. Isso facilita muito quando queremos alterar o tamanho da janela. Nesse caso não será necessário procurar em todos os lugares do código onde o número aparece. Basta mudar o valor da constante.</p>
<div class="admonition example">
<h3 id="exercicio-4">EXERCÍCIO 4<a class="headerlink" href="#exercicio-4" title="Permanent link">&para;</a></h3>
<p>A imagem está grande demais. Modifique o <code class="highlight"><span class="n">jogo_v4</span><span class="o">.</span><span class="n">py</span></code> para mostrar uma imagem menor. Dica: use o comando <code class="highlight"><span class="n">image</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="p">(</span><span class="mi">125</span><span class="p">,</span> <span class="mi">166</span><span class="p">))</span></code> para obter uma nova imagem de 125 X 166 pixels.</p>
</div>
<h2 id="recriando-o-asteroids">Recriando o Asteroids<a class="headerlink" href="#recriando-o-asteroids" title="Permanent link">&para;</a></h2>
<p>Asteroids é um jogo de nave que foi muito famoso na década de 80. Consiste em  destruir os meteoros que vem em sua direção através de tiros. Nesse tutorial, vamos replicar uma versão simplificada do jogo usando o pygame. Esse tutorial foi baseado no site <a href="http://kidscancode.org/lessons/">KidsCanCode</a>, o qual possui mais tutoriais com mais técnicas de desenvolvimento de jogos.</p>
<p>O arquivo <code class="highlight"><span class="n">jogo_v5</span><span class="o">.</span><span class="n">py</span></code> apresenta uma primeira versão com um único meteoro que fica caindo do topo da tela. Quando sai da tela, ele retorna à posição inicial. Execute o <code class="highlight"><span class="n">jogo_v5</span><span class="o">.</span><span class="n">py</span></code> e depois abra o arquivo para entender o que ele faz.</p>
<details class="cite"><summary><code>referencia/jogo_v5.py</code></summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># ===== Inicialização =====</span>
<span class="c1"># ----- Importa e inicia pacotes</span>
<span class="kn">import</span> <span class="nn">pygame</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="n">pygame</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>

<span class="c1"># ----- Gera tela principal</span>
<span class="n">WIDTH</span> <span class="o">=</span> <span class="mi">480</span>
<span class="n">HEIGHT</span> <span class="o">=</span> <span class="mi">600</span>
<span class="n">window</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_mode</span><span class="p">((</span><span class="n">WIDTH</span><span class="p">,</span> <span class="n">HEIGHT</span><span class="p">))</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s1">&#39;Navinha&#39;</span><span class="p">)</span>

<span class="c1"># ----- Inicia assets</span>
<span class="n">METEOR_WIDTH</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">METEOR_HEIGHT</span> <span class="o">=</span> <span class="mi">38</span>
<span class="n">font</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">SysFont</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">48</span><span class="p">)</span>
<span class="n">background</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/starfield.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span>
<span class="n">meteor_img</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/meteorBrown_med1.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert_alpha</span><span class="p">()</span>
<span class="n">meteor_img_small</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">meteor_img</span><span class="p">,</span> <span class="p">(</span><span class="n">METEOR_WIDTH</span><span class="p">,</span> <span class="n">METEOR_HEIGHT</span><span class="p">))</span>

<span class="c1"># ----- Inicia estruturas de dados</span>
<span class="n">game</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">meteor_x</span> <span class="o">=</span> <span class="mi">200</span>
<span class="c1"># y negativo significa que está acima do topo da janela. O meteoro começa fora da janela</span>
<span class="n">meteor_y</span> <span class="o">=</span> <span class="o">-</span><span class="n">METEOR_HEIGHT</span>
<span class="n">meteor_speedx</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">meteor_speedy</span> <span class="o">=</span> <span class="mi">4</span>

<span class="c1"># ===== Loop principal =====</span>
<span class="k">while</span> <span class="n">game</span><span class="p">:</span>
    <span class="c1"># ----- Trata eventos</span>
    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">pygame</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
        <span class="c1"># ----- Verifica consequências</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">QUIT</span><span class="p">:</span>
            <span class="n">game</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># ----- Atualiza estado do jogo</span>
    <span class="c1"># Atualizando a posição do meteoro</span>
    <span class="n">meteor_x</span> <span class="o">+=</span> <span class="n">meteor_speedx</span>
    <span class="n">meteor_y</span> <span class="o">+=</span> <span class="n">meteor_speedy</span>
    <span class="c1"># Se o meteoro passar do final da tela, volta para cima</span>
    <span class="k">if</span> <span class="n">meteor_y</span> <span class="o">&gt;</span> <span class="n">HEIGHT</span> <span class="ow">or</span> <span class="n">meteor_x</span> <span class="o">+</span> <span class="n">METEOR_WIDTH</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">meteor_x</span> <span class="o">&gt;</span> <span class="n">WIDTH</span><span class="p">:</span>
        <span class="n">meteor_x</span> <span class="o">=</span> <span class="mi">200</span>
        <span class="n">meteor_y</span> <span class="o">=</span> <span class="o">-</span><span class="n">METEOR_HEIGHT</span>

    <span class="c1"># ----- Gera saídas</span>
    <span class="n">window</span><span class="o">.</span><span class="n">fill</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>  <span class="c1"># Preenche com a cor branca</span>
    <span class="n">window</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">background</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">window</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">meteor_img_small</span><span class="p">,</span> <span class="p">(</span><span class="n">meteor_x</span><span class="p">,</span> <span class="n">meteor_y</span><span class="p">))</span>
    <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>  <span class="c1"># Mostra o novo frame para o jogador</span>

<span class="c1"># ===== Finalização =====</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>  <span class="c1"># Função do PyGame que finaliza os recursos utilizados</span>
</code></pre></div>
</td></tr></table>

</details>
<p>Este arquivo possui algumas modificações:</p>
<ul>
<li>Linhas 18 a 20: carrega as imagens de fundo e do meteoro;</li>
<li>Linhas 24 a 28: inicializa as variáveis que armazenam a posição e a velocidade do meteoro;</li>
<li>Linhas 40 e 41: atualiza a posição do meteoro;</li>
<li>Linhas 43 a 45: verifica se o meteoro saiu da tela. Nesse caso, faz ele voltar para a posição inicial.</li>
<li>Linhas 49 e 50: desenha a imagem de fundo e depois a imagem do meteoro (note que a imagem de fundo só cobre a janela inteira porque mudamos o tamanho da janela para 480 X 600 pixels - caso contrário uma parte dela ficaria com a cor de fundo).</li>
</ul>
<div class="admonition example">
<h3 id="exercicio-5">EXERCÍCIO 5<a class="headerlink" href="#exercicio-5" title="Permanent link">&para;</a></h3>
<p>O meteoro sempre começa na mesma posição e sempre se move na mesma direção. Vamos deixar o jogo mais interessante sorteando uma posição aleatória. Sorteie valores aleatórios para <code class="highlight"><span class="n">meteor_x</span></code>, <code class="highlight"><span class="n">meteor_y</span></code>, <code class="highlight"><span class="n">meteor_speedx</span></code>, <code class="highlight"><span class="n">meteor_speedy</span></code> na inicialização do jogo (a partir da linha 24) e quando o meteoro sai da tela (<code class="highlight"><span class="k">if</span></code> da linha 43). Sugestões de valores aleatórios:</p>
<ul>
<li><code class="highlight"><span class="n">meteor_x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">WIDTH</span><span class="o">-</span><span class="n">METEOR_WIDTH</span><span class="p">)</span></code> - o valor de x pode estar entre 0 e a largura da janela menos a largura da imagem do meteoro. Lembre-se que <code class="highlight"><span class="n">x</span></code> é a esquerda do retângulo que define a imagem;</li>
<li><code class="highlight"><span class="n">meteor_y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="n">METEOR_HEIGHT</span><span class="p">)</span></code> - valores negativos significam que o meteoro está acima da janela. Vamos sortear valores de maneira que ele sempre comece o movimento de fora da janela, ou seja, o mais baixo possível é <code class="highlight"><span class="o">-</span><span class="n">METEOR_HEIGHT</span></code>. Lembrando que <code class="highlight"><span class="n">y</span></code> é a coordenada de cima do retângulo da imagem;</li>
<li><code class="highlight"><span class="n">meteor_speedx</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span></code> - se os valores da componente x da velocidade forem muito altos o meteoro vai se mover para um dos lados sem descer muito;</li>
<li><code class="highlight"><span class="n">meteor_speedy</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span></code> - velocidades positivas em y significam que o meteoro vai se mover para baixo.</li>
</ul>
</div>
<h2 id="controlando-a-velocidade-do-jogo">Controlando a velocidade do jogo<a class="headerlink" href="#controlando-a-velocidade-do-jogo" title="Permanent link">&para;</a></h2>
<p>Você percebeu que o meteoro se move muito rapidamente? Isso acontece porque estamos em um loop infinito, cuja velocidade de execução depende da CPU (processador), memória e outras características do equipamento onde estiver sendo executado. Dessa forma a velocidade de deslocamento da nave vai variar conforme a máquina em que o jogo for executado e os programas que estejam nela rodando.</p>
<p>Para controlar o número de iterações do loop por segundo usaremos o seguinte artifício: será criado um relógio, a partir da classe <code class="highlight"><span class="n">Clock</span></code> do pygame. Essa classe possui um método chamado <code class="highlight"><span class="n">tick</span></code> que conta quantos milissegundos já se passaram desde a última vez que ele foi chamado. Pegaremos o tempo transcorrido mas não utilizaremos para nada. Mas ao pegar esse tempo especificaremos para o método <code class="highlight"><span class="n">tick</span></code> que queremos que ele seja executado no máximo 30 vezes por segundo. Dessa forma teremos um efeito colateral útil: o loop será limitado por essa chamada e só executará 30 vezes por segundo também. Assim, em qualquer máquina que o código for executado a velocidade de atualização do jogo será a mesma (exceto, claro, se a máquina for tão lenta que não conseguir executar nessa velocidade).</p>
<p>Aplicamos essas mudanças no arquivo <code class="highlight"><span class="n">jogo_v6</span><span class="o">.</span><span class="n">py</span></code> (linhas 34, 35 e 39). Execute o programa para ver o resultado da mudança.</p>
<details class="cite"><summary><code>referencia/jogo_v6.py</code></summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># ===== Inicialização =====</span>
<span class="c1"># ----- Importa e inicia pacotes</span>
<span class="kn">import</span> <span class="nn">pygame</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="n">pygame</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>

<span class="c1"># ----- Gera tela principal</span>
<span class="n">WIDTH</span> <span class="o">=</span> <span class="mi">480</span>
<span class="n">HEIGHT</span> <span class="o">=</span> <span class="mi">600</span>
<span class="n">window</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_mode</span><span class="p">((</span><span class="n">WIDTH</span><span class="p">,</span> <span class="n">HEIGHT</span><span class="p">))</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s1">&#39;Navinha&#39;</span><span class="p">)</span>

<span class="c1"># ----- Inicia assets</span>
<span class="n">METEOR_WIDTH</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">METEOR_HEIGHT</span> <span class="o">=</span> <span class="mi">38</span>
<span class="n">font</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">SysFont</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">48</span><span class="p">)</span>
<span class="n">background</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/starfield.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span>
<span class="n">meteor_img</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/meteorBrown_med1.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert_alpha</span><span class="p">()</span>
<span class="n">meteor_img_small</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">meteor_img</span><span class="p">,</span> <span class="p">(</span><span class="n">METEOR_WIDTH</span><span class="p">,</span> <span class="n">METEOR_HEIGHT</span><span class="p">))</span>

<span class="c1"># ----- Inicia estruturas de dados</span>
<span class="n">game</span> <span class="o">=</span> <span class="kc">True</span>
<span class="c1"># Sorteia posição aleatória</span>
<span class="c1"># Como x é o lado esquerdo da imagem, ele só pode ir até a largura da</span>
<span class="c1"># janela menos a largura da imagem</span>
<span class="n">meteor_x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">WIDTH</span><span class="o">-</span><span class="n">METEOR_WIDTH</span><span class="p">)</span>
<span class="c1"># y negativo significa que está acima do topo da janela. O meteoro começa fora da janela</span>
<span class="n">meteor_y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="n">METEOR_HEIGHT</span><span class="p">)</span>
<span class="c1"># Sorteia velocidade do meteoro</span>
<span class="n">meteor_speedx</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">meteor_speedy</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="c1"># Variável para o ajuste de velocidade</span>
<span class="n">clock</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">Clock</span><span class="p">()</span>
<span class="n">FPS</span> <span class="o">=</span> <span class="mi">15</span>

<span class="c1"># ===== Loop principal =====</span>
<span class="k">while</span> <span class="n">game</span><span class="p">:</span>
    <span class="n">clock</span><span class="o">.</span><span class="n">tick</span><span class="p">(</span><span class="n">FPS</span><span class="p">)</span>

    <span class="c1"># ----- Trata eventos</span>
    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">pygame</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
        <span class="c1"># ----- Verifica consequências</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">QUIT</span><span class="p">:</span>
            <span class="n">game</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># ----- Atualiza estado do jogo</span>
    <span class="c1"># Atualizando a posição do meteoro</span>
    <span class="n">meteor_x</span> <span class="o">+=</span> <span class="n">meteor_speedx</span>
    <span class="n">meteor_y</span> <span class="o">+=</span> <span class="n">meteor_speedy</span>
    <span class="c1"># Se o meteoro passar do final da tela, volta para cima e sorteia</span>
    <span class="c1"># novas posições e velocidades</span>
    <span class="k">if</span> <span class="n">meteor_y</span> <span class="o">&gt;</span> <span class="n">HEIGHT</span> <span class="ow">or</span> <span class="n">meteor_x</span> <span class="o">+</span> <span class="n">METEOR_WIDTH</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">meteor_x</span> <span class="o">&gt;</span> <span class="n">WIDTH</span><span class="p">:</span>
        <span class="n">meteor_x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">WIDTH</span><span class="o">-</span><span class="n">METEOR_WIDTH</span><span class="p">)</span>
        <span class="n">meteor_y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="n">METEOR_HEIGHT</span><span class="p">)</span>
        <span class="n">meteor_speedx</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">meteor_speedy</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>

    <span class="c1"># ----- Gera saídas</span>
    <span class="n">window</span><span class="o">.</span><span class="n">fill</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>  <span class="c1"># Preenche com a cor branca</span>
    <span class="n">window</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">background</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">window</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">meteor_img_small</span><span class="p">,</span> <span class="p">(</span><span class="n">meteor_x</span><span class="p">,</span> <span class="n">meteor_y</span><span class="p">))</span>
    <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>  <span class="c1"># Mostra o novo frame para o jogador</span>

<span class="c1"># ===== Finalização =====</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>  <span class="c1"># Função do PyGame que finaliza os recursos utilizados</span>
</code></pre></div>
</td></tr></table>

</details>
<div class="admonition example">
<h3 id="exercicio-6">EXERCÍCIO 6<a class="headerlink" href="#exercicio-6" title="Permanent link">&para;</a></h3>
<p>Agora parece que limitamos demais o número de execuções do loop principal. A animação parece um pouco travada. Altere a velocidade do jogo para que ele execute 30 frames por segundo ao invés de 15.</p>
</div>
<h2 id="adicionando-mais-meteoros">Adicionando mais meteoros<a class="headerlink" href="#adicionando-mais-meteoros" title="Permanent link">&para;</a></h2>
<p>Vamos adicionar mais meteoros ao jogo. Para isso, onde será necessário alterar o nosso código? Temos a inicialização da posição e velocidade do meteoro no começo do código e depois temos a reinicialização desses valores quando o meteoro sai da tela. Além disso, precisamos desenhar os meteoros em um outro lugar. Está começando a ficar complexo, não é mesmo?</p>
<h3 id="classes-em-python">Classes em Python<a class="headerlink" href="#classes-em-python" title="Permanent link">&para;</a></h3>
<p>Antes de criar mais meteoros, vamos então melhorar o nosso código. Para isso vamos utilizar um recurso disponível no Python chamado classes. Em Design de Software não vamos entrar em detalhes sobre o que são classes, nem como montar boas classes. Queremos apenas saber o mínimo para poder utilizá-las.</p>
<p>Neste primeiro momento você pode entender uma classe como um tipo de dados do Python. Na verdade, já trabalhamos com algumas classes, por mais que não tenhamos chamado-as assim: listas, strings e dicionários são algumas das classes disponíveis na linguagem. O interessante é que podemos criar novas classes (ou tipos) no Python. A ideia é semelhante ao que fazemos com um <code class="highlight"><span class="k">def</span></code>. Primeiro definimos a classe e depois usamos quando for necessário. Suponha, por exemplo, que queremos criar um novo tipo que represente um ponto com coordenadas <code class="highlight"><span class="n">x</span></code> e <code class="highlight"><span class="n">y</span></code>. Ele poderia ser feito da seguinte maneira (o exemplo completo está no arquivo <code class="highlight"><span class="n">teste_ponto</span><span class="o">.</span><span class="n">py</span></code>):</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Point</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>
</code></pre></div>

<p>Isso define uma classe <code class="highlight"><span class="n">Point</span></code> que possui coordenadas <code class="highlight"><span class="n">x</span></code> e <code class="highlight"><span class="n">y</span></code> ambas iguais a zero. Note que apenas definimos esse novo tipo, mas ainda não usamos. A partir desse momento o Python sabe o que é uma lista, o que é uma string e agora também o que é um <code class="highlight"><span class="n">Point</span></code>. Vamos utilizar esse nosso novo tipo:</p>
<div class="highlight"><pre><span></span><code><span class="n">ponto</span> <span class="o">=</span> <span class="n">Point</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;O ponto está nas coordenadas x=</span><span class="si">{0}</span><span class="s1"> e y=</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ponto</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">ponto</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
</code></pre></div>

<p>O código acima vai imprimir: <code class="highlight"><span class="n">O</span> <span class="n">ponto</span> <span class="n">está</span> <span class="n">nas</span> <span class="n">coordenadas</span> <span class="n">x</span><span class="o">=</span><span class="mi">0</span> <span class="n">e</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span></code>. O <code class="highlight"><span class="n">x</span></code> e <code class="highlight"><span class="n">y</span></code> são variáveis (chamamos de atributos) que estão ligadas àquele <code class="highlight"><span class="n">ponto</span></code> específico. Podemos inclusive mudar o seu valor:</p>
<div class="highlight"><pre><span></span><code><span class="n">ponto</span> <span class="o">=</span> <span class="n">Point</span><span class="p">()</span>
<span class="n">ponto</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">ponto</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">5</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;O ponto está nas coordenadas x=</span><span class="si">{0}</span><span class="s1"> e y=</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ponto</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">ponto</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
</code></pre></div>

<p>Esse novo código vai imprimir: <code class="highlight"><span class="n">O</span> <span class="n">ponto</span> <span class="n">está</span> <span class="n">nas</span> <span class="n">coordenadas</span> <span class="n">x</span><span class="o">=</span><span class="mi">2</span> <span class="n">e</span> <span class="n">y</span><span class="o">=</span><span class="mi">5</span></code>. Podemos modificar a nossa classe para que ela receba como argumentos os valores das coordenadas assim que um novo ponto é criado:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Point</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_coord</span><span class="p">,</span> <span class="n">y_coord</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x_coord</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y_coord</span>

<span class="n">ponto</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;O ponto está nas coordenadas x=</span><span class="si">{0}</span><span class="s1"> e y=</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ponto</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">ponto</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
</code></pre></div>

<p>Esse novo código vai imprimir: <code class="highlight"><span class="n">O</span> <span class="n">ponto</span> <span class="n">está</span> <span class="n">nas</span> <span class="n">coordenadas</span> <span class="n">x</span><span class="o">=</span><span class="mi">4</span> <span class="n">e</span> <span class="n">y</span><span class="o">=</span><span class="mi">1</span></code>. A função <code class="highlight"><span class="fm">__init__</span></code> é um tipo de função especial que é chamada quando o novo ponto é criado. Duas observações importantes:</p>
<ul>
<li>São <strong>dois underscores</strong> no começo e <strong>dois underscores</strong> no fim (chamamos esse par de dois underscores de <em>dunder</em>, ou <em>double underscore</em>);</li>
<li>Essas funções que fazem parte de uma classe sempre recebem um primeiro argumento chamado <code class="highlight"><span class="bp">self</span></code>. Ele é uma variável que guarda o próprio objeto. No nosso exemplo, <code class="highlight"><span class="bp">self</span></code> é o próprio ponto. Por isso, quando fazemos <code class="highlight"><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span></code> estamos guardando na variável (atributo) <code class="highlight"><span class="n">x</span></code> desse ponto específico o valor <code class="highlight"><span class="mi">0</span></code>.</li>
</ul>
<p>Vamos ver mais um exemplo de uma função definida dentro da classe (também chamada de método):</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Point</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_coord</span><span class="p">,</span> <span class="n">y_coord</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x_coord</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y_coord</span>

    <span class="k">def</span> <span class="nf">distance_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_point</span><span class="p">):</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="n">other_point</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="n">other_point</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="k">return</span> <span class="p">((</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">dy</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">**</span> <span class="mf">0.5</span>

<span class="n">p1</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">p2</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">p1</span><span class="o">.</span><span class="n">distance_to</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;A distância de (</span><span class="si">{0}</span><span class="s1">, </span><span class="si">{1}</span><span class="s1">) a (</span><span class="si">{2}</span><span class="s1">, </span><span class="si">{3}</span><span class="s1">) é </span><span class="si">{4}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p1</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">p2</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p2</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">d</span><span class="p">))</span>
</code></pre></div>

<p>O programa acima vai imprimir: <code class="highlight"><span class="n">A</span> <span class="n">distância</span> <span class="n">de</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="n">a</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="n">é</span> <span class="mi">5</span></code>. Considere o comando na penúltima linha: <code class="highlight"><span class="n">d</span> <span class="o">=</span> <span class="n">p1</span><span class="o">.</span><span class="n">distance_to</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span></code>. Ele segue uma estrutura muito parecida com o que já fazíamos com strings, por exemplo:</p>
<div class="highlight"><pre><span></span><code><span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;Insper&#39;</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Ins&#39;</span><span class="p">,</span> <span class="s1">&#39;Su&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</code></pre></div>

<p>Se você quiser praticar um pouco o uso de classes, faça os exercícios <a href="http://softdes.insper.edu.br/exercicio/88">88</a> e <a href="http://softdes.insper.edu.br/exercicio/89">89</a> do servidor.</p>
<h3 id="classes-no-pygame">Classes no pygame<a class="headerlink" href="#classes-no-pygame" title="Permanent link">&para;</a></h3>
<p>O pygame define algumas novas classes que facilitam o desenvolvimento de jogos. Uma dessas classes é o <code class="highlight"><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span></code>. Vamos aprender como usar esse tipo com o exemplo do meteoro. O exemplo a seguir define uma classe do tipo <code class="highlight"><span class="n">Meteor</span></code>, que estende as funcionalidades de um <code class="highlight"><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span></code> (ou seja, faz tudo que um <code class="highlight"><span class="n">Sprite</span></code> faz e mais um pouco):</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Meteor</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/meteorBrown_med1.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert_alpha</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="p">(</span><span class="n">METEOR_WIDTH</span><span class="p">,</span> <span class="n">METEOR_HEIGHT</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">WIDTH</span><span class="o">-</span><span class="n">METEOR_WIDTH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="n">METEOR_HEIGHT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Atualizando a posição do meteoro</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span>
        <span class="c1"># Se o meteoro passar do final da tela, volta para cima e sorteia</span>
        <span class="c1"># novas posições e velocidades</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">top</span> <span class="o">&gt;</span> <span class="n">HEIGHT</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">right</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">left</span> <span class="o">&gt;</span> <span class="n">WIDTH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">WIDTH</span><span class="o">-</span><span class="n">METEOR_WIDTH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="n">METEOR_HEIGHT</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
</code></pre></div>

<p>Na inicialização do tipo <code class="highlight"><span class="n">Meteor</span></code> temos o carregamento da imagem e o sorteio das posições e velocidades do meteoro. Todo <code class="highlight"><span class="n">Sprite</span></code> deve definir um atributo <code class="highlight"><span class="n">image</span></code> e um <code class="highlight"><span class="n">rect</span></code>. Eles são utilizados para desenhar a imagem. O <code class="highlight"><span class="n">rect</span></code> define a posição do retângulo da imagem e oferece algumas vantagens, como podemos ver na condição do <code class="highlight"><span class="k">if</span></code>. Um retângulo é um outro tipo definido pelo pygame, que possui, além da posição <code class="highlight"><span class="n">x</span></code> e <code class="highlight"><span class="n">y</span></code>, outros atributos úteis, como <code class="highlight"><span class="n">top</span></code>, <code class="highlight"><span class="n">left</span></code>, <code class="highlight"><span class="n">right</span></code>, <code class="highlight"><span class="n">bottom</span></code>, <code class="highlight"><span class="n">centerx</span></code> e <code class="highlight"><span class="n">centery</span></code>. Usamos alguns desses exemplos no <code class="highlight"><span class="k">if</span></code>, simplificando as comparações.</p>
<p>O método <code class="highlight"><span class="n">update</span></code> será chamado quando quisermos atualizar a posição do meteoro, ou seja, em cada iteração do loop principal.</p>
<p>O arquivo <code class="highlight"><span class="n">jogo_v7</span><span class="o">.</span><span class="n">py</span></code> cria a classe <code class="highlight"><span class="n">Meteor</span></code> e substitui o código referente ao meteoro da versão anterior. Execute-o para ver o resultado e depois abra o código. Note que a classe <code class="highlight"><span class="n">Meteor</span></code> está ligeiramente diferente da que apresentamos acima. A diferença é que ao invés de carregar a imagem dentro do <code class="highlight"><span class="fm">__init__</span></code>, nós já recebemos uma imagem carregada no <code class="highlight"><span class="fm">__init__</span></code> (linha 25). Essa diferença é importante, pois ao invés de carregar uma nova imagem para cada novo meteoro, nós carregamos a imagem apenas uma vez e usamos a mesma imagem carregada em todos os meteoros. Também adicionamos uma linha no começo do <code class="highlight"><span class="fm">__init__</span></code>, com <code class="highlight"><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>. Como o <code class="highlight"><span class="n">Meteor</span></code> é uma estensão da classe <code class="highlight"><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span></code>, nós precisamos inicializar o resto do <code class="highlight"><span class="n">Sprite</span></code>. Não se preocupe se não entender todos os detalhes. Por enquanto basta saber que essa linha é obrigatória.</p>
<details class="cite"><summary><code>referencia/jogo_v7.py</code></summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># ===== Inicialização =====</span>
<span class="c1"># ----- Importa e inicia pacotes</span>
<span class="kn">import</span> <span class="nn">pygame</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="n">pygame</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>

<span class="c1"># ----- Gera tela principal</span>
<span class="n">WIDTH</span> <span class="o">=</span> <span class="mi">480</span>
<span class="n">HEIGHT</span> <span class="o">=</span> <span class="mi">600</span>
<span class="n">window</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_mode</span><span class="p">((</span><span class="n">WIDTH</span><span class="p">,</span> <span class="n">HEIGHT</span><span class="p">))</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s1">&#39;Navinha&#39;</span><span class="p">)</span>

<span class="c1"># ----- Inicia assets</span>
<span class="n">METEOR_WIDTH</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">METEOR_HEIGHT</span> <span class="o">=</span> <span class="mi">38</span>
<span class="n">font</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">SysFont</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">48</span><span class="p">)</span>
<span class="n">background</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/starfield.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span>
<span class="n">meteor_img</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/meteorBrown_med1.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert_alpha</span><span class="p">()</span>
<span class="n">meteor_img</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">meteor_img</span><span class="p">,</span> <span class="p">(</span><span class="n">METEOR_WIDTH</span><span class="p">,</span> <span class="n">METEOR_HEIGHT</span><span class="p">))</span>

<span class="c1"># ----- Inicia estruturas de dados</span>
<span class="c1"># Definindo os novos tipos</span>
<span class="k">class</span> <span class="nc">Meteor</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
        <span class="c1"># Construtor da classe mãe (Sprite).</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">img</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">WIDTH</span><span class="o">-</span><span class="n">METEOR_WIDTH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="n">METEOR_HEIGHT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Atualizando a posição do meteoro</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span>
        <span class="c1"># Se o meteoro passar do final da tela, volta para cima e sorteia</span>
        <span class="c1"># novas posições e velocidades</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">top</span> <span class="o">&gt;</span> <span class="n">HEIGHT</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">right</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">left</span> <span class="o">&gt;</span> <span class="n">WIDTH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">WIDTH</span><span class="o">-</span><span class="n">METEOR_WIDTH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="n">METEOR_HEIGHT</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>

<span class="n">game</span> <span class="o">=</span> <span class="kc">True</span>
<span class="c1"># Variável para o ajuste de velocidade</span>
<span class="n">clock</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">Clock</span><span class="p">()</span>
<span class="n">FPS</span> <span class="o">=</span> <span class="mi">30</span>

<span class="c1"># Criando dois meteoros</span>
<span class="n">meteor1</span> <span class="o">=</span> <span class="n">Meteor</span><span class="p">(</span><span class="n">meteor_img</span><span class="p">)</span>
<span class="n">meteor2</span> <span class="o">=</span> <span class="n">Meteor</span><span class="p">(</span><span class="n">meteor_img</span><span class="p">)</span>

<span class="c1"># ===== Loop principal =====</span>
<span class="k">while</span> <span class="n">game</span><span class="p">:</span>
    <span class="n">clock</span><span class="o">.</span><span class="n">tick</span><span class="p">(</span><span class="n">FPS</span><span class="p">)</span>

    <span class="c1"># ----- Trata eventos</span>
    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">pygame</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
        <span class="c1"># ----- Verifica consequências</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">QUIT</span><span class="p">:</span>
            <span class="n">game</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># ----- Atualiza estado do jogo</span>
    <span class="c1"># Atualizando a posição dos meteoros</span>
    <span class="n">meteor1</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
    <span class="n">meteor2</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

    <span class="c1"># ----- Gera saídas</span>
    <span class="n">window</span><span class="o">.</span><span class="n">fill</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>  <span class="c1"># Preenche com a cor branca</span>
    <span class="n">window</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">background</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="c1"># Desenhando meteoros</span>
    <span class="n">window</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">meteor1</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">meteor1</span><span class="o">.</span><span class="n">rect</span><span class="p">)</span>
    <span class="n">window</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">meteor2</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">meteor2</span><span class="o">.</span><span class="n">rect</span><span class="p">)</span>

    <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>  <span class="c1"># Mostra o novo frame para o jogador</span>

<span class="c1"># ===== Finalização =====</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>  <span class="c1"># Função do PyGame que finaliza os recursos utilizados</span>
</code></pre></div>
</td></tr></table>

</details>
<p>As principais mudanças nesta versão são:</p>
<ul>
<li>Linhas 24 a 46: definição da classe <code class="highlight"><span class="n">Meteor</span></code>;</li>
<li>Linhas 54 e 55: criação de dois meteoros. Note que o código que sorteava a posição do meteoro (linhas 27 a 32 do <code class="highlight"><span class="n">jogo_v6</span><span class="o">.</span><span class="n">py</span></code>) agora está na inicialização (construtor) da classe <code class="highlight"><span class="n">Meteor</span></code>, assim, ao criar dois meteoros, cada um será sorteado com posições e velocidades distintas;</li>
<li>Linhas 69 e 70: atualização da posição dos meteoros. A lógica de atualização da posição agora está concentrada na classe <code class="highlight"><span class="n">Meteor</span></code>, assim não precisamos mais das linhas 49 a 57 do <code class="highlight"><span class="n">jogo_v6</span><span class="o">.</span><span class="n">py</span></code>;</li>
<li>Linhas 76 e 77: desenhando os meteoros. O código é bastante semelhante ao que tínhamos antes, mas agora utilizamos a imagem e o rect (que define a posição da imagem) guardados como atributos de cada meteoro.</li>
</ul>
<div class="admonition example">
<h3 id="exercicio-7">EXERCÍCIO 7<a class="headerlink" href="#exercicio-7" title="Permanent link">&para;</a></h3>
<p>Modifique o <code class="highlight"><span class="n">jogo_v7</span><span class="o">.</span><span class="n">py</span></code> para que ele tenha 4 meteoros ao invés de 2.</p>
</div>
<h2 id="adicionando-mais-meteoros-ainda">Adicionando mais meteoros ainda<a class="headerlink" href="#adicionando-mais-meteoros-ainda" title="Permanent link">&para;</a></h2>
<p>Conforme criamos mais meteoros, começa a ficar inviável utilizarmos uma variável para cada meteoro. Uma soluções (que já ajudaria muito), seria criarmos uma lista com todos os meteoros. O pygame define um novo tipo chamado <code class="highlight"><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Group</span></code>, que é como uma lista, mas que tem algumas funcionalidades adicionais.</p>
<p>O <code class="highlight"><span class="n">jogo_v8</span></code> utiliza o <code class="highlight"><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Group</span></code> para criar vários grupos de uma vez. As principais mudanças neste arquivo são:</p>
<details class="cite"><summary><code>referencia/jogo_v8.py</code></summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># ===== Inicialização =====</span>
<span class="c1"># ----- Importa e inicia pacotes</span>
<span class="kn">import</span> <span class="nn">pygame</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="n">pygame</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>

<span class="c1"># ----- Gera tela principal</span>
<span class="n">WIDTH</span> <span class="o">=</span> <span class="mi">480</span>
<span class="n">HEIGHT</span> <span class="o">=</span> <span class="mi">600</span>
<span class="n">window</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_mode</span><span class="p">((</span><span class="n">WIDTH</span><span class="p">,</span> <span class="n">HEIGHT</span><span class="p">))</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s1">&#39;Navinha&#39;</span><span class="p">)</span>

<span class="c1"># ----- Inicia assets</span>
<span class="n">METEOR_WIDTH</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">METEOR_HEIGHT</span> <span class="o">=</span> <span class="mi">38</span>
<span class="n">font</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">SysFont</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">48</span><span class="p">)</span>
<span class="n">background</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/starfield.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span>
<span class="n">meteor_img</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/meteorBrown_med1.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert_alpha</span><span class="p">()</span>
<span class="n">meteor_img</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">meteor_img</span><span class="p">,</span> <span class="p">(</span><span class="n">METEOR_WIDTH</span><span class="p">,</span> <span class="n">METEOR_HEIGHT</span><span class="p">))</span>

<span class="c1"># ----- Inicia estruturas de dados</span>
<span class="c1"># Definindo os novos tipos</span>
<span class="k">class</span> <span class="nc">Meteor</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
        <span class="c1"># Construtor da classe mãe (Sprite).</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">img</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">WIDTH</span><span class="o">-</span><span class="n">METEOR_WIDTH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="n">METEOR_HEIGHT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Atualizando a posição do meteoro</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span>
        <span class="c1"># Se o meteoro passar do final da tela, volta para cima e sorteia</span>
        <span class="c1"># novas posições e velocidades</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">top</span> <span class="o">&gt;</span> <span class="n">HEIGHT</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">right</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">left</span> <span class="o">&gt;</span> <span class="n">WIDTH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">WIDTH</span><span class="o">-</span><span class="n">METEOR_WIDTH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="n">METEOR_HEIGHT</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>

<span class="n">game</span> <span class="o">=</span> <span class="kc">True</span>
<span class="c1"># Variável para o ajuste de velocidade</span>
<span class="n">clock</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">Clock</span><span class="p">()</span>
<span class="n">FPS</span> <span class="o">=</span> <span class="mi">30</span>

<span class="c1"># Criando um grupo de meteoros</span>
<span class="n">all_meteors</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Group</span><span class="p">()</span>
<span class="c1"># Criando os meteoros</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
    <span class="n">meteor</span> <span class="o">=</span> <span class="n">Meteor</span><span class="p">(</span><span class="n">meteor_img</span><span class="p">)</span>
    <span class="n">all_meteors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">meteor</span><span class="p">)</span>

<span class="c1"># ===== Loop principal =====</span>
<span class="k">while</span> <span class="n">game</span><span class="p">:</span>
    <span class="n">clock</span><span class="o">.</span><span class="n">tick</span><span class="p">(</span><span class="n">FPS</span><span class="p">)</span>

    <span class="c1"># ----- Trata eventos</span>
    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">pygame</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
        <span class="c1"># ----- Verifica consequências</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">QUIT</span><span class="p">:</span>
            <span class="n">game</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># ----- Atualiza estado do jogo</span>
    <span class="c1"># Atualizando a posição dos meteoros</span>
    <span class="n">all_meteors</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

    <span class="c1"># ----- Gera saídas</span>
    <span class="n">window</span><span class="o">.</span><span class="n">fill</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>  <span class="c1"># Preenche com a cor branca</span>
    <span class="n">window</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">background</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="c1"># Desenhando meteoros</span>
    <span class="n">all_meteors</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>

    <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>  <span class="c1"># Mostra o novo frame para o jogador</span>

<span class="c1"># ===== Finalização =====</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>  <span class="c1"># Função do PyGame que finaliza os recursos utilizados</span>
</code></pre></div>
</td></tr></table>

</details>
<ul>
<li>Linhas 54 a 58: criação de um grupo de sprites e um <code class="highlight"><span class="k">for</span></code> que cria e adiciona vários meteoros no grupo;</li>
<li>Linha 72: atualiza todos os sprites de uma vez. Por trás dos panos o pygame percorre todos os sprites dentro daquele grupo e chama o método <code class="highlight"><span class="n">update</span></code> de cada um deles;</li>
<li>Linha 78: desenha todos os sprites de uma vez. Por trás dos panos o pygame percorre todos os sprites, desenhando um por um.</li>
</ul>
<div class="admonition example">
<h3 id="exercicio-8">EXERCÍCIO 8<a class="headerlink" href="#exercicio-8" title="Permanent link">&para;</a></h3>
<p>Modifique o <code class="highlight"><span class="n">jogo_v8</span><span class="o">.</span><span class="n">py</span></code> para que ele tenha 15 meteoros ao invés de 8. Além disso, vamos começar a nos preparar para implementar o jogador. Crie uma nova classe chamada <code class="highlight"><span class="n">Ship</span></code> que também estende o tipo <code class="highlight"><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span></code> com a imagem <code class="highlight"><span class="n">assets</span><span class="o">/</span><span class="n">img</span><span class="o">/</span><span class="n">playerShip1_orange</span><span class="o">.</span><span class="n">png</span></code>. A nave não deve se mover (não precisa implementar o <code class="highlight"><span class="n">update</span></code>). Utilize os valores <code class="highlight"><span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">centerx</span> <span class="o">=</span> <span class="n">WIDTH</span> <span class="o">/</span> <span class="mi">2</span></code> e <code class="highlight"><span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">bottom</span> <span class="o">=</span> <span class="n">HEIGHT</span> <span class="o">-</span> <span class="mi">10</span></code>.</p>
</div>
<h2 id="adicionando-a-nave">Adicionando a nave<a class="headerlink" href="#adicionando-a-nave" title="Permanent link">&para;</a></h2>
<p>O <code class="highlight"><span class="n">jogo_v9</span><span class="o">.</span><span class="n">py</span></code> adiciona a classe <code class="highlight"><span class="n">Ship</span></code> e cria uma nave. Ainda não é possível mover a nave, mas a classe já está preparada para isso. As principais mudanças são:</p>
<details class="cite"><summary><code>referencia/jogo_v9.py</code></summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># ===== Inicialização =====</span>
<span class="c1"># ----- Importa e inicia pacotes</span>
<span class="kn">import</span> <span class="nn">pygame</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="n">pygame</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>

<span class="c1"># ----- Gera tela principal</span>
<span class="n">WIDTH</span> <span class="o">=</span> <span class="mi">480</span>
<span class="n">HEIGHT</span> <span class="o">=</span> <span class="mi">600</span>
<span class="n">window</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_mode</span><span class="p">((</span><span class="n">WIDTH</span><span class="p">,</span> <span class="n">HEIGHT</span><span class="p">))</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s1">&#39;Navinha&#39;</span><span class="p">)</span>

<span class="c1"># ----- Inicia assets</span>
<span class="n">METEOR_WIDTH</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">METEOR_HEIGHT</span> <span class="o">=</span> <span class="mi">38</span>
<span class="n">SHIP_WIDTH</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">SHIP_HEIGHT</span> <span class="o">=</span> <span class="mi">38</span>
<span class="n">font</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">SysFont</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">48</span><span class="p">)</span>
<span class="n">background</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/starfield.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span>
<span class="n">meteor_img</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/meteorBrown_med1.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert_alpha</span><span class="p">()</span>
<span class="n">meteor_img</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">meteor_img</span><span class="p">,</span> <span class="p">(</span><span class="n">METEOR_WIDTH</span><span class="p">,</span> <span class="n">METEOR_HEIGHT</span><span class="p">))</span>
<span class="n">ship_img</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/playerShip1_orange.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert_alpha</span><span class="p">()</span>
<span class="n">ship_img</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">ship_img</span><span class="p">,</span> <span class="p">(</span><span class="n">SHIP_WIDTH</span><span class="p">,</span> <span class="n">SHIP_HEIGHT</span><span class="p">))</span>

<span class="c1"># ----- Inicia estruturas de dados</span>
<span class="c1"># Definindo os novos tipos</span>
<span class="k">class</span> <span class="nc">Ship</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
        <span class="c1"># Construtor da classe mãe (Sprite).</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">img</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">centerx</span> <span class="o">=</span> <span class="n">WIDTH</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">bottom</span> <span class="o">=</span> <span class="n">HEIGHT</span> <span class="o">-</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Atualização da posição da nave</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span>

        <span class="c1"># Mantem dentro da tela</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">right</span> <span class="o">&gt;</span> <span class="n">WIDTH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">WIDTH</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">left</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">class</span> <span class="nc">Meteor</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
        <span class="c1"># Construtor da classe mãe (Sprite).</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">img</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">WIDTH</span><span class="o">-</span><span class="n">METEOR_WIDTH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="n">METEOR_HEIGHT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Atualizando a posição do meteoro</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span>
        <span class="c1"># Se o meteoro passar do final da tela, volta para cima e sorteia</span>
        <span class="c1"># novas posições e velocidades</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">top</span> <span class="o">&gt;</span> <span class="n">HEIGHT</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">right</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">left</span> <span class="o">&gt;</span> <span class="n">WIDTH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">WIDTH</span><span class="o">-</span><span class="n">METEOR_WIDTH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="n">METEOR_HEIGHT</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>

<span class="n">game</span> <span class="o">=</span> <span class="kc">True</span>
<span class="c1"># Variável para o ajuste de velocidade</span>
<span class="n">clock</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">Clock</span><span class="p">()</span>
<span class="n">FPS</span> <span class="o">=</span> <span class="mi">30</span>

<span class="c1"># Criando um grupo de meteoros</span>
<span class="n">all_sprites</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Group</span><span class="p">()</span>
<span class="c1"># Criando o jogador</span>
<span class="n">player</span> <span class="o">=</span> <span class="n">Ship</span><span class="p">(</span><span class="n">ship_img</span><span class="p">)</span>
<span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">player</span><span class="p">)</span>
<span class="c1"># Criando os meteoros</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
    <span class="n">meteor</span> <span class="o">=</span> <span class="n">Meteor</span><span class="p">(</span><span class="n">meteor_img</span><span class="p">)</span>
    <span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">meteor</span><span class="p">)</span>

<span class="c1"># ===== Loop principal =====</span>
<span class="k">while</span> <span class="n">game</span><span class="p">:</span>
    <span class="n">clock</span><span class="o">.</span><span class="n">tick</span><span class="p">(</span><span class="n">FPS</span><span class="p">)</span>

    <span class="c1"># ----- Trata eventos</span>
    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">pygame</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
        <span class="c1"># ----- Verifica consequências</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">QUIT</span><span class="p">:</span>
            <span class="n">game</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># ----- Atualiza estado do jogo</span>
    <span class="c1"># Atualizando a posição dos meteoros</span>
    <span class="n">all_sprites</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

    <span class="c1"># ----- Gera saídas</span>
    <span class="n">window</span><span class="o">.</span><span class="n">fill</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>  <span class="c1"># Preenche com a cor branca</span>
    <span class="n">window</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">background</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="c1"># Desenhando meteoros</span>
    <span class="n">all_sprites</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>

    <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>  <span class="c1"># Mostra o novo frame para o jogador</span>

<span class="c1"># ===== Finalização =====</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>  <span class="c1"># Função do PyGame que finaliza os recursos utilizados</span>
</code></pre></div>
</td></tr></table>

</details>
<ul>
<li>Linhas 23 e 24: carrega a imagem da nave e redimensiona para um tamanho menor;</li>
<li>Linhas 28 a 47: define a classe <code class="highlight"><span class="n">Ship</span></code>. O método <code class="highlight"><span class="n">update</span></code> atualiza a posição <code class="highlight"><span class="n">x</span></code> aplicando a velocidade e o <code class="highlight"><span class="k">if</span></code> garante que a nave não saia da janela. Sempre que a nave sai da janela ela é movida para dentro da janela novamente. Note que a nave ainda não vai se mover, pois a velocidade no eixo x é zero. Além disso, não implementamos o movimento no eixo y, pois queremos que a nave apenas se mova para os lados;</li>
<li>Linhas 79 a 82: mudança do nome do grupo para <code class="highlight"><span class="n">all_sprites</span></code>, pois agora guardaremos todos os sprites nesse mesmo grupo. Uma nave é criada e armazenada na variável <code class="highlight"><span class="n">player</span></code>. Esse <code class="highlight"><span class="n">player</span></code> é adicionado ao <code class="highlight"><span class="n">all_sprites</span></code>, assim ao chamar <code class="highlight"><span class="n">all_sprites</span><span class="o">.</span><span class="n">update</span><span class="p">()</span></code> e <code class="highlight"><span class="n">all_sprites</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">window</span><span class="p">)</span></code>, todos os meteoros e a nave serão atualizados e desenhados em um único comando.</li>
</ul>
<div class="admonition example">
<h3 id="exercicio-9">EXERCÍCIO 9<a class="headerlink" href="#exercicio-9" title="Permanent link">&para;</a></h3>
<p>Modifique o <code class="highlight"><span class="n">jogo_v9</span><span class="o">.</span><span class="n">py</span></code> para que a nave se mova com velocidade 5 para a esquerda. Se quiser, faça o seguinte teste adicional. Comente os blocos do <code class="highlight"><span class="k">if</span></code> e <code class="highlight"><span class="k">else</span></code> do <code class="highlight"><span class="n">update</span></code> da nave e veja o que acontece.</p>
</div>
<h2 id="movimento-da-nave">Movimento da nave<a class="headerlink" href="#movimento-da-nave" title="Permanent link">&para;</a></h2>
<p>Finalmente vamos adicionar alguma interação! Queremos que o jogador possa controlar o movimento da nave usando o teclado. Assim, quando ele apertar as setas do teclado para a esquerda ou para a direita, a nave deve se mover. Lembre-se que no início deste handout falamos que teclas apertadas são eventos. O tratamento de eventos é uma das etapas do loop principal. Até agora só utilizamos o tratamento de eventos para verificar se o usuário fechou a janela do jogo. O <code class="highlight"><span class="n">jogo_v10</span><span class="o">.</span><span class="n">py</span></code> adiciona o tratamento dos eventos das setas do teclado. As principais mudanças estão nas linhas 98 a 110.</p>
<details class="cite"><summary><code>referencia/jogo_v10.py</code></summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># ===== Inicialização =====</span>
<span class="c1"># ----- Importa e inicia pacotes</span>
<span class="kn">import</span> <span class="nn">pygame</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="n">pygame</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>

<span class="c1"># ----- Gera tela principal</span>
<span class="n">WIDTH</span> <span class="o">=</span> <span class="mi">480</span>
<span class="n">HEIGHT</span> <span class="o">=</span> <span class="mi">600</span>
<span class="n">window</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_mode</span><span class="p">((</span><span class="n">WIDTH</span><span class="p">,</span> <span class="n">HEIGHT</span><span class="p">))</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s1">&#39;Navinha&#39;</span><span class="p">)</span>

<span class="c1"># ----- Inicia assets</span>
<span class="n">METEOR_WIDTH</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">METEOR_HEIGHT</span> <span class="o">=</span> <span class="mi">38</span>
<span class="n">SHIP_WIDTH</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">SHIP_HEIGHT</span> <span class="o">=</span> <span class="mi">38</span>
<span class="n">font</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">SysFont</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">48</span><span class="p">)</span>
<span class="n">background</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/starfield.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span>
<span class="n">meteor_img</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/meteorBrown_med1.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert_alpha</span><span class="p">()</span>
<span class="n">meteor_img</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">meteor_img</span><span class="p">,</span> <span class="p">(</span><span class="n">METEOR_WIDTH</span><span class="p">,</span> <span class="n">METEOR_HEIGHT</span><span class="p">))</span>
<span class="n">ship_img</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/playerShip1_orange.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert_alpha</span><span class="p">()</span>
<span class="n">ship_img</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">ship_img</span><span class="p">,</span> <span class="p">(</span><span class="n">SHIP_WIDTH</span><span class="p">,</span> <span class="n">SHIP_HEIGHT</span><span class="p">))</span>

<span class="c1"># ----- Inicia estruturas de dados</span>
<span class="c1"># Definindo os novos tipos</span>
<span class="k">class</span> <span class="nc">Ship</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
        <span class="c1"># Construtor da classe mãe (Sprite).</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">img</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">centerx</span> <span class="o">=</span> <span class="n">WIDTH</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">bottom</span> <span class="o">=</span> <span class="n">HEIGHT</span> <span class="o">-</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Atualização da posição da nave</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span>

        <span class="c1"># Mantem dentro da tela</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">right</span> <span class="o">&gt;</span> <span class="n">WIDTH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">WIDTH</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">left</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">class</span> <span class="nc">Meteor</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
        <span class="c1"># Construtor da classe mãe (Sprite).</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">img</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">WIDTH</span><span class="o">-</span><span class="n">METEOR_WIDTH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="n">METEOR_HEIGHT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Atualizando a posição do meteoro</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span>
        <span class="c1"># Se o meteoro passar do final da tela, volta para cima e sorteia</span>
        <span class="c1"># novas posições e velocidades</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">top</span> <span class="o">&gt;</span> <span class="n">HEIGHT</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">right</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">left</span> <span class="o">&gt;</span> <span class="n">WIDTH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">WIDTH</span><span class="o">-</span><span class="n">METEOR_WIDTH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="n">METEOR_HEIGHT</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>

<span class="n">game</span> <span class="o">=</span> <span class="kc">True</span>
<span class="c1"># Variável para o ajuste de velocidade</span>
<span class="n">clock</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">Clock</span><span class="p">()</span>
<span class="n">FPS</span> <span class="o">=</span> <span class="mi">30</span>

<span class="c1"># Criando um grupo de meteoros</span>
<span class="n">all_sprites</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Group</span><span class="p">()</span>
<span class="c1"># Criando o jogador</span>
<span class="n">player</span> <span class="o">=</span> <span class="n">Ship</span><span class="p">(</span><span class="n">ship_img</span><span class="p">)</span>
<span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">player</span><span class="p">)</span>
<span class="c1"># Criando os meteoros</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
    <span class="n">meteor</span> <span class="o">=</span> <span class="n">Meteor</span><span class="p">(</span><span class="n">meteor_img</span><span class="p">)</span>
    <span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">meteor</span><span class="p">)</span>

<span class="c1"># ===== Loop principal =====</span>
<span class="k">while</span> <span class="n">game</span><span class="p">:</span>
    <span class="n">clock</span><span class="o">.</span><span class="n">tick</span><span class="p">(</span><span class="n">FPS</span><span class="p">)</span>

    <span class="c1"># ----- Trata eventos</span>
    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">pygame</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
        <span class="c1"># ----- Verifica consequências</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">QUIT</span><span class="p">:</span>
            <span class="n">game</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># Verifica se apertou alguma tecla.</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">KEYDOWN</span><span class="p">:</span>
            <span class="c1"># Dependendo da tecla, altera a velocidade.</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_LEFT</span><span class="p">:</span>
                <span class="n">player</span><span class="o">.</span><span class="n">speedx</span> <span class="o">-=</span> <span class="mi">8</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_RIGHT</span><span class="p">:</span>
                <span class="n">player</span><span class="o">.</span><span class="n">speedx</span> <span class="o">+=</span> <span class="mi">8</span>
        <span class="c1"># Verifica se soltou alguma tecla.</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">KEYUP</span><span class="p">:</span>
            <span class="c1"># Dependendo da tecla, altera a velocidade.</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_LEFT</span><span class="p">:</span>
                <span class="n">player</span><span class="o">.</span><span class="n">speedx</span> <span class="o">+=</span> <span class="mi">8</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_RIGHT</span><span class="p">:</span>
                <span class="n">player</span><span class="o">.</span><span class="n">speedx</span> <span class="o">-=</span> <span class="mi">8</span>

    <span class="c1"># ----- Atualiza estado do jogo</span>
    <span class="c1"># Atualizando a posição dos meteoros</span>
    <span class="n">all_sprites</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

    <span class="c1"># ----- Gera saídas</span>
    <span class="n">window</span><span class="o">.</span><span class="n">fill</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>  <span class="c1"># Preenche com a cor branca</span>
    <span class="n">window</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">background</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="c1"># Desenhando meteoros</span>
    <span class="n">all_sprites</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>

    <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>  <span class="c1"># Mostra o novo frame para o jogador</span>

<span class="c1"># ===== Finalização =====</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>  <span class="c1"># Função do PyGame que finaliza os recursos utilizados</span>
</code></pre></div>
</td></tr></table>

</details>
<p>Quando o jogador aperta uma tecla (evento do tipo <code class="highlight"><span class="n">pygame</span><span class="o">.</span><span class="n">KEYDOWN</span></code>), se a tecla apertada for a seta para a direita ou para a esquerda, nós aumentamos ou diminuimos a velocidade da nave. QUando o jogador solta a tecla (evento do tipo <code class="highlight"><span class="n">pygame</span><span class="o">.</span><span class="n">KEYUP</span></code>), se a tecla apertada for a seta para a direita ou para a esquerda, nós desfazemos a ação daquela tecla (diminuir ou aumentar a velocidade da nave). Note que esses eventos só ocorrem no instante em que a tecla é apertada. Se o jogador apertar a tecla e não soltar, o evento <code class="highlight"><span class="n">pygame</span><span class="o">.</span><span class="n">KEYDOWN</span></code> só será recebido uma vez e assim a velocidade só vai aumentar uma vez.</p>
<div class="admonition example">
<h3 id="exercicio-10">EXERCÍCIO 10<a class="headerlink" href="#exercicio-10" title="Permanent link">&para;</a></h3>
<p>Modifique o <code class="highlight"><span class="n">jogo_v10</span><span class="o">.</span><span class="n">py</span></code> para que a nave se mova com metade da velocidade.</p>
</div>
<h2 id="tratamento-de-colisoes-da-nave-com-os-meteoros">Tratamento de colisões da nave com os meteoros<a class="headerlink" href="#tratamento-de-colisoes-da-nave-com-os-meteoros" title="Permanent link">&para;</a></h2>
<p>Já podemos movimentar a nave, mas quando um meteoro encosta na nave, nada acontece. Queremos que o jogo acabe quando um meteoro encostar na nave. O <code class="highlight"><span class="n">jogo_v11</span><span class="o">.</span><span class="n">py</span></code> implementa essa funcionalidade. O pygame disponibiliza uma função que verifica se houve uma colisão entre um sprite e um grupo de sprites, o <code class="highlight"><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">spritecollide</span></code>. Essa função recebe um sprite, um grupo de sprites e um valor booleano que indica se, ao ocorrer uma colisão, o elemento do grupo que colidiu com o sprite deve morrer ou não (morrer nesse caso significa que o sprite deixará de existir). As principais mudanças neste arquivo são:</p>
<details class="cite"><summary><code>referencia/jogo_v11.py</code></summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># ===== Inicialização =====</span>
<span class="c1"># ----- Importa e inicia pacotes</span>
<span class="kn">import</span> <span class="nn">pygame</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="n">pygame</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>

<span class="c1"># ----- Gera tela principal</span>
<span class="n">WIDTH</span> <span class="o">=</span> <span class="mi">480</span>
<span class="n">HEIGHT</span> <span class="o">=</span> <span class="mi">600</span>
<span class="n">window</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_mode</span><span class="p">((</span><span class="n">WIDTH</span><span class="p">,</span> <span class="n">HEIGHT</span><span class="p">))</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s1">&#39;Navinha&#39;</span><span class="p">)</span>

<span class="c1"># ----- Inicia assets</span>
<span class="n">METEOR_WIDTH</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">METEOR_HEIGHT</span> <span class="o">=</span> <span class="mi">38</span>
<span class="n">SHIP_WIDTH</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">SHIP_HEIGHT</span> <span class="o">=</span> <span class="mi">38</span>
<span class="n">font</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">SysFont</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">48</span><span class="p">)</span>
<span class="n">background</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/starfield.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span>
<span class="n">meteor_img</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/meteorBrown_med1.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert_alpha</span><span class="p">()</span>
<span class="n">meteor_img</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">meteor_img</span><span class="p">,</span> <span class="p">(</span><span class="n">METEOR_WIDTH</span><span class="p">,</span> <span class="n">METEOR_HEIGHT</span><span class="p">))</span>
<span class="n">ship_img</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/playerShip1_orange.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert_alpha</span><span class="p">()</span>
<span class="n">ship_img</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">ship_img</span><span class="p">,</span> <span class="p">(</span><span class="n">SHIP_WIDTH</span><span class="p">,</span> <span class="n">SHIP_HEIGHT</span><span class="p">))</span>

<span class="c1"># ----- Inicia estruturas de dados</span>
<span class="c1"># Definindo os novos tipos</span>
<span class="k">class</span> <span class="nc">Ship</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
        <span class="c1"># Construtor da classe mãe (Sprite).</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">img</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">centerx</span> <span class="o">=</span> <span class="n">WIDTH</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">bottom</span> <span class="o">=</span> <span class="n">HEIGHT</span> <span class="o">-</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Atualização da posição da nave</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span>

        <span class="c1"># Mantem dentro da tela</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">right</span> <span class="o">&gt;</span> <span class="n">WIDTH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">WIDTH</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">left</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">class</span> <span class="nc">Meteor</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
        <span class="c1"># Construtor da classe mãe (Sprite).</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">img</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">WIDTH</span><span class="o">-</span><span class="n">METEOR_WIDTH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="n">METEOR_HEIGHT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Atualizando a posição do meteoro</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span>
        <span class="c1"># Se o meteoro passar do final da tela, volta para cima e sorteia</span>
        <span class="c1"># novas posições e velocidades</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">top</span> <span class="o">&gt;</span> <span class="n">HEIGHT</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">right</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">left</span> <span class="o">&gt;</span> <span class="n">WIDTH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">WIDTH</span><span class="o">-</span><span class="n">METEOR_WIDTH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="n">METEOR_HEIGHT</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>

<span class="n">game</span> <span class="o">=</span> <span class="kc">True</span>
<span class="c1"># Variável para o ajuste de velocidade</span>
<span class="n">clock</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">Clock</span><span class="p">()</span>
<span class="n">FPS</span> <span class="o">=</span> <span class="mi">30</span>

<span class="c1"># Criando um grupo de meteoros</span>
<span class="n">all_sprites</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Group</span><span class="p">()</span>
<span class="n">all_meteors</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Group</span><span class="p">()</span>
<span class="c1"># Criando o jogador</span>
<span class="n">player</span> <span class="o">=</span> <span class="n">Ship</span><span class="p">(</span><span class="n">ship_img</span><span class="p">)</span>
<span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">player</span><span class="p">)</span>
<span class="c1"># Criando os meteoros</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
    <span class="n">meteor</span> <span class="o">=</span> <span class="n">Meteor</span><span class="p">(</span><span class="n">meteor_img</span><span class="p">)</span>
    <span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">meteor</span><span class="p">)</span>
    <span class="n">all_meteors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">meteor</span><span class="p">)</span>

<span class="c1"># ===== Loop principal =====</span>
<span class="k">while</span> <span class="n">game</span><span class="p">:</span>
    <span class="n">clock</span><span class="o">.</span><span class="n">tick</span><span class="p">(</span><span class="n">FPS</span><span class="p">)</span>

    <span class="c1"># ----- Trata eventos</span>
    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">pygame</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
        <span class="c1"># ----- Verifica consequências</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">QUIT</span><span class="p">:</span>
            <span class="n">game</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># Verifica se apertou alguma tecla.</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">KEYDOWN</span><span class="p">:</span>
            <span class="c1"># Dependendo da tecla, altera a velocidade.</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_LEFT</span><span class="p">:</span>
                <span class="n">player</span><span class="o">.</span><span class="n">speedx</span> <span class="o">-=</span> <span class="mi">8</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_RIGHT</span><span class="p">:</span>
                <span class="n">player</span><span class="o">.</span><span class="n">speedx</span> <span class="o">+=</span> <span class="mi">8</span>
        <span class="c1"># Verifica se soltou alguma tecla.</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">KEYUP</span><span class="p">:</span>
            <span class="c1"># Dependendo da tecla, altera a velocidade.</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_LEFT</span><span class="p">:</span>
                <span class="n">player</span><span class="o">.</span><span class="n">speedx</span> <span class="o">+=</span> <span class="mi">8</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_RIGHT</span><span class="p">:</span>
                <span class="n">player</span><span class="o">.</span><span class="n">speedx</span> <span class="o">-=</span> <span class="mi">8</span>

    <span class="c1"># ----- Atualiza estado do jogo</span>
    <span class="c1"># Atualizando a posição dos meteoros</span>
    <span class="n">all_sprites</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

    <span class="c1"># Verifica se houve colisão entre nave e meteoro</span>
    <span class="n">hits</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">spritecollide</span><span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="n">all_meteors</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

    <span class="c1"># ----- Gera saídas</span>
    <span class="n">window</span><span class="o">.</span><span class="n">fill</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>  <span class="c1"># Preenche com a cor branca</span>
    <span class="n">window</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">background</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="c1"># Desenhando meteoros</span>
    <span class="n">all_sprites</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>

    <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>  <span class="c1"># Mostra o novo frame para o jogador</span>

<span class="c1"># ===== Finalização =====</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>  <span class="c1"># Função do PyGame que finaliza os recursos utilizados</span>
</code></pre></div>
</td></tr></table>

</details>
<ul>
<li>Linhas 80 e 88: criação de mais um grupo de sprites. Cada meteoro é colocado em dois grupos, no grupo de todos os sprites (<code class="highlight"><span class="n">all_sprites</span></code>), que é utilizado para atualizar e desenhar todos os sprites na tela, e o grupo dos meteoros (<code class="highlight"><span class="n">all_meteors</span></code>), que será utilizado para verificar a colisão da nave com todos os meteoros de uma vez;</li>
<li>Linha 119: verifica a colisão do <code class="highlight"><span class="n">player</span></code> (nave) com o <code class="highlight"><span class="n">all_meteors</span></code>. A função retorna uma lista com todos os meteoros que colidiram com a nave. Se ela não estiver vazia significa que houve uma colisão.</li>
</ul>
<div class="admonition example">
<h3 id="exercicio-11">EXERCÍCIO 11<a class="headerlink" href="#exercicio-11" title="Permanent link">&para;</a></h3>
<p>A versão atual faz com que os meteoros morram ao encostar na nave, mas nada além disso acontece. Modifique o <code class="highlight"><span class="n">jogo_v11</span><span class="o">.</span><span class="n">py</span></code> para que o jogo acabe se a nave colidir com um meteoro (dica: basta verificar uma condição e modificar <code class="highlight"><span class="n">game</span></code> para <code class="highlight"><span class="kc">False</span></code>).</p>
</div>
<h2 id="fazendo-a-nave-atirar">Fazendo a nave atirar<a class="headerlink" href="#fazendo-a-nave-atirar" title="Permanent link">&para;</a></h2>
<p>Vamos implementar a funcionalidade de tiro. Queremos que um tiro seja criado quando o jogador apertar a tecla <code class="highlight"><span class="n">ESPAÇO</span></code>. Execute o <code class="highlight"><span class="n">jogo_v12</span><span class="o">.</span><span class="n">py</span></code> para ver o resultado. Depois abra o código.</p>
<details class="cite"><summary><code>referencia/jogo_v12.py</code></summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># ===== Inicialização =====</span>
<span class="c1"># ----- Importa e inicia pacotes</span>
<span class="kn">import</span> <span class="nn">pygame</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="n">pygame</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>

<span class="c1"># ----- Gera tela principal</span>
<span class="n">WIDTH</span> <span class="o">=</span> <span class="mi">480</span>
<span class="n">HEIGHT</span> <span class="o">=</span> <span class="mi">600</span>
<span class="n">window</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_mode</span><span class="p">((</span><span class="n">WIDTH</span><span class="p">,</span> <span class="n">HEIGHT</span><span class="p">))</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s1">&#39;Navinha&#39;</span><span class="p">)</span>

<span class="c1"># ----- Inicia assets</span>
<span class="n">METEOR_WIDTH</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">METEOR_HEIGHT</span> <span class="o">=</span> <span class="mi">38</span>
<span class="n">SHIP_WIDTH</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">SHIP_HEIGHT</span> <span class="o">=</span> <span class="mi">38</span>
<span class="n">font</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">SysFont</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">48</span><span class="p">)</span>
<span class="n">background</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/starfield.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span>
<span class="n">meteor_img</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/meteorBrown_med1.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert_alpha</span><span class="p">()</span>
<span class="n">meteor_img</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">meteor_img</span><span class="p">,</span> <span class="p">(</span><span class="n">METEOR_WIDTH</span><span class="p">,</span> <span class="n">METEOR_HEIGHT</span><span class="p">))</span>
<span class="n">ship_img</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/playerShip1_orange.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert_alpha</span><span class="p">()</span>
<span class="n">ship_img</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">ship_img</span><span class="p">,</span> <span class="p">(</span><span class="n">SHIP_WIDTH</span><span class="p">,</span> <span class="n">SHIP_HEIGHT</span><span class="p">))</span>
<span class="n">bullet_img</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/laserRed16.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert_alpha</span><span class="p">()</span>

<span class="c1"># ----- Inicia estruturas de dados</span>
<span class="c1"># Definindo os novos tipos</span>
<span class="k">class</span> <span class="nc">Ship</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">all_sprites</span><span class="p">,</span> <span class="n">all_bullets</span><span class="p">,</span> <span class="n">bullet_img</span><span class="p">):</span>
        <span class="c1"># Construtor da classe mãe (Sprite).</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">img</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">centerx</span> <span class="o">=</span> <span class="n">WIDTH</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">bottom</span> <span class="o">=</span> <span class="n">HEIGHT</span> <span class="o">-</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_sprites</span> <span class="o">=</span> <span class="n">all_sprites</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_bullets</span> <span class="o">=</span> <span class="n">all_bullets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bullet_img</span> <span class="o">=</span> <span class="n">bullet_img</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Atualização da posição da nave</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span>

        <span class="c1"># Mantem dentro da tela</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">right</span> <span class="o">&gt;</span> <span class="n">WIDTH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">WIDTH</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">left</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">shoot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># A nova bala vai ser criada logo acima e no centro horizontal da nave</span>
        <span class="n">new_bullet</span> <span class="o">=</span> <span class="n">Bullet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bullet_img</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">centerx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_bullet</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_bullets</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_bullet</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Meteor</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
        <span class="c1"># Construtor da classe mãe (Sprite).</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">img</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">WIDTH</span><span class="o">-</span><span class="n">METEOR_WIDTH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="n">METEOR_HEIGHT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Atualizando a posição do meteoro</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span>
        <span class="c1"># Se o meteoro passar do final da tela, volta para cima e sorteia</span>
        <span class="c1"># novas posições e velocidades</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">top</span> <span class="o">&gt;</span> <span class="n">HEIGHT</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">right</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">left</span> <span class="o">&gt;</span> <span class="n">WIDTH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">WIDTH</span><span class="o">-</span><span class="n">METEOR_WIDTH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="n">METEOR_HEIGHT</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>

<span class="c1"># Classe Bullet que representa os tiros</span>
<span class="k">class</span> <span class="nc">Bullet</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="c1"># Construtor da classe.</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">centerx</span><span class="p">):</span>
        <span class="c1"># Construtor da classe mãe (Sprite).</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">img</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>

        <span class="c1"># Coloca no lugar inicial definido em x, y do constutor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">centerx</span> <span class="o">=</span> <span class="n">centerx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">bottom</span> <span class="o">=</span> <span class="n">bottom</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span>  <span class="c1"># Velocidade fixa para cima</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># A bala só se move no eixo y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span>

        <span class="c1"># Se o tiro passar do inicio da tela, morre.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">bottom</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>

<span class="n">game</span> <span class="o">=</span> <span class="kc">True</span>
<span class="c1"># Variável para o ajuste de velocidade</span>
<span class="n">clock</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">Clock</span><span class="p">()</span>
<span class="n">FPS</span> <span class="o">=</span> <span class="mi">30</span>

<span class="c1"># Criando um grupo de meteoros</span>
<span class="n">all_sprites</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Group</span><span class="p">()</span>
<span class="n">all_meteors</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Group</span><span class="p">()</span>
<span class="n">all_bullets</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Group</span><span class="p">()</span>
<span class="c1"># Criando o jogador</span>
<span class="n">player</span> <span class="o">=</span> <span class="n">Ship</span><span class="p">(</span><span class="n">ship_img</span><span class="p">,</span> <span class="n">all_sprites</span><span class="p">,</span> <span class="n">all_bullets</span><span class="p">,</span> <span class="n">bullet_img</span><span class="p">)</span>
<span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">player</span><span class="p">)</span>
<span class="c1"># Criando os meteoros</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
    <span class="n">meteor</span> <span class="o">=</span> <span class="n">Meteor</span><span class="p">(</span><span class="n">meteor_img</span><span class="p">)</span>
    <span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">meteor</span><span class="p">)</span>
    <span class="n">all_meteors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">meteor</span><span class="p">)</span>

<span class="c1"># ===== Loop principal =====</span>
<span class="k">while</span> <span class="n">game</span><span class="p">:</span>
    <span class="n">clock</span><span class="o">.</span><span class="n">tick</span><span class="p">(</span><span class="n">FPS</span><span class="p">)</span>

    <span class="c1"># ----- Trata eventos</span>
    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">pygame</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
        <span class="c1"># ----- Verifica consequências</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">QUIT</span><span class="p">:</span>
            <span class="n">game</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># Verifica se apertou alguma tecla.</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">KEYDOWN</span><span class="p">:</span>
            <span class="c1"># Dependendo da tecla, altera a velocidade.</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_LEFT</span><span class="p">:</span>
                <span class="n">player</span><span class="o">.</span><span class="n">speedx</span> <span class="o">-=</span> <span class="mi">8</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_RIGHT</span><span class="p">:</span>
                <span class="n">player</span><span class="o">.</span><span class="n">speedx</span> <span class="o">+=</span> <span class="mi">8</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_SPACE</span><span class="p">:</span>
                <span class="n">player</span><span class="o">.</span><span class="n">shoot</span><span class="p">()</span>
        <span class="c1"># Verifica se soltou alguma tecla.</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">KEYUP</span><span class="p">:</span>
            <span class="c1"># Dependendo da tecla, altera a velocidade.</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_LEFT</span><span class="p">:</span>
                <span class="n">player</span><span class="o">.</span><span class="n">speedx</span> <span class="o">+=</span> <span class="mi">8</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_RIGHT</span><span class="p">:</span>
                <span class="n">player</span><span class="o">.</span><span class="n">speedx</span> <span class="o">-=</span> <span class="mi">8</span>

    <span class="c1"># ----- Atualiza estado do jogo</span>
    <span class="c1"># Atualizando a posição dos meteoros</span>
    <span class="n">all_sprites</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

    <span class="c1"># Verifica se houve colisão entre nave e meteoro</span>
    <span class="n">hits</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">spritecollide</span><span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="n">all_meteors</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hits</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">game</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># ----- Gera saídas</span>
    <span class="n">window</span><span class="o">.</span><span class="n">fill</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>  <span class="c1"># Preenche com a cor branca</span>
    <span class="n">window</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">background</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="c1"># Desenhando meteoros</span>
    <span class="n">all_sprites</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>

    <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>  <span class="c1"># Mostra o novo frame para o jogador</span>

<span class="c1"># ===== Finalização =====</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>  <span class="c1"># Função do PyGame que finaliza os recursos utilizados</span>
</code></pre></div>
</td></tr></table>

</details>
<p>Neste código, criamos um sprite <code class="highlight"><span class="n">Bullet</span></code> e um novo método <code class="highlight"><span class="n">shoot</span></code> na classe <code class="highlight"><span class="n">Ship</span></code>. Esse método será chamado sempre que quisermos que a nave atire. O problema é que o sprite precisa ser adicionado ao grupo de sprites para ser desenhado, mas como ele será criado dentro do método <code class="highlight"><span class="n">shoot</span></code>, nós não temos acesso às variáveis que estão no nosso programa. A solução para esse problema é guardar o grupo dentro do jogador. Assim, quando ele atirar ele já terá acesso ao grupo para adicionar a nova bala. Fazemos isso modificando o <code class="highlight"><span class="fm">__init__</span></code> (construtor) do <code class="highlight"><span class="n">Ship</span></code>. Além da imagem da nave ele passará a receber o grupo de todos os sprites, um grupo para guardar as balas e a imagem da bala. Esses valores são guardados dentro da nave nas linhas 39 a 41. Esses valores são utilizados pelo método <code class="highlight"><span class="n">shoot</span></code> (linhas 53 a 57). As principais mudanças nesta versão são:</p>
<ul>
<li>Linhas 30 e 39 a 41: quando é criada, a nave recebe o grupo de sprites, o grupo de balas e a imagem da bala. Ela armazena esses valores nos atributos (variáveis disponíveis no <code class="highlight"><span class="bp">self</span></code>) para usar quando o <code class="highlight"><span class="n">shoot</span></code> for chamado;</li>
<li>Linhas 53 a 57: método <code class="highlight"><span class="n">shoot</span></code>. Esse método será chamado quando a tecla espaço for apertada. Uma nova bala é criada e adicionada nos grupos de sprites e de balas;</li>
<li>Linhas 84 a 104: classe <code class="highlight"><span class="n">Bullet</span></code>. Uma bala só se move para cima com velocidade 10. Quando ela não está mais visível ela morre (<code class="highlight"><span class="bp">self</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span></code>);</li>
<li>Linhas 114 e 116: um novo grupo de balas é criado. O grupo de sprites, o grupo de balas e a imagem da bala são utilizadas para que um <code class="highlight"><span class="n">Ship</span></code> seja criado. Esse <code class="highlight"><span class="n">Ship</span></code> vai armazenar esses valores dentro de si mesmo;</li>
<li>Linhas 140 e 141: quando a tecla <code class="highlight"><span class="n">ESPAÇO</span></code> é apertada a nave atira.</li>
</ul>
<p>Note que não precisamos mudar as linhas que chamam o <code class="highlight"><span class="n">update</span></code> dos sprites e que desenham (<code class="highlight"><span class="n">draw</span></code>) todos os sprites, pois as balas também serão adicionadas no grupo de todos os sprites (<code class="highlight"><span class="n">all_sprites</span></code>).</p>
<div class="admonition example">
<h3 id="exercicio-12">EXERCÍCIO 12<a class="headerlink" href="#exercicio-12" title="Permanent link">&para;</a></h3>
<p>As balas ainda não tem nenhum efeito sobre os meteoros. Implemente a colisão das balas com os meteoros. A função <code class="highlight"><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">spritecollide</span></code> verificava se <strong>um</strong> sprite havia colidido com <strong>algum sprite de um grupo</strong>. Agora queremos verificar se <strong>algum sprite do grupo</strong> de balas colidiu com <strong>algum sprite do grupo</strong> de meteoros. Para isso temos a função <code class="highlight"><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">groupcollide</span></code>, que recebe dois grupos de sprites e dois valores booleanos (<code class="highlight"><span class="kc">True</span></code> ou <code class="highlight"><span class="kc">False</span></code>) que indicam se um elemento do primeiro grupo deve morrer ao colidir com algum elemento do segundo grupo e vice-versa.</p>
<p><strong>Importante:</strong> essa função retorna um dicionário no qual as chaves são elementos do primeiro grupo (primeiro argumento da função) e os valores são listas de elementos do segundo grupo (segundo argumento) que colidiram com ele. Se esse dicionário estiver vazio significa que não houve nenhuma colisão entre os dois grupos.</p>
<p>Faça com que, ao colidirem, tanto a bala, quanto o meteoro morram. Você vai notar que depois de um tempo não haverá mais nenhum meteoro. Não se preocupe com isso por enquanto.</p>
</div>
<h2 id="adicionando-som">Adicionando som<a class="headerlink" href="#adicionando-som" title="Permanent link">&para;</a></h2>
<p>O pygame também é capaz de tocar sons. Para isso, além de carregar os arquivos de áudio, é necessário inicializar o uso de sons no pygame com a função <code class="highlight"><span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">init</span><span class="p">()</span></code>. O <code class="highlight"><span class="n">jogo_v13</span><span class="o">.</span><span class="n">py</span></code> implementa os sons de explosão e tiro da nave. As principais modificações são:</p>
<details class="cite"><summary><code>referencia/jogo_v13.py</code></summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># ===== Inicialização =====</span>
<span class="c1"># ----- Importa e inicia pacotes</span>
<span class="kn">import</span> <span class="nn">pygame</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">pygame</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>

<span class="c1"># ----- Gera tela principal</span>
<span class="n">WIDTH</span> <span class="o">=</span> <span class="mi">480</span>
<span class="n">HEIGHT</span> <span class="o">=</span> <span class="mi">600</span>
<span class="n">window</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_mode</span><span class="p">((</span><span class="n">WIDTH</span><span class="p">,</span> <span class="n">HEIGHT</span><span class="p">))</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s1">&#39;Navinha&#39;</span><span class="p">)</span>

<span class="c1"># ----- Inicia assets</span>
<span class="n">METEOR_WIDTH</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">METEOR_HEIGHT</span> <span class="o">=</span> <span class="mi">38</span>
<span class="n">SHIP_WIDTH</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">SHIP_HEIGHT</span> <span class="o">=</span> <span class="mi">38</span>
<span class="n">font</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">SysFont</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">48</span><span class="p">)</span>
<span class="n">background</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/starfield.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span>
<span class="n">meteor_img</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/meteorBrown_med1.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert_alpha</span><span class="p">()</span>
<span class="n">meteor_img</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">meteor_img</span><span class="p">,</span> <span class="p">(</span><span class="n">METEOR_WIDTH</span><span class="p">,</span> <span class="n">METEOR_HEIGHT</span><span class="p">))</span>
<span class="n">ship_img</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/playerShip1_orange.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert_alpha</span><span class="p">()</span>
<span class="n">ship_img</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">ship_img</span><span class="p">,</span> <span class="p">(</span><span class="n">SHIP_WIDTH</span><span class="p">,</span> <span class="n">SHIP_HEIGHT</span><span class="p">))</span>
<span class="n">bullet_img</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/laserRed16.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert_alpha</span><span class="p">()</span>

<span class="c1"># Carrega os sons do jogo</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">music</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/snd/tgfcoder-FrozenJam-SeamlessLoop.ogg&#39;</span><span class="p">)</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">music</span><span class="o">.</span><span class="n">set_volume</span><span class="p">(</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">boom_sound</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">Sound</span><span class="p">(</span><span class="s1">&#39;assets/snd/expl3.wav&#39;</span><span class="p">)</span>
<span class="n">destroy_sound</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">Sound</span><span class="p">(</span><span class="s1">&#39;assets/snd/expl6.wav&#39;</span><span class="p">)</span>
<span class="n">pew_sound</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">Sound</span><span class="p">(</span><span class="s1">&#39;assets/snd/pew.wav&#39;</span><span class="p">)</span>

<span class="c1"># ----- Inicia estruturas de dados</span>
<span class="c1"># Definindo os novos tipos</span>
<span class="k">class</span> <span class="nc">Ship</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">all_sprites</span><span class="p">,</span> <span class="n">all_bullets</span><span class="p">,</span> <span class="n">bullet_img</span><span class="p">,</span> <span class="n">pew_sound</span><span class="p">):</span>
        <span class="c1"># Construtor da classe mãe (Sprite).</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">img</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">centerx</span> <span class="o">=</span> <span class="n">WIDTH</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">bottom</span> <span class="o">=</span> <span class="n">HEIGHT</span> <span class="o">-</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_sprites</span> <span class="o">=</span> <span class="n">all_sprites</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_bullets</span> <span class="o">=</span> <span class="n">all_bullets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bullet_img</span> <span class="o">=</span> <span class="n">bullet_img</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pew_sound</span> <span class="o">=</span> <span class="n">pew_sound</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Atualização da posição da nave</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span>

        <span class="c1"># Mantem dentro da tela</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">right</span> <span class="o">&gt;</span> <span class="n">WIDTH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">WIDTH</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">left</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">shoot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># A nova bala vai ser criada logo acima e no centro horizontal da nave</span>
        <span class="n">new_bullet</span> <span class="o">=</span> <span class="n">Bullet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bullet_img</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">centerx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_bullet</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_bullets</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_bullet</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pew_sound</span><span class="o">.</span><span class="n">play</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Meteor</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
        <span class="c1"># Construtor da classe mãe (Sprite).</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">img</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">WIDTH</span><span class="o">-</span><span class="n">METEOR_WIDTH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="n">METEOR_HEIGHT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Atualizando a posição do meteoro</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span>
        <span class="c1"># Se o meteoro passar do final da tela, volta para cima e sorteia</span>
        <span class="c1"># novas posições e velocidades</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">top</span> <span class="o">&gt;</span> <span class="n">HEIGHT</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">right</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">left</span> <span class="o">&gt;</span> <span class="n">WIDTH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">WIDTH</span><span class="o">-</span><span class="n">METEOR_WIDTH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="n">METEOR_HEIGHT</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>

<span class="c1"># Classe Bullet que representa os tiros</span>
<span class="k">class</span> <span class="nc">Bullet</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="c1"># Construtor da classe.</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">centerx</span><span class="p">):</span>
        <span class="c1"># Construtor da classe mãe (Sprite).</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">img</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>

        <span class="c1"># Coloca no lugar inicial definido em x, y do constutor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">centerx</span> <span class="o">=</span> <span class="n">centerx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">bottom</span> <span class="o">=</span> <span class="n">bottom</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span>  <span class="c1"># Velocidade fixa para cima</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># A bala só se move no eixo y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span>

        <span class="c1"># Se o tiro passar do inicio da tela, morre.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">bottom</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>

<span class="n">game</span> <span class="o">=</span> <span class="kc">True</span>
<span class="c1"># Variável para o ajuste de velocidade</span>
<span class="n">clock</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">Clock</span><span class="p">()</span>
<span class="n">FPS</span> <span class="o">=</span> <span class="mi">30</span>

<span class="c1"># Criando um grupo de meteoros</span>
<span class="n">all_sprites</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Group</span><span class="p">()</span>
<span class="n">all_meteors</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Group</span><span class="p">()</span>
<span class="n">all_bullets</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Group</span><span class="p">()</span>
<span class="c1"># Criando o jogador</span>
<span class="n">player</span> <span class="o">=</span> <span class="n">Ship</span><span class="p">(</span><span class="n">ship_img</span><span class="p">,</span> <span class="n">all_sprites</span><span class="p">,</span> <span class="n">all_bullets</span><span class="p">,</span> <span class="n">bullet_img</span><span class="p">,</span> <span class="n">pew_sound</span><span class="p">)</span>
<span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">player</span><span class="p">)</span>
<span class="c1"># Criando os meteoros</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
    <span class="n">meteor</span> <span class="o">=</span> <span class="n">Meteor</span><span class="p">(</span><span class="n">meteor_img</span><span class="p">)</span>
    <span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">meteor</span><span class="p">)</span>
    <span class="n">all_meteors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">meteor</span><span class="p">)</span>

<span class="c1"># ===== Loop principal =====</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">music</span><span class="o">.</span><span class="n">play</span><span class="p">(</span><span class="n">loops</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="k">while</span> <span class="n">game</span><span class="p">:</span>
    <span class="n">clock</span><span class="o">.</span><span class="n">tick</span><span class="p">(</span><span class="n">FPS</span><span class="p">)</span>

    <span class="c1"># ----- Trata eventos</span>
    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">pygame</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
        <span class="c1"># ----- Verifica consequências</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">QUIT</span><span class="p">:</span>
            <span class="n">game</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># Verifica se apertou alguma tecla.</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">KEYDOWN</span><span class="p">:</span>
            <span class="c1"># Dependendo da tecla, altera a velocidade.</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_LEFT</span><span class="p">:</span>
                <span class="n">player</span><span class="o">.</span><span class="n">speedx</span> <span class="o">-=</span> <span class="mi">8</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_RIGHT</span><span class="p">:</span>
                <span class="n">player</span><span class="o">.</span><span class="n">speedx</span> <span class="o">+=</span> <span class="mi">8</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_SPACE</span><span class="p">:</span>
                <span class="n">player</span><span class="o">.</span><span class="n">shoot</span><span class="p">()</span>
        <span class="c1"># Verifica se soltou alguma tecla.</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">KEYUP</span><span class="p">:</span>
            <span class="c1"># Dependendo da tecla, altera a velocidade.</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_LEFT</span><span class="p">:</span>
                <span class="n">player</span><span class="o">.</span><span class="n">speedx</span> <span class="o">+=</span> <span class="mi">8</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_RIGHT</span><span class="p">:</span>
                <span class="n">player</span><span class="o">.</span><span class="n">speedx</span> <span class="o">-=</span> <span class="mi">8</span>

    <span class="c1"># ----- Atualiza estado do jogo</span>
    <span class="c1"># Atualizando a posição dos meteoros</span>
    <span class="n">all_sprites</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

    <span class="c1"># Verifica se houve colisão entre tiro e meteoro</span>
    <span class="n">hits</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">groupcollide</span><span class="p">(</span><span class="n">all_meteors</span><span class="p">,</span> <span class="n">all_bullets</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">meteor</span> <span class="ow">in</span> <span class="n">hits</span><span class="p">:</span> <span class="c1"># As chaves são os elementos do primeiro grupo (meteoros) que colidiram com alguma bala</span>
        <span class="c1"># O meteoro e destruido e precisa ser recriado</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">Meteor</span><span class="p">(</span><span class="n">meteor_img</span><span class="p">)</span>
        <span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="n">all_meteors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

    <span class="c1"># Verifica se houve colisão entre nave e meteoro</span>
    <span class="n">hits</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">spritecollide</span><span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="n">all_meteors</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hits</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># Toca o som da colisão</span>
        <span class="n">boom_sound</span><span class="o">.</span><span class="n">play</span><span class="p">()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># Precisa esperar senão fecha</span>

        <span class="n">game</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># ----- Gera saídas</span>
    <span class="n">window</span><span class="o">.</span><span class="n">fill</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>  <span class="c1"># Preenche com a cor branca</span>
    <span class="n">window</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">background</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="c1"># Desenhando meteoros</span>
    <span class="n">all_sprites</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>

    <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>  <span class="c1"># Mostra o novo frame para o jogador</span>

<span class="c1"># ===== Finalização =====</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>  <span class="c1"># Função do PyGame que finaliza os recursos utilizados</span>
</code></pre></div>
</td></tr></table>

</details>
<ul>
<li>Linha 8: inicialização do módulo de áudio do pygame;</li>
<li>Linhas 30 a 34: carrega os arquivos de áudio;</li>
<li>Linhas 39 e 51: <code class="highlight"><span class="n">Ship</span></code> recebe o som do tiro como argumento extra e armazena como atributo;</li>
<li>Linha 68: toca o som do tiro;</li>
<li>Linha 136: começa a tocar o som de fundo em loop;</li>
<li>Linhas 167 a 172: implementa o exercício 12. Verifica as colisões entre todos os meteoros e todas as balas. Para cada meteoro que colidiu é criado um novo meteoro para substituí-lo;</li>
<li>Linhas 178 e 179: toca o som de explosão da nave e espera 1 segundo para o som terminar de tocar antes de finalizar o jogo.</li>
</ul>
<div class="admonition example">
<h3 id="exercicio-13">EXERCÍCIO 13<a class="headerlink" href="#exercicio-13" title="Permanent link">&para;</a></h3>
<p>Modifique o <code class="highlight"><span class="n">jogo_v13</span><span class="o">.</span><span class="n">py</span></code> para tocar o <code class="highlight"><span class="n">destroy_sound</span></code> sempre que um meteoro for destruído.</p>
</div>
<h2 id="refatorando-mais-uma-vez-o-codigo">Refatorando mais uma vez o código<a class="headerlink" href="#refatorando-mais-uma-vez-o-codigo" title="Permanent link">&para;</a></h2>
<p>O código já está bastante complexo. Lembrando que é sempre uma boa prática tomar um tempo para melhorar o código antes que ele se torne um caos completo, vamos refatorá-lo mais um pouco. Um dos problemas é a quantidade de argumentos que precisamos passar quando criamos um <code class="highlight"><span class="n">Ship</span></code> (e tudo isso só por causa do tiro). Além disso, temos diversas variáveis para as imagens e sons que carregamos.</p>
<p>No arquivo <code class="highlight"><span class="n">jogo_v14</span><span class="o">.</span><span class="n">py</span></code> adicionamos todos os assets em um novo dicionário <code class="highlight"><span class="n">assets</span></code> e os grupos em um dicionário <code class="highlight"><span class="n">groups</span></code>. Agora é possível diminuir a quantidade de argumentos recebidos na construção do <code class="highlight"><span class="n">Ship</span></code> sem ser necessário carregar os assets todas as vezes.</p>
<details class="cite"><summary><code>referencia/jogo_v14.py</code></summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># ===== Inicialização =====</span>
<span class="c1"># ----- Importa e inicia pacotes</span>
<span class="kn">import</span> <span class="nn">pygame</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">pygame</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>

<span class="c1"># ----- Gera tela principal</span>
<span class="n">WIDTH</span> <span class="o">=</span> <span class="mi">480</span>
<span class="n">HEIGHT</span> <span class="o">=</span> <span class="mi">600</span>
<span class="n">window</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_mode</span><span class="p">((</span><span class="n">WIDTH</span><span class="p">,</span> <span class="n">HEIGHT</span><span class="p">))</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s1">&#39;Navinha&#39;</span><span class="p">)</span>

<span class="c1"># ----- Inicia assets</span>
<span class="n">METEOR_WIDTH</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">METEOR_HEIGHT</span> <span class="o">=</span> <span class="mi">38</span>
<span class="n">SHIP_WIDTH</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">SHIP_HEIGHT</span> <span class="o">=</span> <span class="mi">38</span>
<span class="n">assets</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;background&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/starfield.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;meteor_img&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/meteorBrown_med1.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert_alpha</span><span class="p">()</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;meteor_img&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">assets</span><span class="p">[</span><span class="s1">&#39;meteor_img&#39;</span><span class="p">],</span> <span class="p">(</span><span class="n">METEOR_WIDTH</span><span class="p">,</span> <span class="n">METEOR_HEIGHT</span><span class="p">))</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;ship_img&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/playerShip1_orange.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert_alpha</span><span class="p">()</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;ship_img&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">assets</span><span class="p">[</span><span class="s1">&#39;ship_img&#39;</span><span class="p">],</span> <span class="p">(</span><span class="n">SHIP_WIDTH</span><span class="p">,</span> <span class="n">SHIP_HEIGHT</span><span class="p">))</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;bullet_img&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/laserRed16.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert_alpha</span><span class="p">()</span>

<span class="c1"># Carrega os sons do jogo</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">music</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/snd/tgfcoder-FrozenJam-SeamlessLoop.ogg&#39;</span><span class="p">)</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">music</span><span class="o">.</span><span class="n">set_volume</span><span class="p">(</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">boom_sound</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">Sound</span><span class="p">(</span><span class="s1">&#39;assets/snd/expl3.wav&#39;</span><span class="p">)</span>
<span class="n">destroy_sound</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">Sound</span><span class="p">(</span><span class="s1">&#39;assets/snd/expl6.wav&#39;</span><span class="p">)</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;pew_sound&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">Sound</span><span class="p">(</span><span class="s1">&#39;assets/snd/pew.wav&#39;</span><span class="p">)</span>

<span class="c1"># ----- Inicia estruturas de dados</span>
<span class="c1"># Definindo os novos tipos</span>
<span class="k">class</span> <span class="nc">Ship</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">assets</span><span class="p">):</span>
        <span class="c1"># Construtor da classe mãe (Sprite).</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;ship_img&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">centerx</span> <span class="o">=</span> <span class="n">WIDTH</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">bottom</span> <span class="o">=</span> <span class="n">HEIGHT</span> <span class="o">-</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groups</span> <span class="o">=</span> <span class="n">groups</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assets</span> <span class="o">=</span> <span class="n">assets</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Atualização da posição da nave</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span>

        <span class="c1"># Mantem dentro da tela</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">right</span> <span class="o">&gt;</span> <span class="n">WIDTH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">WIDTH</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">left</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">shoot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># A nova bala vai ser criada logo acima e no centro horizontal da nave</span>
        <span class="n">new_bullet</span> <span class="o">=</span> <span class="n">Bullet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assets</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">centerx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="s1">&#39;all_sprites&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_bullet</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="s1">&#39;all_bullets&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_bullet</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assets</span><span class="p">[</span><span class="s1">&#39;pew_sound&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">play</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Meteor</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">assets</span><span class="p">):</span>
        <span class="c1"># Construtor da classe mãe (Sprite).</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;meteor_img&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">WIDTH</span><span class="o">-</span><span class="n">METEOR_WIDTH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="n">METEOR_HEIGHT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Atualizando a posição do meteoro</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span>
        <span class="c1"># Se o meteoro passar do final da tela, volta para cima e sorteia</span>
        <span class="c1"># novas posições e velocidades</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">top</span> <span class="o">&gt;</span> <span class="n">HEIGHT</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">right</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">left</span> <span class="o">&gt;</span> <span class="n">WIDTH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">WIDTH</span><span class="o">-</span><span class="n">METEOR_WIDTH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="n">METEOR_HEIGHT</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>

<span class="c1"># Classe Bullet que representa os tiros</span>
<span class="k">class</span> <span class="nc">Bullet</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="c1"># Construtor da classe.</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">assets</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">centerx</span><span class="p">):</span>
        <span class="c1"># Construtor da classe mãe (Sprite).</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;bullet_img&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>

        <span class="c1"># Coloca no lugar inicial definido em x, y do constutor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">centerx</span> <span class="o">=</span> <span class="n">centerx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">bottom</span> <span class="o">=</span> <span class="n">bottom</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span>  <span class="c1"># Velocidade fixa para cima</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># A bala só se move no eixo y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span>

        <span class="c1"># Se o tiro passar do inicio da tela, morre.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">bottom</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>

<span class="n">game</span> <span class="o">=</span> <span class="kc">True</span>
<span class="c1"># Variável para o ajuste de velocidade</span>
<span class="n">clock</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">Clock</span><span class="p">()</span>
<span class="n">FPS</span> <span class="o">=</span> <span class="mi">30</span>

<span class="c1"># Criando um grupo de meteoros</span>
<span class="n">all_sprites</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Group</span><span class="p">()</span>
<span class="n">all_meteors</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Group</span><span class="p">()</span>
<span class="n">all_bullets</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Group</span><span class="p">()</span>
<span class="n">groups</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">groups</span><span class="p">[</span><span class="s1">&#39;all_sprites&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_sprites</span>
<span class="n">groups</span><span class="p">[</span><span class="s1">&#39;all_meteors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_meteors</span>
<span class="n">groups</span><span class="p">[</span><span class="s1">&#39;all_bullets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_bullets</span>

<span class="c1"># Criando o jogador</span>
<span class="n">player</span> <span class="o">=</span> <span class="n">Ship</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="n">assets</span><span class="p">)</span>
<span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">player</span><span class="p">)</span>
<span class="c1"># Criando os meteoros</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
    <span class="n">meteor</span> <span class="o">=</span> <span class="n">Meteor</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span>
    <span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">meteor</span><span class="p">)</span>
    <span class="n">all_meteors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">meteor</span><span class="p">)</span>

<span class="c1"># ===== Loop principal =====</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">music</span><span class="o">.</span><span class="n">play</span><span class="p">(</span><span class="n">loops</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="k">while</span> <span class="n">game</span><span class="p">:</span>
    <span class="n">clock</span><span class="o">.</span><span class="n">tick</span><span class="p">(</span><span class="n">FPS</span><span class="p">)</span>

    <span class="c1"># ----- Trata eventos</span>
    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">pygame</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
        <span class="c1"># ----- Verifica consequências</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">QUIT</span><span class="p">:</span>
            <span class="n">game</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># Verifica se apertou alguma tecla.</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">KEYDOWN</span><span class="p">:</span>
            <span class="c1"># Dependendo da tecla, altera a velocidade.</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_LEFT</span><span class="p">:</span>
                <span class="n">player</span><span class="o">.</span><span class="n">speedx</span> <span class="o">-=</span> <span class="mi">8</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_RIGHT</span><span class="p">:</span>
                <span class="n">player</span><span class="o">.</span><span class="n">speedx</span> <span class="o">+=</span> <span class="mi">8</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_SPACE</span><span class="p">:</span>
                <span class="n">player</span><span class="o">.</span><span class="n">shoot</span><span class="p">()</span>
        <span class="c1"># Verifica se soltou alguma tecla.</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">KEYUP</span><span class="p">:</span>
            <span class="c1"># Dependendo da tecla, altera a velocidade.</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_LEFT</span><span class="p">:</span>
                <span class="n">player</span><span class="o">.</span><span class="n">speedx</span> <span class="o">+=</span> <span class="mi">8</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_RIGHT</span><span class="p">:</span>
                <span class="n">player</span><span class="o">.</span><span class="n">speedx</span> <span class="o">-=</span> <span class="mi">8</span>

    <span class="c1"># ----- Atualiza estado do jogo</span>
    <span class="c1"># Atualizando a posição dos meteoros</span>
    <span class="n">all_sprites</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

    <span class="c1"># Verifica se houve colisão entre tiro e meteoro</span>
    <span class="n">hits</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">groupcollide</span><span class="p">(</span><span class="n">all_meteors</span><span class="p">,</span> <span class="n">all_bullets</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">meteor</span> <span class="ow">in</span> <span class="n">hits</span><span class="p">:</span> <span class="c1"># As chaves são os elementos do primeiro grupo (meteoros) que colidiram com alguma bala</span>
        <span class="c1"># O meteoro e destruido e precisa ser recriado</span>
        <span class="n">destroy_sound</span><span class="o">.</span><span class="n">play</span><span class="p">()</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">Meteor</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span>
        <span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="n">all_meteors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

    <span class="c1"># Verifica se houve colisão entre nave e meteoro</span>
    <span class="n">hits</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">spritecollide</span><span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="n">all_meteors</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hits</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># Toca o som da colisão</span>
        <span class="n">boom_sound</span><span class="o">.</span><span class="n">play</span><span class="p">()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># Precisa esperar senão fecha</span>

        <span class="n">game</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># ----- Gera saídas</span>
    <span class="n">window</span><span class="o">.</span><span class="n">fill</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>  <span class="c1"># Preenche com a cor branca</span>
    <span class="n">window</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">assets</span><span class="p">[</span><span class="s1">&#39;background&#39;</span><span class="p">],</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="c1"># Desenhando meteoros</span>
    <span class="n">all_sprites</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>

    <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>  <span class="c1"># Mostra o novo frame para o jogador</span>

<span class="c1"># ===== Finalização =====</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>  <span class="c1"># Função do PyGame que finaliza os recursos utilizados</span>
</code></pre></div>
</td></tr></table>

</details>
<div class="admonition example">
<h3 id="exercicio-14">EXERCÍCIO 14<a class="headerlink" href="#exercicio-14" title="Permanent link">&para;</a></h3>
<p>Os sons <code class="highlight"><span class="n">boom_sound</span></code> e <code class="highlight"><span class="n">destroy_sound</span></code> ainda não estão armazenados em <code class="highlight"><span class="n">assets</span></code>. Para manter a consistência, adicione-os no dicionário e atualize o código necessário (onde esses sons são tocados).</p>
</div>
<h2 id="adicionando-animacoes">Adicionando animações<a class="headerlink" href="#adicionando-animacoes" title="Permanent link">&para;</a></h2>
<p>As imagens do nosso jogo ainda são muito estáticas. Elas se movem pela tela, mas são sempre as mesmas. Vamos adicionar uma animação de explosão. Para isso, vamos criar um novo sprite que atualiza a imagem em intervalos fixos de tempo. O <code class="highlight"><span class="n">jogo_v15</span><span class="o">.</span><span class="n">py</span></code> implementa essa animação. As principais mudanças são:</p>
<details class="cite"><summary><code>referencia/jogo_v15.py</code></summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># ===== Inicialização =====</span>
<span class="c1"># ----- Importa e inicia pacotes</span>
<span class="kn">import</span> <span class="nn">pygame</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">pygame</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>

<span class="c1"># ----- Gera tela principal</span>
<span class="n">WIDTH</span> <span class="o">=</span> <span class="mi">480</span>
<span class="n">HEIGHT</span> <span class="o">=</span> <span class="mi">600</span>
<span class="n">window</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_mode</span><span class="p">((</span><span class="n">WIDTH</span><span class="p">,</span> <span class="n">HEIGHT</span><span class="p">))</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s1">&#39;Navinha&#39;</span><span class="p">)</span>

<span class="c1"># ----- Inicia assets</span>
<span class="n">METEOR_WIDTH</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">METEOR_HEIGHT</span> <span class="o">=</span> <span class="mi">38</span>
<span class="n">SHIP_WIDTH</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">SHIP_HEIGHT</span> <span class="o">=</span> <span class="mi">38</span>
<span class="n">assets</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;background&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/starfield.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;meteor_img&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/meteorBrown_med1.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert_alpha</span><span class="p">()</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;meteor_img&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">assets</span><span class="p">[</span><span class="s1">&#39;meteor_img&#39;</span><span class="p">],</span> <span class="p">(</span><span class="n">METEOR_WIDTH</span><span class="p">,</span> <span class="n">METEOR_HEIGHT</span><span class="p">))</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;ship_img&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/playerShip1_orange.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert_alpha</span><span class="p">()</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;ship_img&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">assets</span><span class="p">[</span><span class="s1">&#39;ship_img&#39;</span><span class="p">],</span> <span class="p">(</span><span class="n">SHIP_WIDTH</span><span class="p">,</span> <span class="n">SHIP_HEIGHT</span><span class="p">))</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;bullet_img&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/laserRed16.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert_alpha</span><span class="p">()</span>
<span class="n">explosion_anim</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">):</span>
    <span class="c1"># Os arquivos de animação são numerados de 00 a 08</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;assets/img/regularExplosion0</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">))</span>
    <span class="n">explosion_anim</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<span class="n">assets</span><span class="p">[</span><span class="s2">&quot;explosion_anim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">explosion_anim</span>

<span class="c1"># Carrega os sons do jogo</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">music</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/snd/tgfcoder-FrozenJam-SeamlessLoop.ogg&#39;</span><span class="p">)</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">music</span><span class="o">.</span><span class="n">set_volume</span><span class="p">(</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;boom_sound&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">Sound</span><span class="p">(</span><span class="s1">&#39;assets/snd/expl3.wav&#39;</span><span class="p">)</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;destroy_sound&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">Sound</span><span class="p">(</span><span class="s1">&#39;assets/snd/expl6.wav&#39;</span><span class="p">)</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;pew_sound&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">Sound</span><span class="p">(</span><span class="s1">&#39;assets/snd/pew.wav&#39;</span><span class="p">)</span>

<span class="c1"># ----- Inicia estruturas de dados</span>
<span class="c1"># Definindo os novos tipos</span>
<span class="k">class</span> <span class="nc">Ship</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">assets</span><span class="p">):</span>
        <span class="c1"># Construtor da classe mãe (Sprite).</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;ship_img&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">centerx</span> <span class="o">=</span> <span class="n">WIDTH</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">bottom</span> <span class="o">=</span> <span class="n">HEIGHT</span> <span class="o">-</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groups</span> <span class="o">=</span> <span class="n">groups</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assets</span> <span class="o">=</span> <span class="n">assets</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Atualização da posição da nave</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span>

        <span class="c1"># Mantem dentro da tela</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">right</span> <span class="o">&gt;</span> <span class="n">WIDTH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">WIDTH</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">left</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">shoot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># A nova bala vai ser criada logo acima e no centro horizontal da nave</span>
        <span class="n">new_bullet</span> <span class="o">=</span> <span class="n">Bullet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assets</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">centerx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="s1">&#39;all_sprites&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_bullet</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="s1">&#39;all_bullets&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_bullet</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assets</span><span class="p">[</span><span class="s1">&#39;pew_sound&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">play</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Meteor</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">assets</span><span class="p">):</span>
        <span class="c1"># Construtor da classe mãe (Sprite).</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;meteor_img&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">WIDTH</span><span class="o">-</span><span class="n">METEOR_WIDTH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="n">METEOR_HEIGHT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Atualizando a posição do meteoro</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span>
        <span class="c1"># Se o meteoro passar do final da tela, volta para cima e sorteia</span>
        <span class="c1"># novas posições e velocidades</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">top</span> <span class="o">&gt;</span> <span class="n">HEIGHT</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">right</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">left</span> <span class="o">&gt;</span> <span class="n">WIDTH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">WIDTH</span><span class="o">-</span><span class="n">METEOR_WIDTH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="n">METEOR_HEIGHT</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>

<span class="c1"># Classe Bullet que representa os tiros</span>
<span class="k">class</span> <span class="nc">Bullet</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="c1"># Construtor da classe.</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">assets</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">centerx</span><span class="p">):</span>
        <span class="c1"># Construtor da classe mãe (Sprite).</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;bullet_img&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>

        <span class="c1"># Coloca no lugar inicial definido em x, y do constutor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">centerx</span> <span class="o">=</span> <span class="n">centerx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">bottom</span> <span class="o">=</span> <span class="n">bottom</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span>  <span class="c1"># Velocidade fixa para cima</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># A bala só se move no eixo y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span>

        <span class="c1"># Se o tiro passar do inicio da tela, morre.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">bottom</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>

<span class="c1"># Classe que representa uma explosão de meteoro</span>
<span class="k">class</span> <span class="nc">Explosion</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="c1"># Construtor da classe.</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">assets</span><span class="p">):</span>
        <span class="c1"># Construtor da classe mãe (Sprite).</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Armazena a animação de explosão</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">explosion_anim</span> <span class="o">=</span> <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;explosion_anim&#39;</span><span class="p">]</span>

        <span class="c1"># Inicia o processo de animação colocando a primeira imagem na tela.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Armazena o índice atual na animação</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">explosion_anim</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">]</span>  <span class="c1"># Pega a primeira imagem</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">center</span>  <span class="c1"># Posiciona o centro da imagem</span>

        <span class="c1"># Guarda o tick da primeira imagem, ou seja, o momento em que a imagem foi mostrada</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_update</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span>

        <span class="c1"># Controle de ticks de animação: troca de imagem a cada self.frame_ticks milissegundos.</span>
        <span class="c1"># Quando pygame.time.get_ticks() - self.last_update &gt; self.frame_ticks a</span>
        <span class="c1"># próxima imagem da animação será mostrada</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame_ticks</span> <span class="o">=</span> <span class="mi">50</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Verifica o tick atual.</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span>
        <span class="c1"># Verifica quantos ticks se passaram desde a ultima mudança de frame.</span>
        <span class="n">elapsed_ticks</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_update</span>

        <span class="c1"># Se já está na hora de mudar de imagem...</span>
        <span class="k">if</span> <span class="n">elapsed_ticks</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_ticks</span><span class="p">:</span>
            <span class="c1"># Marca o tick da nova imagem.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_update</span> <span class="o">=</span> <span class="n">now</span>

            <span class="c1"># Avança um quadro.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># Verifica se já chegou no final da animação.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">explosion_anim</span><span class="p">):</span>
                <span class="c1"># Se sim, tchau explosão!</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Se ainda não chegou ao fim da explosão, troca de imagem.</span>
                <span class="n">center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">center</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">explosion_anim</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">center</span>

<span class="n">game</span> <span class="o">=</span> <span class="kc">True</span>
<span class="c1"># Variável para o ajuste de velocidade</span>
<span class="n">clock</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">Clock</span><span class="p">()</span>
<span class="n">FPS</span> <span class="o">=</span> <span class="mi">30</span>

<span class="c1"># Criando um grupo de meteoros</span>
<span class="n">all_sprites</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Group</span><span class="p">()</span>
<span class="n">all_meteors</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Group</span><span class="p">()</span>
<span class="n">all_bullets</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Group</span><span class="p">()</span>
<span class="n">groups</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">groups</span><span class="p">[</span><span class="s1">&#39;all_sprites&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_sprites</span>
<span class="n">groups</span><span class="p">[</span><span class="s1">&#39;all_meteors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_meteors</span>
<span class="n">groups</span><span class="p">[</span><span class="s1">&#39;all_bullets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_bullets</span>

<span class="c1"># Criando o jogador</span>
<span class="n">player</span> <span class="o">=</span> <span class="n">Ship</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="n">assets</span><span class="p">)</span>
<span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">player</span><span class="p">)</span>
<span class="c1"># Criando os meteoros</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
    <span class="n">meteor</span> <span class="o">=</span> <span class="n">Meteor</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span>
    <span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">meteor</span><span class="p">)</span>
    <span class="n">all_meteors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">meteor</span><span class="p">)</span>

<span class="c1"># ===== Loop principal =====</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">music</span><span class="o">.</span><span class="n">play</span><span class="p">(</span><span class="n">loops</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="k">while</span> <span class="n">game</span><span class="p">:</span>
    <span class="n">clock</span><span class="o">.</span><span class="n">tick</span><span class="p">(</span><span class="n">FPS</span><span class="p">)</span>

    <span class="c1"># ----- Trata eventos</span>
    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">pygame</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
        <span class="c1"># ----- Verifica consequências</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">QUIT</span><span class="p">:</span>
            <span class="n">game</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># Verifica se apertou alguma tecla.</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">KEYDOWN</span><span class="p">:</span>
            <span class="c1"># Dependendo da tecla, altera a velocidade.</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_LEFT</span><span class="p">:</span>
                <span class="n">player</span><span class="o">.</span><span class="n">speedx</span> <span class="o">-=</span> <span class="mi">8</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_RIGHT</span><span class="p">:</span>
                <span class="n">player</span><span class="o">.</span><span class="n">speedx</span> <span class="o">+=</span> <span class="mi">8</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_SPACE</span><span class="p">:</span>
                <span class="n">player</span><span class="o">.</span><span class="n">shoot</span><span class="p">()</span>
        <span class="c1"># Verifica se soltou alguma tecla.</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">KEYUP</span><span class="p">:</span>
            <span class="c1"># Dependendo da tecla, altera a velocidade.</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_LEFT</span><span class="p">:</span>
                <span class="n">player</span><span class="o">.</span><span class="n">speedx</span> <span class="o">+=</span> <span class="mi">8</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_RIGHT</span><span class="p">:</span>
                <span class="n">player</span><span class="o">.</span><span class="n">speedx</span> <span class="o">-=</span> <span class="mi">8</span>

    <span class="c1"># ----- Atualiza estado do jogo</span>
    <span class="c1"># Atualizando a posição dos meteoros</span>
    <span class="n">all_sprites</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

    <span class="c1"># Verifica se houve colisão entre tiro e meteoro</span>
    <span class="n">hits</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">groupcollide</span><span class="p">(</span><span class="n">all_meteors</span><span class="p">,</span> <span class="n">all_bullets</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">meteor</span> <span class="ow">in</span> <span class="n">hits</span><span class="p">:</span> <span class="c1"># As chaves são os elementos do primeiro grupo (meteoros) que colidiram com alguma bala</span>
        <span class="c1"># O meteoro e destruido e precisa ser recriado</span>
        <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;destroy_sound&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">play</span><span class="p">()</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">Meteor</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span>
        <span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="n">all_meteors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

        <span class="c1"># No lugar do meteoro antigo, adicionar uma explosão.</span>
        <span class="n">explosao</span> <span class="o">=</span> <span class="n">Explosion</span><span class="p">(</span><span class="n">meteor</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">center</span><span class="p">,</span> <span class="n">assets</span><span class="p">)</span>
        <span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">explosao</span><span class="p">)</span>

    <span class="c1"># Verifica se houve colisão entre nave e meteoro</span>
    <span class="n">hits</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">spritecollide</span><span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="n">all_meteors</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hits</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># Toca o som da colisão</span>
        <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;boom_sound&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">play</span><span class="p">()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># Precisa esperar senão fecha</span>

        <span class="n">game</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># ----- Gera saídas</span>
    <span class="n">window</span><span class="o">.</span><span class="n">fill</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>  <span class="c1"># Preenche com a cor branca</span>
    <span class="n">window</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">assets</span><span class="p">[</span><span class="s1">&#39;background&#39;</span><span class="p">],</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="c1"># Desenhando meteoros</span>
    <span class="n">all_sprites</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>

    <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>  <span class="c1"># Mostra o novo frame para o jogador</span>

<span class="c1"># ===== Finalização =====</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>  <span class="c1"># Função do PyGame que finaliza os recursos utilizados</span>
</code></pre></div>
</td></tr></table>

</details>
<ul>
<li>Linhas 28 a 35: carrega as imagens da animação da explosão e guarda em uma lista. Adiciona a lista no dicionário <code class="highlight"><span class="n">assets</span></code>;</li>
<li>Linhas 124 a 170: classe <code class="highlight"><span class="n">Explosion</span></code>:<ul>
<li>Linha 131: armazena a lista de imagens da animação em um atributo. Uma animação nada mais é que uma sucessão de imagens mostradas em um intervalo curto de tempo;</li>
<li>Linhas 134 a 137: coloca a primeira imagem da animação no atributo <code class="highlight"><span class="bp">self</span><span class="o">.</span><span class="n">image</span></code> e define sua posição;</li>
<li>Linha 140: armazena o instante de tempo atual. Depois que passar <code class="highlight"><span class="bp">self</span><span class="o">.</span><span class="n">frame_ticks</span></code> milissegundos a partir desse instante a próxima imagem será mostrada;</li>
<li>Linhas 154 a 170: método de atualização. Verifica se já se passaram <code class="highlight"><span class="bp">self</span><span class="o">.</span><span class="n">frame_ticks</span></code> milissegundos desde que a última imagem foi mostrada. Em caso afirmativo, mostra a próxima imagem. Se já não existem mais imagens para mostrar, mata o sprite.</li>
</ul>
</li>
<li>Linhas 236 e 237: cria o sprite de animação de explosão no mesmo lugar onde um meteoro foi explodido.</li>
</ul>
<div class="admonition example">
<h3 id="exercicio-15">EXERCÍCIO 15<a class="headerlink" href="#exercicio-15" title="Permanent link">&para;</a></h3>
<p>Limite os tiros da nave a um tiro a cada 500 milissegundos. Dica: a lógica será semelhante à decisão de mostrar a próxima imagem da animação (a resposta estará no <code class="highlight"><span class="n">jogo_v16</span><span class="o">.</span><span class="n">py</span></code>).</p>
</div>
<h2 id="adicionando-estados">Adicionando estados<a class="headerlink" href="#adicionando-estados" title="Permanent link">&para;</a></h2>
<p>Agora os meteoros estão bem legais, mas e a nave? Vamos agora introduzir um truque super útil para jogos (e vários outros programas de computador): a <strong>máquina de estados</strong>. Com uma máquina de estados, o programa apresenta comportamentos diferentes para cada estados. Esse é apenas o nome que damos para uma forma de estruturar o nosso código. Na prática você vai perceber que essa modificação não passa de um conjunto de <code class="highlight"><span class="n">ifs</span></code>. No nosso jogo teremos a princípio 3 estados:</p>
<ol>
<li><code class="highlight"><span class="n">DONE</span></code>: o jogo terminou;</li>
<li><code class="highlight"><span class="n">PLAYING</span></code>: o jogador está jogando;</li>
<li><code class="highlight"><span class="n">EXPLODING</span></code>: a nave está explodindo. Nesse estado o jogador não pode fazer nada (se ele apertar alguma coisa no teclado nada vai acontecer).</li>
</ol>
<p>A mudança para máquina de estados foi aplicada no <code class="highlight"><span class="n">jogo_v16</span><span class="o">.</span><span class="n">py</span></code>. Observe que no novo arquivo mudamos o mecanismo do loop de jogo. Antes usávamos uma variável booleana para indicar se o jogo estava rodando ou não. Agora temos uma variável com um número inteiro que indica em qual estado estamos: rodando o jogo normalmente, estado de explosão da nave, ou se o jogo acabou. As principais mudanças são:</p>
<details class="cite"><summary><code>referencia/jogo_v16.py</code></summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># ===== Inicialização =====</span>
<span class="c1"># ----- Importa e inicia pacotes</span>
<span class="kn">import</span> <span class="nn">pygame</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="n">pygame</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>

<span class="c1"># ----- Gera tela principal</span>
<span class="n">WIDTH</span> <span class="o">=</span> <span class="mi">480</span>
<span class="n">HEIGHT</span> <span class="o">=</span> <span class="mi">600</span>
<span class="n">window</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_mode</span><span class="p">((</span><span class="n">WIDTH</span><span class="p">,</span> <span class="n">HEIGHT</span><span class="p">))</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s1">&#39;Navinha&#39;</span><span class="p">)</span>

<span class="c1"># ----- Inicia assets</span>
<span class="n">METEOR_WIDTH</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">METEOR_HEIGHT</span> <span class="o">=</span> <span class="mi">38</span>
<span class="n">SHIP_WIDTH</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">SHIP_HEIGHT</span> <span class="o">=</span> <span class="mi">38</span>
<span class="n">assets</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;background&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/starfield.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;meteor_img&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/meteorBrown_med1.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert_alpha</span><span class="p">()</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;meteor_img&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">assets</span><span class="p">[</span><span class="s1">&#39;meteor_img&#39;</span><span class="p">],</span> <span class="p">(</span><span class="n">METEOR_WIDTH</span><span class="p">,</span> <span class="n">METEOR_HEIGHT</span><span class="p">))</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;ship_img&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/playerShip1_orange.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert_alpha</span><span class="p">()</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;ship_img&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">assets</span><span class="p">[</span><span class="s1">&#39;ship_img&#39;</span><span class="p">],</span> <span class="p">(</span><span class="n">SHIP_WIDTH</span><span class="p">,</span> <span class="n">SHIP_HEIGHT</span><span class="p">))</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;bullet_img&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/laserRed16.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert_alpha</span><span class="p">()</span>
<span class="n">explosion_anim</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">):</span>
    <span class="c1"># Os arquivos de animação são numerados de 00 a 08</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;assets/img/regularExplosion0</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">))</span>
    <span class="n">explosion_anim</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<span class="n">assets</span><span class="p">[</span><span class="s2">&quot;explosion_anim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">explosion_anim</span>

<span class="c1"># Carrega os sons do jogo</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">music</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/snd/tgfcoder-FrozenJam-SeamlessLoop.ogg&#39;</span><span class="p">)</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">music</span><span class="o">.</span><span class="n">set_volume</span><span class="p">(</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;boom_sound&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">Sound</span><span class="p">(</span><span class="s1">&#39;assets/snd/expl3.wav&#39;</span><span class="p">)</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;destroy_sound&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">Sound</span><span class="p">(</span><span class="s1">&#39;assets/snd/expl6.wav&#39;</span><span class="p">)</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;pew_sound&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">Sound</span><span class="p">(</span><span class="s1">&#39;assets/snd/pew.wav&#39;</span><span class="p">)</span>

<span class="c1"># ----- Inicia estruturas de dados</span>
<span class="c1"># Definindo os novos tipos</span>
<span class="k">class</span> <span class="nc">Ship</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">assets</span><span class="p">):</span>
        <span class="c1"># Construtor da classe mãe (Sprite).</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;ship_img&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">centerx</span> <span class="o">=</span> <span class="n">WIDTH</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">bottom</span> <span class="o">=</span> <span class="n">HEIGHT</span> <span class="o">-</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groups</span> <span class="o">=</span> <span class="n">groups</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assets</span> <span class="o">=</span> <span class="n">assets</span>

        <span class="c1"># Só será possível atirar uma vez a cada 500 milissegundos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_shot</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shoot_ticks</span> <span class="o">=</span> <span class="mi">500</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Atualização da posição da nave</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span>

        <span class="c1"># Mantem dentro da tela</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">right</span> <span class="o">&gt;</span> <span class="n">WIDTH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">WIDTH</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">left</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">shoot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Verifica se pode atirar</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span>
        <span class="c1"># Verifica quantos ticks se passaram desde o último tiro.</span>
        <span class="n">elapsed_ticks</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_shot</span>

        <span class="c1"># Se já pode atirar novamente...</span>
        <span class="k">if</span> <span class="n">elapsed_ticks</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">shoot_ticks</span><span class="p">:</span>
            <span class="c1"># Marca o tick da nova imagem.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_shot</span> <span class="o">=</span> <span class="n">now</span>
            <span class="c1"># A nova bala vai ser criada logo acima e no centro horizontal da nave</span>
            <span class="n">new_bullet</span> <span class="o">=</span> <span class="n">Bullet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assets</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">centerx</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="s1">&#39;all_sprites&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_bullet</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="s1">&#39;all_bullets&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_bullet</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assets</span><span class="p">[</span><span class="s1">&#39;pew_sound&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">play</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Meteor</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">assets</span><span class="p">):</span>
        <span class="c1"># Construtor da classe mãe (Sprite).</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;meteor_img&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">WIDTH</span><span class="o">-</span><span class="n">METEOR_WIDTH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="n">METEOR_HEIGHT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Atualizando a posição do meteoro</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span>
        <span class="c1"># Se o meteoro passar do final da tela, volta para cima e sorteia</span>
        <span class="c1"># novas posições e velocidades</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">top</span> <span class="o">&gt;</span> <span class="n">HEIGHT</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">right</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">left</span> <span class="o">&gt;</span> <span class="n">WIDTH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">WIDTH</span><span class="o">-</span><span class="n">METEOR_WIDTH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="n">METEOR_HEIGHT</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>

<span class="c1"># Classe Bullet que representa os tiros</span>
<span class="k">class</span> <span class="nc">Bullet</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="c1"># Construtor da classe.</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">assets</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">centerx</span><span class="p">):</span>
        <span class="c1"># Construtor da classe mãe (Sprite).</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;bullet_img&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>

        <span class="c1"># Coloca no lugar inicial definido em x, y do constutor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">centerx</span> <span class="o">=</span> <span class="n">centerx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">bottom</span> <span class="o">=</span> <span class="n">bottom</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span>  <span class="c1"># Velocidade fixa para cima</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># A bala só se move no eixo y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span>

        <span class="c1"># Se o tiro passar do inicio da tela, morre.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">bottom</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>

<span class="c1"># Classe que representa uma explosão de meteoro</span>
<span class="k">class</span> <span class="nc">Explosion</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="c1"># Construtor da classe.</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">assets</span><span class="p">):</span>
        <span class="c1"># Construtor da classe mãe (Sprite).</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Armazena a animação de explosão</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">explosion_anim</span> <span class="o">=</span> <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;explosion_anim&#39;</span><span class="p">]</span>

        <span class="c1"># Inicia o processo de animação colocando a primeira imagem na tela.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Armazena o índice atual na animação</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">explosion_anim</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">]</span>  <span class="c1"># Pega a primeira imagem</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">center</span>  <span class="c1"># Posiciona o centro da imagem</span>

        <span class="c1"># Guarda o tick da primeira imagem, ou seja, o momento em que a imagem foi mostrada</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_update</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span>

        <span class="c1"># Controle de ticks de animação: troca de imagem a cada self.frame_ticks milissegundos.</span>
        <span class="c1"># Quando pygame.time.get_ticks() - self.last_update &gt; self.frame_ticks a</span>
        <span class="c1"># próxima imagem da animação será mostrada</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame_ticks</span> <span class="o">=</span> <span class="mi">50</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Verifica o tick atual.</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span>
        <span class="c1"># Verifica quantos ticks se passaram desde a ultima mudança de frame.</span>
        <span class="n">elapsed_ticks</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_update</span>

        <span class="c1"># Se já está na hora de mudar de imagem...</span>
        <span class="k">if</span> <span class="n">elapsed_ticks</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_ticks</span><span class="p">:</span>
            <span class="c1"># Marca o tick da nova imagem.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_update</span> <span class="o">=</span> <span class="n">now</span>

            <span class="c1"># Avança um quadro.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># Verifica se já chegou no final da animação.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">explosion_anim</span><span class="p">):</span>
                <span class="c1"># Se sim, tchau explosão!</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Se ainda não chegou ao fim da explosão, troca de imagem.</span>
                <span class="n">center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">center</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">explosion_anim</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">center</span>

<span class="c1"># Variável para o ajuste de velocidade</span>
<span class="n">clock</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">Clock</span><span class="p">()</span>
<span class="n">FPS</span> <span class="o">=</span> <span class="mi">30</span>

<span class="c1"># Criando um grupo de meteoros</span>
<span class="n">all_sprites</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Group</span><span class="p">()</span>
<span class="n">all_meteors</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Group</span><span class="p">()</span>
<span class="n">all_bullets</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Group</span><span class="p">()</span>
<span class="n">groups</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">groups</span><span class="p">[</span><span class="s1">&#39;all_sprites&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_sprites</span>
<span class="n">groups</span><span class="p">[</span><span class="s1">&#39;all_meteors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_meteors</span>
<span class="n">groups</span><span class="p">[</span><span class="s1">&#39;all_bullets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_bullets</span>

<span class="c1"># Criando o jogador</span>
<span class="n">player</span> <span class="o">=</span> <span class="n">Ship</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="n">assets</span><span class="p">)</span>
<span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">player</span><span class="p">)</span>
<span class="c1"># Criando os meteoros</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
    <span class="n">meteor</span> <span class="o">=</span> <span class="n">Meteor</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span>
    <span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">meteor</span><span class="p">)</span>
    <span class="n">all_meteors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">meteor</span><span class="p">)</span>

<span class="n">DONE</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">PLAYING</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">EXPLODING</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">state</span> <span class="o">=</span> <span class="n">PLAYING</span>

<span class="c1"># ===== Loop principal =====</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">music</span><span class="o">.</span><span class="n">play</span><span class="p">(</span><span class="n">loops</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="k">while</span> <span class="n">state</span> <span class="o">!=</span> <span class="n">DONE</span><span class="p">:</span>
    <span class="n">clock</span><span class="o">.</span><span class="n">tick</span><span class="p">(</span><span class="n">FPS</span><span class="p">)</span>

    <span class="c1"># ----- Trata eventos</span>
    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">pygame</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
        <span class="c1"># ----- Verifica consequências</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">QUIT</span><span class="p">:</span>
            <span class="n">state</span> <span class="o">=</span> <span class="n">DONE</span>
        <span class="c1"># Só verifica o teclado se está no estado de jogo</span>
        <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">PLAYING</span><span class="p">:</span>
            <span class="c1"># Verifica se apertou alguma tecla.</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">KEYDOWN</span><span class="p">:</span>
                <span class="c1"># Dependendo da tecla, altera a velocidade.</span>
                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_LEFT</span><span class="p">:</span>
                    <span class="n">player</span><span class="o">.</span><span class="n">speedx</span> <span class="o">-=</span> <span class="mi">8</span>
                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_RIGHT</span><span class="p">:</span>
                    <span class="n">player</span><span class="o">.</span><span class="n">speedx</span> <span class="o">+=</span> <span class="mi">8</span>
                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_SPACE</span><span class="p">:</span>
                    <span class="n">player</span><span class="o">.</span><span class="n">shoot</span><span class="p">()</span>
            <span class="c1"># Verifica se soltou alguma tecla.</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">KEYUP</span><span class="p">:</span>
                <span class="c1"># Dependendo da tecla, altera a velocidade.</span>
                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_LEFT</span><span class="p">:</span>
                    <span class="n">player</span><span class="o">.</span><span class="n">speedx</span> <span class="o">+=</span> <span class="mi">8</span>
                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_RIGHT</span><span class="p">:</span>
                    <span class="n">player</span><span class="o">.</span><span class="n">speedx</span> <span class="o">-=</span> <span class="mi">8</span>

    <span class="c1"># ----- Atualiza estado do jogo</span>
    <span class="c1"># Atualizando a posição dos meteoros</span>
    <span class="n">all_sprites</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">PLAYING</span><span class="p">:</span>
        <span class="c1"># Verifica se houve colisão entre tiro e meteoro</span>
        <span class="n">hits</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">groupcollide</span><span class="p">(</span><span class="n">all_meteors</span><span class="p">,</span> <span class="n">all_bullets</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">meteor</span> <span class="ow">in</span> <span class="n">hits</span><span class="p">:</span> <span class="c1"># As chaves são os elementos do primeiro grupo (meteoros) que colidiram com alguma bala</span>
            <span class="c1"># O meteoro e destruido e precisa ser recriado</span>
            <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;destroy_sound&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">play</span><span class="p">()</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">Meteor</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span>
            <span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            <span class="n">all_meteors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

            <span class="c1"># No lugar do meteoro antigo, adicionar uma explosão.</span>
            <span class="n">explosao</span> <span class="o">=</span> <span class="n">Explosion</span><span class="p">(</span><span class="n">meteor</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">center</span><span class="p">,</span> <span class="n">assets</span><span class="p">)</span>
            <span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">explosao</span><span class="p">)</span>

        <span class="c1"># Verifica se houve colisão entre nave e meteoro</span>
        <span class="n">hits</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">spritecollide</span><span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="n">all_meteors</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hits</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Toca o som da colisão</span>
            <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;boom_sound&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">play</span><span class="p">()</span>
            <span class="n">player</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
            <span class="n">explosao</span> <span class="o">=</span> <span class="n">Explosion</span><span class="p">(</span><span class="n">player</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">center</span><span class="p">,</span> <span class="n">assets</span><span class="p">)</span>
            <span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">explosao</span><span class="p">)</span>
            <span class="n">state</span> <span class="o">=</span> <span class="n">EXPLODING</span>
            <span class="n">explosion_tick</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span>
            <span class="n">explosion_duration</span> <span class="o">=</span> <span class="n">explosao</span><span class="o">.</span><span class="n">frame_ticks</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">explosao</span><span class="o">.</span><span class="n">explosion_anim</span><span class="p">)</span> <span class="o">+</span> <span class="mi">400</span>
    <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="n">EXPLODING</span><span class="p">:</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">now</span> <span class="o">-</span> <span class="n">explosion_tick</span> <span class="o">&gt;</span> <span class="n">explosion_duration</span><span class="p">:</span>
            <span class="n">state</span> <span class="o">=</span> <span class="n">DONE</span>

    <span class="c1"># ----- Gera saídas</span>
    <span class="n">window</span><span class="o">.</span><span class="n">fill</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>  <span class="c1"># Preenche com a cor branca</span>
    <span class="n">window</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">assets</span><span class="p">[</span><span class="s1">&#39;background&#39;</span><span class="p">],</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="c1"># Desenhando meteoros</span>
    <span class="n">all_sprites</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>

    <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>  <span class="c1"># Mostra o novo frame para o jogador</span>

<span class="c1"># ===== Finalização =====</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>  <span class="c1"># Função do PyGame que finaliza os recursos utilizados</span>
</code></pre></div>
</td></tr></table>

</details>
<ul>
<li>Linhas 59, 60 e 74 a 81: resposta do exercício 15;</li>
<li>Linhas 206 a 209: definindo constantes com o valor de cada estado (poderia ser qualquer valor) e definindo o estado inicial como <code class="highlight"><span class="n">PLAYING</span></code>. Note que apagamos a variável <code class="highlight"><span class="n">game</span></code> do código inteiro;</li>
<li>Linha 213: condição do loop principal depende do estado. O jogo para quando <code class="highlight"><span class="n">state</span></code> é igual a <code class="highlight"><span class="n">DONE</span></code>, ou seja, <code class="highlight"><span class="mi">0</span></code>;</li>
<li>Linha 220: muda o estado para <code class="highlight"><span class="n">DONE</span></code> se o jogador apertou no X para fechar a janela;</li>
<li>Linha 222: só aplica as consequências de eventos de teclado se o estado for <code class="highlight"><span class="n">PLAYING</span></code>;</li>
<li>Linha 244: verifica colisões apenas se o estado for <code class="highlight"><span class="n">PLAYING</span></code>;</li>
<li>Linhas 263 a 265: mata a nave (para ela sumir) e cria uma explosão no lugar;</li>
<li>Linhas 266 a 268: muda o estado para <code class="highlight"><span class="n">EXPLODING</span></code> e armazena o instante de tempo em que esse estado começou. A variável <code class="highlight"><span class="n">explosion_duration</span></code> guarda a duração da animação de explosão com um adicional de 400 milissegundos;</li>
<li>Linhas 269 a 272: se o estado for <code class="highlight"><span class="n">EXPLODING</span></code> verifica se já passou o tempo necessário para a animação da explosão e depois termina o jogo (muda o estado para <code class="highlight"><span class="n">DONE</span></code>).</li>
</ul>
<p>Note que com o uso da máquina de estados não precisamos mais do <code class="highlight"><span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></code> para esperar antes do jogo terminar.</p>
<div class="admonition example">
<h3 id="exercicio-16">EXERCÍCIO 16<a class="headerlink" href="#exercicio-16" title="Permanent link">&para;</a></h3>
<p>Modifique o <code class="highlight"><span class="n">jogo_v16</span><span class="o">.</span><span class="n">py</span></code> para que o jogo nunca acabe, ou seja, depois que a nave termina de explodir ela ressurge na posição inicial (a resposta estará no <code class="highlight"><span class="n">jogo_v17</span><span class="o">.</span><span class="n">py</span></code>).</p>
</div>
<h2 id="adicionando-um-placar">Adicionando um placar<a class="headerlink" href="#adicionando-um-placar" title="Permanent link">&para;</a></h2>
<p>Vamos utilizar uma fonte com jeitão de arcade dos anos 80. Já vimos como desenhar texto na tela, então juntando esses conhecimentos podemos mostrar o placar ao longo do jogo. O <code class="highlight"><span class="n">jogo_v17</span><span class="o">.</span><span class="n">py</span></code> implementa essa funcionalidade. As principais mudanças são:</p>
<details class="cite"><summary><code>referencia/jogo_v17.py</code></summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># ===== Inicialização =====</span>
<span class="c1"># ----- Importa e inicia pacotes</span>
<span class="kn">import</span> <span class="nn">pygame</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="n">pygame</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>

<span class="c1"># ----- Gera tela principal</span>
<span class="n">WIDTH</span> <span class="o">=</span> <span class="mi">480</span>
<span class="n">HEIGHT</span> <span class="o">=</span> <span class="mi">600</span>
<span class="n">window</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_mode</span><span class="p">((</span><span class="n">WIDTH</span><span class="p">,</span> <span class="n">HEIGHT</span><span class="p">))</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s1">&#39;Navinha&#39;</span><span class="p">)</span>

<span class="c1"># ----- Inicia assets</span>
<span class="n">METEOR_WIDTH</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">METEOR_HEIGHT</span> <span class="o">=</span> <span class="mi">38</span>
<span class="n">SHIP_WIDTH</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">SHIP_HEIGHT</span> <span class="o">=</span> <span class="mi">38</span>
<span class="n">assets</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;background&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/starfield.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;meteor_img&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/meteorBrown_med1.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert_alpha</span><span class="p">()</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;meteor_img&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">assets</span><span class="p">[</span><span class="s1">&#39;meteor_img&#39;</span><span class="p">],</span> <span class="p">(</span><span class="n">METEOR_WIDTH</span><span class="p">,</span> <span class="n">METEOR_HEIGHT</span><span class="p">))</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;ship_img&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/playerShip1_orange.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert_alpha</span><span class="p">()</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;ship_img&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">assets</span><span class="p">[</span><span class="s1">&#39;ship_img&#39;</span><span class="p">],</span> <span class="p">(</span><span class="n">SHIP_WIDTH</span><span class="p">,</span> <span class="n">SHIP_HEIGHT</span><span class="p">))</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;bullet_img&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/laserRed16.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert_alpha</span><span class="p">()</span>
<span class="n">explosion_anim</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">):</span>
    <span class="c1"># Os arquivos de animação são numerados de 00 a 08</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;assets/img/regularExplosion0</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">))</span>
    <span class="n">explosion_anim</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<span class="n">assets</span><span class="p">[</span><span class="s2">&quot;explosion_anim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">explosion_anim</span>
<span class="n">assets</span><span class="p">[</span><span class="s2">&quot;score_font&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">Font</span><span class="p">(</span><span class="s1">&#39;assets/font/PressStart2P.ttf&#39;</span><span class="p">,</span> <span class="mi">28</span><span class="p">)</span>

<span class="c1"># Carrega os sons do jogo</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">music</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/snd/tgfcoder-FrozenJam-SeamlessLoop.ogg&#39;</span><span class="p">)</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">music</span><span class="o">.</span><span class="n">set_volume</span><span class="p">(</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;boom_sound&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">Sound</span><span class="p">(</span><span class="s1">&#39;assets/snd/expl3.wav&#39;</span><span class="p">)</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;destroy_sound&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">Sound</span><span class="p">(</span><span class="s1">&#39;assets/snd/expl6.wav&#39;</span><span class="p">)</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;pew_sound&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">Sound</span><span class="p">(</span><span class="s1">&#39;assets/snd/pew.wav&#39;</span><span class="p">)</span>

<span class="c1"># ----- Inicia estruturas de dados</span>
<span class="c1"># Definindo os novos tipos</span>
<span class="k">class</span> <span class="nc">Ship</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">assets</span><span class="p">):</span>
        <span class="c1"># Construtor da classe mãe (Sprite).</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;ship_img&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">centerx</span> <span class="o">=</span> <span class="n">WIDTH</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">bottom</span> <span class="o">=</span> <span class="n">HEIGHT</span> <span class="o">-</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groups</span> <span class="o">=</span> <span class="n">groups</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assets</span> <span class="o">=</span> <span class="n">assets</span>

        <span class="c1"># Só será possível atirar uma vez a cada 500 milissegundos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_shot</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shoot_ticks</span> <span class="o">=</span> <span class="mi">500</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Atualização da posição da nave</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span>

        <span class="c1"># Mantem dentro da tela</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">right</span> <span class="o">&gt;</span> <span class="n">WIDTH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">WIDTH</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">left</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">shoot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Verifica se pode atirar</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span>
        <span class="c1"># Verifica quantos ticks se passaram desde o último tiro.</span>
        <span class="n">elapsed_ticks</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_shot</span>

        <span class="c1"># Se já pode atirar novamente...</span>
        <span class="k">if</span> <span class="n">elapsed_ticks</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">shoot_ticks</span><span class="p">:</span>
            <span class="c1"># Marca o tick da nova imagem.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_shot</span> <span class="o">=</span> <span class="n">now</span>
            <span class="c1"># A nova bala vai ser criada logo acima e no centro horizontal da nave</span>
            <span class="n">new_bullet</span> <span class="o">=</span> <span class="n">Bullet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assets</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">centerx</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="s1">&#39;all_sprites&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_bullet</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="s1">&#39;all_bullets&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_bullet</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assets</span><span class="p">[</span><span class="s1">&#39;pew_sound&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">play</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Meteor</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">assets</span><span class="p">):</span>
        <span class="c1"># Construtor da classe mãe (Sprite).</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;meteor_img&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">WIDTH</span><span class="o">-</span><span class="n">METEOR_WIDTH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="n">METEOR_HEIGHT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Atualizando a posição do meteoro</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span>
        <span class="c1"># Se o meteoro passar do final da tela, volta para cima e sorteia</span>
        <span class="c1"># novas posições e velocidades</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">top</span> <span class="o">&gt;</span> <span class="n">HEIGHT</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">right</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">left</span> <span class="o">&gt;</span> <span class="n">WIDTH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">WIDTH</span><span class="o">-</span><span class="n">METEOR_WIDTH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="n">METEOR_HEIGHT</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>

<span class="c1"># Classe Bullet que representa os tiros</span>
<span class="k">class</span> <span class="nc">Bullet</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="c1"># Construtor da classe.</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">assets</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">centerx</span><span class="p">):</span>
        <span class="c1"># Construtor da classe mãe (Sprite).</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;bullet_img&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>

        <span class="c1"># Coloca no lugar inicial definido em x, y do constutor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">centerx</span> <span class="o">=</span> <span class="n">centerx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">bottom</span> <span class="o">=</span> <span class="n">bottom</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span>  <span class="c1"># Velocidade fixa para cima</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># A bala só se move no eixo y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span>

        <span class="c1"># Se o tiro passar do inicio da tela, morre.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">bottom</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>

<span class="c1"># Classe que representa uma explosão de meteoro</span>
<span class="k">class</span> <span class="nc">Explosion</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="c1"># Construtor da classe.</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">assets</span><span class="p">):</span>
        <span class="c1"># Construtor da classe mãe (Sprite).</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Armazena a animação de explosão</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">explosion_anim</span> <span class="o">=</span> <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;explosion_anim&#39;</span><span class="p">]</span>

        <span class="c1"># Inicia o processo de animação colocando a primeira imagem na tela.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Armazena o índice atual na animação</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">explosion_anim</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">]</span>  <span class="c1"># Pega a primeira imagem</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">center</span>  <span class="c1"># Posiciona o centro da imagem</span>

        <span class="c1"># Guarda o tick da primeira imagem, ou seja, o momento em que a imagem foi mostrada</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_update</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span>

        <span class="c1"># Controle de ticks de animação: troca de imagem a cada self.frame_ticks milissegundos.</span>
        <span class="c1"># Quando pygame.time.get_ticks() - self.last_update &gt; self.frame_ticks a</span>
        <span class="c1"># próxima imagem da animação será mostrada</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame_ticks</span> <span class="o">=</span> <span class="mi">50</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Verifica o tick atual.</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span>
        <span class="c1"># Verifica quantos ticks se passaram desde a ultima mudança de frame.</span>
        <span class="n">elapsed_ticks</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_update</span>

        <span class="c1"># Se já está na hora de mudar de imagem...</span>
        <span class="k">if</span> <span class="n">elapsed_ticks</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_ticks</span><span class="p">:</span>
            <span class="c1"># Marca o tick da nova imagem.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_update</span> <span class="o">=</span> <span class="n">now</span>

            <span class="c1"># Avança um quadro.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># Verifica se já chegou no final da animação.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">explosion_anim</span><span class="p">):</span>
                <span class="c1"># Se sim, tchau explosão!</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Se ainda não chegou ao fim da explosão, troca de imagem.</span>
                <span class="n">center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">center</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">explosion_anim</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">center</span>

<span class="c1"># Variável para o ajuste de velocidade</span>
<span class="n">clock</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">Clock</span><span class="p">()</span>
<span class="n">FPS</span> <span class="o">=</span> <span class="mi">30</span>

<span class="c1"># Criando um grupo de meteoros</span>
<span class="n">all_sprites</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Group</span><span class="p">()</span>
<span class="n">all_meteors</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Group</span><span class="p">()</span>
<span class="n">all_bullets</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Group</span><span class="p">()</span>
<span class="n">groups</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">groups</span><span class="p">[</span><span class="s1">&#39;all_sprites&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_sprites</span>
<span class="n">groups</span><span class="p">[</span><span class="s1">&#39;all_meteors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_meteors</span>
<span class="n">groups</span><span class="p">[</span><span class="s1">&#39;all_bullets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_bullets</span>

<span class="c1"># Criando o jogador</span>
<span class="n">player</span> <span class="o">=</span> <span class="n">Ship</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="n">assets</span><span class="p">)</span>
<span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">player</span><span class="p">)</span>
<span class="c1"># Criando os meteoros</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
    <span class="n">meteor</span> <span class="o">=</span> <span class="n">Meteor</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span>
    <span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">meteor</span><span class="p">)</span>
    <span class="n">all_meteors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">meteor</span><span class="p">)</span>

<span class="n">DONE</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">PLAYING</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">EXPLODING</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">state</span> <span class="o">=</span> <span class="n">PLAYING</span>

<span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">keys_down</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1"># ===== Loop principal =====</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">music</span><span class="o">.</span><span class="n">play</span><span class="p">(</span><span class="n">loops</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="k">while</span> <span class="n">state</span> <span class="o">!=</span> <span class="n">DONE</span><span class="p">:</span>
    <span class="n">clock</span><span class="o">.</span><span class="n">tick</span><span class="p">(</span><span class="n">FPS</span><span class="p">)</span>

    <span class="c1"># ----- Trata eventos</span>
    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">pygame</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
        <span class="c1"># ----- Verifica consequências</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">QUIT</span><span class="p">:</span>
            <span class="n">state</span> <span class="o">=</span> <span class="n">DONE</span>
        <span class="c1"># Só verifica o teclado se está no estado de jogo</span>
        <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">PLAYING</span><span class="p">:</span>
            <span class="c1"># Verifica se apertou alguma tecla.</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">KEYDOWN</span><span class="p">:</span>
                <span class="c1"># Dependendo da tecla, altera a velocidade.</span>
                <span class="n">keys_down</span><span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_LEFT</span><span class="p">:</span>
                    <span class="n">player</span><span class="o">.</span><span class="n">speedx</span> <span class="o">-=</span> <span class="mi">8</span>
                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_RIGHT</span><span class="p">:</span>
                    <span class="n">player</span><span class="o">.</span><span class="n">speedx</span> <span class="o">+=</span> <span class="mi">8</span>
                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_SPACE</span><span class="p">:</span>
                    <span class="n">player</span><span class="o">.</span><span class="n">shoot</span><span class="p">()</span>
            <span class="c1"># Verifica se soltou alguma tecla.</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">KEYUP</span><span class="p">:</span>
                <span class="c1"># Dependendo da tecla, altera a velocidade.</span>
                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="n">keys_down</span> <span class="ow">and</span> <span class="n">keys_down</span><span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_LEFT</span><span class="p">:</span>
                        <span class="n">player</span><span class="o">.</span><span class="n">speedx</span> <span class="o">+=</span> <span class="mi">8</span>
                    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_RIGHT</span><span class="p">:</span>
                        <span class="n">player</span><span class="o">.</span><span class="n">speedx</span> <span class="o">-=</span> <span class="mi">8</span>

    <span class="c1"># ----- Atualiza estado do jogo</span>
    <span class="c1"># Atualizando a posição dos meteoros</span>
    <span class="n">all_sprites</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">PLAYING</span><span class="p">:</span>
        <span class="c1"># Verifica se houve colisão entre tiro e meteoro</span>
        <span class="n">hits</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">groupcollide</span><span class="p">(</span><span class="n">all_meteors</span><span class="p">,</span> <span class="n">all_bullets</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">meteor</span> <span class="ow">in</span> <span class="n">hits</span><span class="p">:</span> <span class="c1"># As chaves são os elementos do primeiro grupo (meteoros) que colidiram com alguma bala</span>
            <span class="c1"># O meteoro e destruido e precisa ser recriado</span>
            <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;destroy_sound&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">play</span><span class="p">()</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">Meteor</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span>
            <span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            <span class="n">all_meteors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

            <span class="c1"># No lugar do meteoro antigo, adicionar uma explosão.</span>
            <span class="n">explosao</span> <span class="o">=</span> <span class="n">Explosion</span><span class="p">(</span><span class="n">meteor</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">center</span><span class="p">,</span> <span class="n">assets</span><span class="p">)</span>
            <span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">explosao</span><span class="p">)</span>

            <span class="c1"># Ganhou pontos!</span>
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">100</span>

        <span class="c1"># Verifica se houve colisão entre nave e meteoro</span>
        <span class="n">hits</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">spritecollide</span><span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="n">all_meteors</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hits</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Toca o som da colisão</span>
            <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;boom_sound&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">play</span><span class="p">()</span>
            <span class="n">player</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
            <span class="n">explosao</span> <span class="o">=</span> <span class="n">Explosion</span><span class="p">(</span><span class="n">player</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">center</span><span class="p">,</span> <span class="n">assets</span><span class="p">)</span>
            <span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">explosao</span><span class="p">)</span>
            <span class="n">state</span> <span class="o">=</span> <span class="n">EXPLODING</span>
            <span class="n">keys_down</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">explosion_tick</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span>
            <span class="n">explosion_duration</span> <span class="o">=</span> <span class="n">explosao</span><span class="o">.</span><span class="n">frame_ticks</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">explosao</span><span class="o">.</span><span class="n">explosion_anim</span><span class="p">)</span> <span class="o">+</span> <span class="mi">400</span>
    <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="n">EXPLODING</span><span class="p">:</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">now</span> <span class="o">-</span> <span class="n">explosion_tick</span> <span class="o">&gt;</span> <span class="n">explosion_duration</span><span class="p">:</span>
            <span class="n">state</span> <span class="o">=</span> <span class="n">PLAYING</span>
            <span class="n">player</span> <span class="o">=</span> <span class="n">Ship</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="n">assets</span><span class="p">)</span>
            <span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">player</span><span class="p">)</span>

    <span class="c1"># ----- Gera saídas</span>
    <span class="n">window</span><span class="o">.</span><span class="n">fill</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>  <span class="c1"># Preenche com a cor branca</span>
    <span class="n">window</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">assets</span><span class="p">[</span><span class="s1">&#39;background&#39;</span><span class="p">],</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="c1"># Desenhando meteoros</span>
    <span class="n">all_sprites</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>

    <span class="c1"># Desenhando o score</span>
    <span class="n">text_surface</span> <span class="o">=</span> <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;score_font&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:08d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">score</span><span class="p">),</span> <span class="kc">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">text_rect</span> <span class="o">=</span> <span class="n">text_surface</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
    <span class="n">text_rect</span><span class="o">.</span><span class="n">midtop</span> <span class="o">=</span> <span class="p">(</span><span class="n">WIDTH</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">10</span><span class="p">)</span>
    <span class="n">window</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">text_surface</span><span class="p">,</span> <span class="n">text_rect</span><span class="p">)</span>

    <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>  <span class="c1"># Mostra o novo frame para o jogador</span>

<span class="c1"># ===== Finalização =====</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>  <span class="c1"># Função do PyGame que finaliza os recursos utilizados</span>
</code></pre></div>
</td></tr></table>

</details>
<ul>
<li>Linha 35: carrega a fonte que será utilizada para mostrar o placar;</li>
<li>Linhas 212 e 265: inicializa o placar com <code class="highlight"><span class="mi">0</span></code>. Toda vez que um meteoro explode o jogador ganha 100 pontos;</li>
<li>Linhas 213, 230, 240 e 276: cria um dicionário de teclas que guarda se uma tecla estava pressionada ou não. Quando ocorre um evento de tecla levantada (<code class="highlight"><span class="n">pygame</span><span class="o">.</span><span class="n">KEYUP</span></code>), verifica se essa tecla estava previamente pressionada. Isso é necessário para evitar um problema quando a nave explode enquanto uma tecla está apertada. Nesse caso, quando a nave é recriada e o jogador solta a tecla seria aplicada uma velocidade contrária. Por esse motivo, na linha 276 o dicionário é apagado quando o estado muda para <code class="highlight"><span class="n">EXPLODING</span></code>;</li>
<li>Linhas 282 a 284: resposta do exercício 16;</li>
<li>Linhas 293 a 296: desenha o placar.</li>
</ul>
<div class="admonition example">
<h3 id="exercicio-17">EXERCÍCIO 17<a class="headerlink" href="#exercicio-17" title="Permanent link">&para;</a></h3>
<p>Modifique o <code class="highlight"><span class="n">jogo_v17</span><span class="o">.</span><span class="n">py</span></code> para que o placar seja zerado quando a nave explode.</p>
</div>
<h2 id="sistema-de-vidas">Sistema de vidas<a class="headerlink" href="#sistema-de-vidas" title="Permanent link">&para;</a></h2>
<p>O <code class="highlight"><span class="n">jogo_v18</span><span class="o">.</span><span class="n">py</span></code> implementa um sistema de vidas. O jogador terá 3 vidas. Depois que morrer 3 vezes o jogo termina. As principais mudanças são:</p>
<details class="cite"><summary><code>referencia/jogo_v18.py</code></summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># ===== Inicialização =====</span>
<span class="c1"># ----- Importa e inicia pacotes</span>
<span class="kn">import</span> <span class="nn">pygame</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="n">pygame</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>

<span class="c1"># ----- Gera tela principal</span>
<span class="n">WIDTH</span> <span class="o">=</span> <span class="mi">480</span>
<span class="n">HEIGHT</span> <span class="o">=</span> <span class="mi">600</span>
<span class="n">window</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_mode</span><span class="p">((</span><span class="n">WIDTH</span><span class="p">,</span> <span class="n">HEIGHT</span><span class="p">))</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s1">&#39;Navinha&#39;</span><span class="p">)</span>

<span class="c1"># ----- Inicia assets</span>
<span class="n">METEOR_WIDTH</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">METEOR_HEIGHT</span> <span class="o">=</span> <span class="mi">38</span>
<span class="n">SHIP_WIDTH</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">SHIP_HEIGHT</span> <span class="o">=</span> <span class="mi">38</span>
<span class="n">assets</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;background&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/starfield.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;meteor_img&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/meteorBrown_med1.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert_alpha</span><span class="p">()</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;meteor_img&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">assets</span><span class="p">[</span><span class="s1">&#39;meteor_img&#39;</span><span class="p">],</span> <span class="p">(</span><span class="n">METEOR_WIDTH</span><span class="p">,</span> <span class="n">METEOR_HEIGHT</span><span class="p">))</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;ship_img&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/playerShip1_orange.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert_alpha</span><span class="p">()</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;ship_img&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">assets</span><span class="p">[</span><span class="s1">&#39;ship_img&#39;</span><span class="p">],</span> <span class="p">(</span><span class="n">SHIP_WIDTH</span><span class="p">,</span> <span class="n">SHIP_HEIGHT</span><span class="p">))</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;bullet_img&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/laserRed16.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert_alpha</span><span class="p">()</span>
<span class="n">explosion_anim</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">):</span>
    <span class="c1"># Os arquivos de animação são numerados de 00 a 08</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;assets/img/regularExplosion0</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">))</span>
    <span class="n">explosion_anim</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<span class="n">assets</span><span class="p">[</span><span class="s2">&quot;explosion_anim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">explosion_anim</span>
<span class="n">assets</span><span class="p">[</span><span class="s2">&quot;score_font&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">Font</span><span class="p">(</span><span class="s1">&#39;assets/font/PressStart2P.ttf&#39;</span><span class="p">,</span> <span class="mi">28</span><span class="p">)</span>

<span class="c1"># Carrega os sons do jogo</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">music</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/snd/tgfcoder-FrozenJam-SeamlessLoop.ogg&#39;</span><span class="p">)</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">music</span><span class="o">.</span><span class="n">set_volume</span><span class="p">(</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;boom_sound&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">Sound</span><span class="p">(</span><span class="s1">&#39;assets/snd/expl3.wav&#39;</span><span class="p">)</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;destroy_sound&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">Sound</span><span class="p">(</span><span class="s1">&#39;assets/snd/expl6.wav&#39;</span><span class="p">)</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;pew_sound&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">Sound</span><span class="p">(</span><span class="s1">&#39;assets/snd/pew.wav&#39;</span><span class="p">)</span>

<span class="c1"># ----- Inicia estruturas de dados</span>
<span class="c1"># Definindo os novos tipos</span>
<span class="k">class</span> <span class="nc">Ship</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">assets</span><span class="p">):</span>
        <span class="c1"># Construtor da classe mãe (Sprite).</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;ship_img&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">centerx</span> <span class="o">=</span> <span class="n">WIDTH</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">bottom</span> <span class="o">=</span> <span class="n">HEIGHT</span> <span class="o">-</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groups</span> <span class="o">=</span> <span class="n">groups</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assets</span> <span class="o">=</span> <span class="n">assets</span>

        <span class="c1"># Só será possível atirar uma vez a cada 500 milissegundos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_shot</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shoot_ticks</span> <span class="o">=</span> <span class="mi">500</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Atualização da posição da nave</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span>

        <span class="c1"># Mantem dentro da tela</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">right</span> <span class="o">&gt;</span> <span class="n">WIDTH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">WIDTH</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">left</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">shoot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Verifica se pode atirar</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span>
        <span class="c1"># Verifica quantos ticks se passaram desde o último tiro.</span>
        <span class="n">elapsed_ticks</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_shot</span>

        <span class="c1"># Se já pode atirar novamente...</span>
        <span class="k">if</span> <span class="n">elapsed_ticks</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">shoot_ticks</span><span class="p">:</span>
            <span class="c1"># Marca o tick da nova imagem.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_shot</span> <span class="o">=</span> <span class="n">now</span>
            <span class="c1"># A nova bala vai ser criada logo acima e no centro horizontal da nave</span>
            <span class="n">new_bullet</span> <span class="o">=</span> <span class="n">Bullet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assets</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">centerx</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="s1">&#39;all_sprites&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_bullet</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="s1">&#39;all_bullets&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_bullet</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assets</span><span class="p">[</span><span class="s1">&#39;pew_sound&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">play</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Meteor</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">assets</span><span class="p">):</span>
        <span class="c1"># Construtor da classe mãe (Sprite).</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;meteor_img&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">WIDTH</span><span class="o">-</span><span class="n">METEOR_WIDTH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="n">METEOR_HEIGHT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Atualizando a posição do meteoro</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span>
        <span class="c1"># Se o meteoro passar do final da tela, volta para cima e sorteia</span>
        <span class="c1"># novas posições e velocidades</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">top</span> <span class="o">&gt;</span> <span class="n">HEIGHT</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">right</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">left</span> <span class="o">&gt;</span> <span class="n">WIDTH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">WIDTH</span><span class="o">-</span><span class="n">METEOR_WIDTH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="n">METEOR_HEIGHT</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>

<span class="c1"># Classe Bullet que representa os tiros</span>
<span class="k">class</span> <span class="nc">Bullet</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="c1"># Construtor da classe.</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">assets</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">centerx</span><span class="p">):</span>
        <span class="c1"># Construtor da classe mãe (Sprite).</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;bullet_img&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>

        <span class="c1"># Coloca no lugar inicial definido em x, y do constutor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">centerx</span> <span class="o">=</span> <span class="n">centerx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">bottom</span> <span class="o">=</span> <span class="n">bottom</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span>  <span class="c1"># Velocidade fixa para cima</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># A bala só se move no eixo y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span>

        <span class="c1"># Se o tiro passar do inicio da tela, morre.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">bottom</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>

<span class="c1"># Classe que representa uma explosão de meteoro</span>
<span class="k">class</span> <span class="nc">Explosion</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="c1"># Construtor da classe.</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">assets</span><span class="p">):</span>
        <span class="c1"># Construtor da classe mãe (Sprite).</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Armazena a animação de explosão</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">explosion_anim</span> <span class="o">=</span> <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;explosion_anim&#39;</span><span class="p">]</span>

        <span class="c1"># Inicia o processo de animação colocando a primeira imagem na tela.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Armazena o índice atual na animação</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">explosion_anim</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">]</span>  <span class="c1"># Pega a primeira imagem</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">center</span>  <span class="c1"># Posiciona o centro da imagem</span>

        <span class="c1"># Guarda o tick da primeira imagem, ou seja, o momento em que a imagem foi mostrada</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_update</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span>

        <span class="c1"># Controle de ticks de animação: troca de imagem a cada self.frame_ticks milissegundos.</span>
        <span class="c1"># Quando pygame.time.get_ticks() - self.last_update &gt; self.frame_ticks a</span>
        <span class="c1"># próxima imagem da animação será mostrada</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame_ticks</span> <span class="o">=</span> <span class="mi">50</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Verifica o tick atual.</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span>
        <span class="c1"># Verifica quantos ticks se passaram desde a ultima mudança de frame.</span>
        <span class="n">elapsed_ticks</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_update</span>

        <span class="c1"># Se já está na hora de mudar de imagem...</span>
        <span class="k">if</span> <span class="n">elapsed_ticks</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_ticks</span><span class="p">:</span>
            <span class="c1"># Marca o tick da nova imagem.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_update</span> <span class="o">=</span> <span class="n">now</span>

            <span class="c1"># Avança um quadro.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># Verifica se já chegou no final da animação.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">explosion_anim</span><span class="p">):</span>
                <span class="c1"># Se sim, tchau explosão!</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Se ainda não chegou ao fim da explosão, troca de imagem.</span>
                <span class="n">center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">center</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">explosion_anim</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">center</span>

<span class="c1"># Variável para o ajuste de velocidade</span>
<span class="n">clock</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">Clock</span><span class="p">()</span>
<span class="n">FPS</span> <span class="o">=</span> <span class="mi">30</span>

<span class="c1"># Criando um grupo de meteoros</span>
<span class="n">all_sprites</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Group</span><span class="p">()</span>
<span class="n">all_meteors</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Group</span><span class="p">()</span>
<span class="n">all_bullets</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Group</span><span class="p">()</span>
<span class="n">groups</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">groups</span><span class="p">[</span><span class="s1">&#39;all_sprites&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_sprites</span>
<span class="n">groups</span><span class="p">[</span><span class="s1">&#39;all_meteors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_meteors</span>
<span class="n">groups</span><span class="p">[</span><span class="s1">&#39;all_bullets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_bullets</span>

<span class="c1"># Criando o jogador</span>
<span class="n">player</span> <span class="o">=</span> <span class="n">Ship</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="n">assets</span><span class="p">)</span>
<span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">player</span><span class="p">)</span>
<span class="c1"># Criando os meteoros</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
    <span class="n">meteor</span> <span class="o">=</span> <span class="n">Meteor</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span>
    <span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">meteor</span><span class="p">)</span>
    <span class="n">all_meteors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">meteor</span><span class="p">)</span>

<span class="n">DONE</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">PLAYING</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">EXPLODING</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">state</span> <span class="o">=</span> <span class="n">PLAYING</span>

<span class="n">keys_down</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">lives</span> <span class="o">=</span> <span class="mi">3</span>

<span class="c1"># ===== Loop principal =====</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">music</span><span class="o">.</span><span class="n">play</span><span class="p">(</span><span class="n">loops</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="k">while</span> <span class="n">state</span> <span class="o">!=</span> <span class="n">DONE</span><span class="p">:</span>
    <span class="n">clock</span><span class="o">.</span><span class="n">tick</span><span class="p">(</span><span class="n">FPS</span><span class="p">)</span>

    <span class="c1"># ----- Trata eventos</span>
    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">pygame</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
        <span class="c1"># ----- Verifica consequências</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">QUIT</span><span class="p">:</span>
            <span class="n">state</span> <span class="o">=</span> <span class="n">DONE</span>
        <span class="c1"># Só verifica o teclado se está no estado de jogo</span>
        <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">PLAYING</span><span class="p">:</span>
            <span class="c1"># Verifica se apertou alguma tecla.</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">KEYDOWN</span><span class="p">:</span>
                <span class="c1"># Dependendo da tecla, altera a velocidade.</span>
                <span class="n">keys_down</span><span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_LEFT</span><span class="p">:</span>
                    <span class="n">player</span><span class="o">.</span><span class="n">speedx</span> <span class="o">-=</span> <span class="mi">8</span>
                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_RIGHT</span><span class="p">:</span>
                    <span class="n">player</span><span class="o">.</span><span class="n">speedx</span> <span class="o">+=</span> <span class="mi">8</span>
                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_SPACE</span><span class="p">:</span>
                    <span class="n">player</span><span class="o">.</span><span class="n">shoot</span><span class="p">()</span>
            <span class="c1"># Verifica se soltou alguma tecla.</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">KEYUP</span><span class="p">:</span>
                <span class="c1"># Dependendo da tecla, altera a velocidade.</span>
                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="n">keys_down</span> <span class="ow">and</span> <span class="n">keys_down</span><span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_LEFT</span><span class="p">:</span>
                        <span class="n">player</span><span class="o">.</span><span class="n">speedx</span> <span class="o">+=</span> <span class="mi">8</span>
                    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_RIGHT</span><span class="p">:</span>
                        <span class="n">player</span><span class="o">.</span><span class="n">speedx</span> <span class="o">-=</span> <span class="mi">8</span>

    <span class="c1"># ----- Atualiza estado do jogo</span>
    <span class="c1"># Atualizando a posição dos meteoros</span>
    <span class="n">all_sprites</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">PLAYING</span><span class="p">:</span>
        <span class="c1"># Verifica se houve colisão entre tiro e meteoro</span>
        <span class="n">hits</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">groupcollide</span><span class="p">(</span><span class="n">all_meteors</span><span class="p">,</span> <span class="n">all_bullets</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">meteor</span> <span class="ow">in</span> <span class="n">hits</span><span class="p">:</span> <span class="c1"># As chaves são os elementos do primeiro grupo (meteoros) que colidiram com alguma bala</span>
            <span class="c1"># O meteoro e destruido e precisa ser recriado</span>
            <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;destroy_sound&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">play</span><span class="p">()</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">Meteor</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span>
            <span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            <span class="n">all_meteors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

            <span class="c1"># No lugar do meteoro antigo, adicionar uma explosão.</span>
            <span class="n">explosao</span> <span class="o">=</span> <span class="n">Explosion</span><span class="p">(</span><span class="n">meteor</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">center</span><span class="p">,</span> <span class="n">assets</span><span class="p">)</span>
            <span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">explosao</span><span class="p">)</span>

            <span class="c1"># Ganhou pontos!</span>
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">100</span>

        <span class="c1"># Verifica se houve colisão entre nave e meteoro</span>
        <span class="n">hits</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">spritecollide</span><span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="n">all_meteors</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hits</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Toca o som da colisão</span>
            <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;boom_sound&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">play</span><span class="p">()</span>
            <span class="n">player</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
            <span class="n">lives</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">explosao</span> <span class="o">=</span> <span class="n">Explosion</span><span class="p">(</span><span class="n">player</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">center</span><span class="p">,</span> <span class="n">assets</span><span class="p">)</span>
            <span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">explosao</span><span class="p">)</span>
            <span class="n">state</span> <span class="o">=</span> <span class="n">EXPLODING</span>
            <span class="n">keys_down</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">explosion_tick</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span>
            <span class="n">explosion_duration</span> <span class="o">=</span> <span class="n">explosao</span><span class="o">.</span><span class="n">frame_ticks</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">explosao</span><span class="o">.</span><span class="n">explosion_anim</span><span class="p">)</span> <span class="o">+</span> <span class="mi">400</span>
    <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="n">EXPLODING</span><span class="p">:</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">now</span> <span class="o">-</span> <span class="n">explosion_tick</span> <span class="o">&gt;</span> <span class="n">explosion_duration</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lives</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">DONE</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">PLAYING</span>
                <span class="n">player</span> <span class="o">=</span> <span class="n">Ship</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="n">assets</span><span class="p">)</span>
                <span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">player</span><span class="p">)</span>

    <span class="c1"># ----- Gera saídas</span>
    <span class="n">window</span><span class="o">.</span><span class="n">fill</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>  <span class="c1"># Preenche com a cor branca</span>
    <span class="n">window</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">assets</span><span class="p">[</span><span class="s1">&#39;background&#39;</span><span class="p">],</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="c1"># Desenhando meteoros</span>
    <span class="n">all_sprites</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>

    <span class="c1"># Desenhando o score</span>
    <span class="n">text_surface</span> <span class="o">=</span> <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;score_font&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:08d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">score</span><span class="p">),</span> <span class="kc">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">text_rect</span> <span class="o">=</span> <span class="n">text_surface</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
    <span class="n">text_rect</span><span class="o">.</span><span class="n">midtop</span> <span class="o">=</span> <span class="p">(</span><span class="n">WIDTH</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">10</span><span class="p">)</span>
    <span class="n">window</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">text_surface</span><span class="p">,</span> <span class="n">text_rect</span><span class="p">)</span>

    <span class="c1"># Desenhando as vidas</span>
    <span class="n">text_surface</span> <span class="o">=</span> <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;score_font&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">9829</span><span class="p">)</span> <span class="o">*</span> <span class="n">lives</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">text_rect</span> <span class="o">=</span> <span class="n">text_surface</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
    <span class="n">text_rect</span><span class="o">.</span><span class="n">bottomleft</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">HEIGHT</span> <span class="o">-</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">window</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">text_surface</span><span class="p">,</span> <span class="n">text_rect</span><span class="p">)</span>

    <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>  <span class="c1"># Mostra o novo frame para o jogador</span>

<span class="c1"># ===== Finalização =====</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>  <span class="c1"># Função do PyGame que finaliza os recursos utilizados</span>
</code></pre></div>
</td></tr></table>

</details>
<ul>
<li>Linhas 214 e 274: inicializa o número de vidas com 3 e diminui toda vez que a nave explode;</li>
<li>Linhas 284 a 286: se a quantidade de vidas chegar a zero o jogo termina;</li>
<li>Linhas 304 a 307: desenha as vidas.</li>
</ul>
<div class="admonition example">
<h3 id="exercicio-18">EXERCÍCIO 18<a class="headerlink" href="#exercicio-18" title="Permanent link">&para;</a></h3>
<p>Modifique o <code class="highlight"><span class="n">jogo_v18</span><span class="o">.</span><span class="n">py</span></code> para que o jogador ganhe automaticamente uma vida a cada 1.000 pontos. A resposta estará no <code class="highlight"><span class="n">jogo_v19</span><span class="o">.</span><span class="n">py</span></code>.</p>
</div>
<h2 id="melhorando-a-colisao">Melhorando a colisão<a class="headerlink" href="#melhorando-a-colisao" title="Permanent link">&para;</a></h2>
<p>Talvez você tenha percebido que a colisão entre sprites nem sempre é muito boa. Isso acontece porque as colisões são feitas por padrão entre as imagens, ou seja, entre os retângulos (mesmo que sejam transparentes). O <code class="highlight"><span class="n">jogo_v19</span><span class="o">.</span><span class="n">py</span></code> utiliza uma função mais precisa de colisão. Para isso é necessário criar máscaras de colisão. Uma máscara de colisão é uma imagem na qual os valores iguais a zero serão ignorados no teste de colisão. Para utilizar a colisão entre máscaras é necessário que o sprite possua um atributo <code class="highlight"><span class="n">mask</span></code>. As principais mudanças são:</p>
<details class="cite"><summary><code>referencia/jogo_v19.py</code></summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># ===== Inicialização =====</span>
<span class="c1"># ----- Importa e inicia pacotes</span>
<span class="kn">import</span> <span class="nn">pygame</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="n">pygame</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>

<span class="c1"># ----- Gera tela principal</span>
<span class="n">WIDTH</span> <span class="o">=</span> <span class="mi">480</span>
<span class="n">HEIGHT</span> <span class="o">=</span> <span class="mi">600</span>
<span class="n">window</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_mode</span><span class="p">((</span><span class="n">WIDTH</span><span class="p">,</span> <span class="n">HEIGHT</span><span class="p">))</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s1">&#39;Navinha&#39;</span><span class="p">)</span>

<span class="c1"># ----- Inicia assets</span>
<span class="n">METEOR_WIDTH</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">METEOR_HEIGHT</span> <span class="o">=</span> <span class="mi">38</span>
<span class="n">SHIP_WIDTH</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">SHIP_HEIGHT</span> <span class="o">=</span> <span class="mi">38</span>
<span class="n">assets</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;background&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/starfield.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;meteor_img&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/meteorBrown_med1.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert_alpha</span><span class="p">()</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;meteor_img&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">assets</span><span class="p">[</span><span class="s1">&#39;meteor_img&#39;</span><span class="p">],</span> <span class="p">(</span><span class="n">METEOR_WIDTH</span><span class="p">,</span> <span class="n">METEOR_HEIGHT</span><span class="p">))</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;ship_img&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/playerShip1_orange.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert_alpha</span><span class="p">()</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;ship_img&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">assets</span><span class="p">[</span><span class="s1">&#39;ship_img&#39;</span><span class="p">],</span> <span class="p">(</span><span class="n">SHIP_WIDTH</span><span class="p">,</span> <span class="n">SHIP_HEIGHT</span><span class="p">))</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;bullet_img&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/laserRed16.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert_alpha</span><span class="p">()</span>
<span class="n">explosion_anim</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">):</span>
    <span class="c1"># Os arquivos de animação são numerados de 00 a 08</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;assets/img/regularExplosion0</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">))</span>
    <span class="n">explosion_anim</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<span class="n">assets</span><span class="p">[</span><span class="s2">&quot;explosion_anim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">explosion_anim</span>
<span class="n">assets</span><span class="p">[</span><span class="s2">&quot;score_font&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">Font</span><span class="p">(</span><span class="s1">&#39;assets/font/PressStart2P.ttf&#39;</span><span class="p">,</span> <span class="mi">28</span><span class="p">)</span>

<span class="c1"># Carrega os sons do jogo</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">music</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/snd/tgfcoder-FrozenJam-SeamlessLoop.ogg&#39;</span><span class="p">)</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">music</span><span class="o">.</span><span class="n">set_volume</span><span class="p">(</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;boom_sound&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">Sound</span><span class="p">(</span><span class="s1">&#39;assets/snd/expl3.wav&#39;</span><span class="p">)</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;destroy_sound&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">Sound</span><span class="p">(</span><span class="s1">&#39;assets/snd/expl6.wav&#39;</span><span class="p">)</span>
<span class="n">assets</span><span class="p">[</span><span class="s1">&#39;pew_sound&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">Sound</span><span class="p">(</span><span class="s1">&#39;assets/snd/pew.wav&#39;</span><span class="p">)</span>

<span class="c1"># ----- Inicia estruturas de dados</span>
<span class="c1"># Definindo os novos tipos</span>
<span class="k">class</span> <span class="nc">Ship</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">assets</span><span class="p">):</span>
        <span class="c1"># Construtor da classe mãe (Sprite).</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;ship_img&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">from_surface</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">centerx</span> <span class="o">=</span> <span class="n">WIDTH</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">bottom</span> <span class="o">=</span> <span class="n">HEIGHT</span> <span class="o">-</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groups</span> <span class="o">=</span> <span class="n">groups</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assets</span> <span class="o">=</span> <span class="n">assets</span>

        <span class="c1"># Só será possível atirar uma vez a cada 500 milissegundos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_shot</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shoot_ticks</span> <span class="o">=</span> <span class="mi">500</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Atualização da posição da nave</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span>

        <span class="c1"># Mantem dentro da tela</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">right</span> <span class="o">&gt;</span> <span class="n">WIDTH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">WIDTH</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">left</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">shoot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Verifica se pode atirar</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span>
        <span class="c1"># Verifica quantos ticks se passaram desde o último tiro.</span>
        <span class="n">elapsed_ticks</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_shot</span>

        <span class="c1"># Se já pode atirar novamente...</span>
        <span class="k">if</span> <span class="n">elapsed_ticks</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">shoot_ticks</span><span class="p">:</span>
            <span class="c1"># Marca o tick da nova imagem.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_shot</span> <span class="o">=</span> <span class="n">now</span>
            <span class="c1"># A nova bala vai ser criada logo acima e no centro horizontal da nave</span>
            <span class="n">new_bullet</span> <span class="o">=</span> <span class="n">Bullet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assets</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">centerx</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="s1">&#39;all_sprites&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_bullet</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="s1">&#39;all_bullets&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_bullet</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assets</span><span class="p">[</span><span class="s1">&#39;pew_sound&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">play</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Meteor</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">assets</span><span class="p">):</span>
        <span class="c1"># Construtor da classe mãe (Sprite).</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;meteor_img&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">from_surface</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">WIDTH</span><span class="o">-</span><span class="n">METEOR_WIDTH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="n">METEOR_HEIGHT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Atualizando a posição do meteoro</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span>
        <span class="c1"># Se o meteoro passar do final da tela, volta para cima e sorteia</span>
        <span class="c1"># novas posições e velocidades</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">top</span> <span class="o">&gt;</span> <span class="n">HEIGHT</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">right</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">left</span> <span class="o">&gt;</span> <span class="n">WIDTH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">WIDTH</span><span class="o">-</span><span class="n">METEOR_WIDTH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="n">METEOR_HEIGHT</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>

<span class="c1"># Classe Bullet que representa os tiros</span>
<span class="k">class</span> <span class="nc">Bullet</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="c1"># Construtor da classe.</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">assets</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">centerx</span><span class="p">):</span>
        <span class="c1"># Construtor da classe mãe (Sprite).</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;bullet_img&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">from_surface</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>

        <span class="c1"># Coloca no lugar inicial definido em x, y do constutor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">centerx</span> <span class="o">=</span> <span class="n">centerx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">bottom</span> <span class="o">=</span> <span class="n">bottom</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span>  <span class="c1"># Velocidade fixa para cima</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># A bala só se move no eixo y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span>

        <span class="c1"># Se o tiro passar do inicio da tela, morre.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">bottom</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>

<span class="c1"># Classe que representa uma explosão de meteoro</span>
<span class="k">class</span> <span class="nc">Explosion</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="c1"># Construtor da classe.</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">assets</span><span class="p">):</span>
        <span class="c1"># Construtor da classe mãe (Sprite).</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Armazena a animação de explosão</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">explosion_anim</span> <span class="o">=</span> <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;explosion_anim&#39;</span><span class="p">]</span>

        <span class="c1"># Inicia o processo de animação colocando a primeira imagem na tela.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Armazena o índice atual na animação</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">explosion_anim</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">]</span>  <span class="c1"># Pega a primeira imagem</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">center</span>  <span class="c1"># Posiciona o centro da imagem</span>

        <span class="c1"># Guarda o tick da primeira imagem, ou seja, o momento em que a imagem foi mostrada</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_update</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span>

        <span class="c1"># Controle de ticks de animação: troca de imagem a cada self.frame_ticks milissegundos.</span>
        <span class="c1"># Quando pygame.time.get_ticks() - self.last_update &gt; self.frame_ticks a</span>
        <span class="c1"># próxima imagem da animação será mostrada</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame_ticks</span> <span class="o">=</span> <span class="mi">50</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Verifica o tick atual.</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span>
        <span class="c1"># Verifica quantos ticks se passaram desde a ultima mudança de frame.</span>
        <span class="n">elapsed_ticks</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_update</span>

        <span class="c1"># Se já está na hora de mudar de imagem...</span>
        <span class="k">if</span> <span class="n">elapsed_ticks</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_ticks</span><span class="p">:</span>
            <span class="c1"># Marca o tick da nova imagem.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_update</span> <span class="o">=</span> <span class="n">now</span>

            <span class="c1"># Avança um quadro.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># Verifica se já chegou no final da animação.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">explosion_anim</span><span class="p">):</span>
                <span class="c1"># Se sim, tchau explosão!</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Se ainda não chegou ao fim da explosão, troca de imagem.</span>
                <span class="n">center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">center</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">explosion_anim</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">center</span>

<span class="c1"># Variável para o ajuste de velocidade</span>
<span class="n">clock</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">Clock</span><span class="p">()</span>
<span class="n">FPS</span> <span class="o">=</span> <span class="mi">30</span>

<span class="c1"># Criando um grupo de meteoros</span>
<span class="n">all_sprites</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Group</span><span class="p">()</span>
<span class="n">all_meteors</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Group</span><span class="p">()</span>
<span class="n">all_bullets</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Group</span><span class="p">()</span>
<span class="n">groups</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">groups</span><span class="p">[</span><span class="s1">&#39;all_sprites&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_sprites</span>
<span class="n">groups</span><span class="p">[</span><span class="s1">&#39;all_meteors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_meteors</span>
<span class="n">groups</span><span class="p">[</span><span class="s1">&#39;all_bullets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_bullets</span>

<span class="c1"># Criando o jogador</span>
<span class="n">player</span> <span class="o">=</span> <span class="n">Ship</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="n">assets</span><span class="p">)</span>
<span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">player</span><span class="p">)</span>
<span class="c1"># Criando os meteoros</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
    <span class="n">meteor</span> <span class="o">=</span> <span class="n">Meteor</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span>
    <span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">meteor</span><span class="p">)</span>
    <span class="n">all_meteors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">meteor</span><span class="p">)</span>

<span class="n">DONE</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">PLAYING</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">EXPLODING</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">state</span> <span class="o">=</span> <span class="n">PLAYING</span>

<span class="n">keys_down</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">lives</span> <span class="o">=</span> <span class="mi">3</span>

<span class="c1"># ===== Loop principal =====</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">music</span><span class="o">.</span><span class="n">play</span><span class="p">(</span><span class="n">loops</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="k">while</span> <span class="n">state</span> <span class="o">!=</span> <span class="n">DONE</span><span class="p">:</span>
    <span class="n">clock</span><span class="o">.</span><span class="n">tick</span><span class="p">(</span><span class="n">FPS</span><span class="p">)</span>

    <span class="c1"># ----- Trata eventos</span>
    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">pygame</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
        <span class="c1"># ----- Verifica consequências</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">QUIT</span><span class="p">:</span>
            <span class="n">state</span> <span class="o">=</span> <span class="n">DONE</span>
        <span class="c1"># Só verifica o teclado se está no estado de jogo</span>
        <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">PLAYING</span><span class="p">:</span>
            <span class="c1"># Verifica se apertou alguma tecla.</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">KEYDOWN</span><span class="p">:</span>
                <span class="c1"># Dependendo da tecla, altera a velocidade.</span>
                <span class="n">keys_down</span><span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_LEFT</span><span class="p">:</span>
                    <span class="n">player</span><span class="o">.</span><span class="n">speedx</span> <span class="o">-=</span> <span class="mi">8</span>
                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_RIGHT</span><span class="p">:</span>
                    <span class="n">player</span><span class="o">.</span><span class="n">speedx</span> <span class="o">+=</span> <span class="mi">8</span>
                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_SPACE</span><span class="p">:</span>
                    <span class="n">player</span><span class="o">.</span><span class="n">shoot</span><span class="p">()</span>
            <span class="c1"># Verifica se soltou alguma tecla.</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">KEYUP</span><span class="p">:</span>
                <span class="c1"># Dependendo da tecla, altera a velocidade.</span>
                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="n">keys_down</span> <span class="ow">and</span> <span class="n">keys_down</span><span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_LEFT</span><span class="p">:</span>
                        <span class="n">player</span><span class="o">.</span><span class="n">speedx</span> <span class="o">+=</span> <span class="mi">8</span>
                    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_RIGHT</span><span class="p">:</span>
                        <span class="n">player</span><span class="o">.</span><span class="n">speedx</span> <span class="o">-=</span> <span class="mi">8</span>

    <span class="c1"># ----- Atualiza estado do jogo</span>
    <span class="c1"># Atualizando a posição dos meteoros</span>
    <span class="n">all_sprites</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">PLAYING</span><span class="p">:</span>
        <span class="c1"># Verifica se houve colisão entre tiro e meteoro</span>
        <span class="n">hits</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">groupcollide</span><span class="p">(</span><span class="n">all_meteors</span><span class="p">,</span> <span class="n">all_bullets</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">collide_mask</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">meteor</span> <span class="ow">in</span> <span class="n">hits</span><span class="p">:</span> <span class="c1"># As chaves são os elementos do primeiro grupo (meteoros) que colidiram com alguma bala</span>
            <span class="c1"># O meteoro e destruido e precisa ser recriado</span>
            <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;destroy_sound&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">play</span><span class="p">()</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">Meteor</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span>
            <span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            <span class="n">all_meteors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

            <span class="c1"># No lugar do meteoro antigo, adicionar uma explosão.</span>
            <span class="n">explosao</span> <span class="o">=</span> <span class="n">Explosion</span><span class="p">(</span><span class="n">meteor</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">center</span><span class="p">,</span> <span class="n">assets</span><span class="p">)</span>
            <span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">explosao</span><span class="p">)</span>

            <span class="c1"># Ganhou pontos!</span>
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">100</span>
            <span class="k">if</span> <span class="n">score</span> <span class="o">%</span> <span class="mi">1000</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">lives</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Verifica se houve colisão entre nave e meteoro</span>
        <span class="n">hits</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">spritecollide</span><span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="n">all_meteors</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">collide_mask</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hits</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Toca o som da colisão</span>
            <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;boom_sound&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">play</span><span class="p">()</span>
            <span class="n">player</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
            <span class="n">lives</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">explosao</span> <span class="o">=</span> <span class="n">Explosion</span><span class="p">(</span><span class="n">player</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">center</span><span class="p">,</span> <span class="n">assets</span><span class="p">)</span>
            <span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">explosao</span><span class="p">)</span>
            <span class="n">state</span> <span class="o">=</span> <span class="n">EXPLODING</span>
            <span class="n">keys_down</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">explosion_tick</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span>
            <span class="n">explosion_duration</span> <span class="o">=</span> <span class="n">explosao</span><span class="o">.</span><span class="n">frame_ticks</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">explosao</span><span class="o">.</span><span class="n">explosion_anim</span><span class="p">)</span> <span class="o">+</span> <span class="mi">400</span>
    <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="n">EXPLODING</span><span class="p">:</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">now</span> <span class="o">-</span> <span class="n">explosion_tick</span> <span class="o">&gt;</span> <span class="n">explosion_duration</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lives</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">DONE</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">PLAYING</span>
                <span class="n">player</span> <span class="o">=</span> <span class="n">Ship</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="n">assets</span><span class="p">)</span>
                <span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">player</span><span class="p">)</span>

    <span class="c1"># ----- Gera saídas</span>
    <span class="n">window</span><span class="o">.</span><span class="n">fill</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>  <span class="c1"># Preenche com a cor branca</span>
    <span class="n">window</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">assets</span><span class="p">[</span><span class="s1">&#39;background&#39;</span><span class="p">],</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="c1"># Desenhando meteoros</span>
    <span class="n">all_sprites</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>

    <span class="c1"># Desenhando o score</span>
    <span class="n">text_surface</span> <span class="o">=</span> <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;score_font&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:08d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">score</span><span class="p">),</span> <span class="kc">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">text_rect</span> <span class="o">=</span> <span class="n">text_surface</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
    <span class="n">text_rect</span><span class="o">.</span><span class="n">midtop</span> <span class="o">=</span> <span class="p">(</span><span class="n">WIDTH</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">10</span><span class="p">)</span>
    <span class="n">window</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">text_surface</span><span class="p">,</span> <span class="n">text_rect</span><span class="p">)</span>

    <span class="c1"># Desenhando as vidas</span>
    <span class="n">text_surface</span> <span class="o">=</span> <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;score_font&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">9829</span><span class="p">)</span> <span class="o">*</span> <span class="n">lives</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">text_rect</span> <span class="o">=</span> <span class="n">text_surface</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
    <span class="n">text_rect</span><span class="o">.</span><span class="n">bottomleft</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">HEIGHT</span> <span class="o">-</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">window</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">text_surface</span><span class="p">,</span> <span class="n">text_rect</span><span class="p">)</span>

    <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>  <span class="c1"># Mostra o novo frame para o jogador</span>

<span class="c1"># ===== Finalização =====</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>  <span class="c1"># Função do PyGame que finaliza os recursos utilizados</span>
</code></pre></div>
</td></tr></table>

</details>
<ul>
<li>Linhas 52, 96 e 123: cria as máscaras de colisão a partir da imagem do sprite;</li>
<li>Linhas 256 e 274: define que as colisões devem ser realizadas usando máscaras;</li>
<li>Linhas 270 e 271: resposta do exercício 18.</li>
</ul>
<h2 id="separando-o-codigo-em-mais-funcoes">Separando o código em mais funções<a class="headerlink" href="#separando-o-codigo-em-mais-funcoes" title="Permanent link">&para;</a></h2>
<p>Este código está ficando muito grande! Está na hora de quebrar esse monolito em funções simples. Isso vai facilitar o desenvolvimento de novas telas de jogo. O <code class="highlight"><span class="n">jogo_v20</span><span class="o">.</span><span class="n">py</span></code> cria as funções <code class="highlight"><span class="n">load_assets</span></code> e <code class="highlight"><span class="n">game_screen</span></code> que extraem o carregamento dos assets e a lógica do jogo. Nessa versão não existe nenhuma mudança, visualmente falando, mas essa refatoração vai ser bastante útil para o próximo passo. Principais mudanças:</p>
<details class="cite"><summary><code>referencia/jogo_v20.py</code></summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># ===== Inicialização =====</span>
<span class="c1"># ----- Importa e inicia pacotes</span>
<span class="kn">import</span> <span class="nn">pygame</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="n">pygame</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>

<span class="c1"># ----- Gera tela principal</span>
<span class="n">WIDTH</span> <span class="o">=</span> <span class="mi">480</span>
<span class="n">HEIGHT</span> <span class="o">=</span> <span class="mi">600</span>
<span class="n">window</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_mode</span><span class="p">((</span><span class="n">WIDTH</span><span class="p">,</span> <span class="n">HEIGHT</span><span class="p">))</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s1">&#39;Navinha&#39;</span><span class="p">)</span>

<span class="c1"># ----- Inicia assets</span>
<span class="n">FPS</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">METEOR_WIDTH</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">METEOR_HEIGHT</span> <span class="o">=</span> <span class="mi">38</span>
<span class="n">SHIP_WIDTH</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">SHIP_HEIGHT</span> <span class="o">=</span> <span class="mi">38</span>

<span class="k">def</span> <span class="nf">load_assets</span><span class="p">():</span>
    <span class="n">assets</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;background&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/starfield.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span>
    <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;meteor_img&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/meteorBrown_med1.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert_alpha</span><span class="p">()</span>
    <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;meteor_img&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">assets</span><span class="p">[</span><span class="s1">&#39;meteor_img&#39;</span><span class="p">],</span> <span class="p">(</span><span class="n">METEOR_WIDTH</span><span class="p">,</span> <span class="n">METEOR_HEIGHT</span><span class="p">))</span>
    <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;ship_img&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/playerShip1_orange.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert_alpha</span><span class="p">()</span>
    <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;ship_img&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">assets</span><span class="p">[</span><span class="s1">&#39;ship_img&#39;</span><span class="p">],</span> <span class="p">(</span><span class="n">SHIP_WIDTH</span><span class="p">,</span> <span class="n">SHIP_HEIGHT</span><span class="p">))</span>
    <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;bullet_img&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/img/laserRed16.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert_alpha</span><span class="p">()</span>
    <span class="n">explosion_anim</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">):</span>
        <span class="c1"># Os arquivos de animação são numerados de 00 a 08</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;assets/img/regularExplosion0</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">))</span>
        <span class="n">explosion_anim</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="n">assets</span><span class="p">[</span><span class="s2">&quot;explosion_anim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">explosion_anim</span>
    <span class="n">assets</span><span class="p">[</span><span class="s2">&quot;score_font&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">Font</span><span class="p">(</span><span class="s1">&#39;assets/font/PressStart2P.ttf&#39;</span><span class="p">,</span> <span class="mi">28</span><span class="p">)</span>

    <span class="c1"># Carrega os sons do jogo</span>
    <span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">music</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;assets/snd/tgfcoder-FrozenJam-SeamlessLoop.ogg&#39;</span><span class="p">)</span>
    <span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">music</span><span class="o">.</span><span class="n">set_volume</span><span class="p">(</span><span class="mf">0.4</span><span class="p">)</span>
    <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;boom_sound&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">Sound</span><span class="p">(</span><span class="s1">&#39;assets/snd/expl3.wav&#39;</span><span class="p">)</span>
    <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;destroy_sound&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">Sound</span><span class="p">(</span><span class="s1">&#39;assets/snd/expl6.wav&#39;</span><span class="p">)</span>
    <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;pew_sound&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">Sound</span><span class="p">(</span><span class="s1">&#39;assets/snd/pew.wav&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">assets</span>

<span class="c1"># ----- Inicia estruturas de dados</span>
<span class="c1"># Definindo os novos tipos</span>
<span class="k">class</span> <span class="nc">Ship</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">assets</span><span class="p">):</span>
        <span class="c1"># Construtor da classe mãe (Sprite).</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;ship_img&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">from_surface</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">centerx</span> <span class="o">=</span> <span class="n">WIDTH</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">bottom</span> <span class="o">=</span> <span class="n">HEIGHT</span> <span class="o">-</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groups</span> <span class="o">=</span> <span class="n">groups</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assets</span> <span class="o">=</span> <span class="n">assets</span>

        <span class="c1"># Só será possível atirar uma vez a cada 500 milissegundos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_shot</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shoot_ticks</span> <span class="o">=</span> <span class="mi">500</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Atualização da posição da nave</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span>

        <span class="c1"># Mantem dentro da tela</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">right</span> <span class="o">&gt;</span> <span class="n">WIDTH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">WIDTH</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">left</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">shoot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Verifica se pode atirar</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span>
        <span class="c1"># Verifica quantos ticks se passaram desde o último tiro.</span>
        <span class="n">elapsed_ticks</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_shot</span>

        <span class="c1"># Se já pode atirar novamente...</span>
        <span class="k">if</span> <span class="n">elapsed_ticks</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">shoot_ticks</span><span class="p">:</span>
            <span class="c1"># Marca o tick da nova imagem.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_shot</span> <span class="o">=</span> <span class="n">now</span>
            <span class="c1"># A nova bala vai ser criada logo acima e no centro horizontal da nave</span>
            <span class="n">new_bullet</span> <span class="o">=</span> <span class="n">Bullet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assets</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">centerx</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="s1">&#39;all_sprites&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_bullet</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="s1">&#39;all_bullets&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_bullet</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assets</span><span class="p">[</span><span class="s1">&#39;pew_sound&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">play</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Meteor</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">assets</span><span class="p">):</span>
        <span class="c1"># Construtor da classe mãe (Sprite).</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;meteor_img&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">from_surface</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">WIDTH</span><span class="o">-</span><span class="n">METEOR_WIDTH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="n">METEOR_HEIGHT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Atualizando a posição do meteoro</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span>
        <span class="c1"># Se o meteoro passar do final da tela, volta para cima e sorteia</span>
        <span class="c1"># novas posições e velocidades</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">top</span> <span class="o">&gt;</span> <span class="n">HEIGHT</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">right</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">left</span> <span class="o">&gt;</span> <span class="n">WIDTH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">WIDTH</span><span class="o">-</span><span class="n">METEOR_WIDTH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="n">METEOR_HEIGHT</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>

<span class="c1"># Classe Bullet que representa os tiros</span>
<span class="k">class</span> <span class="nc">Bullet</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="c1"># Construtor da classe.</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">assets</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">centerx</span><span class="p">):</span>
        <span class="c1"># Construtor da classe mãe (Sprite).</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;bullet_img&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">from_surface</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>

        <span class="c1"># Coloca no lugar inicial definido em x, y do constutor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">centerx</span> <span class="o">=</span> <span class="n">centerx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">bottom</span> <span class="o">=</span> <span class="n">bottom</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span>  <span class="c1"># Velocidade fixa para cima</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># A bala só se move no eixo y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span>

        <span class="c1"># Se o tiro passar do inicio da tela, morre.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">bottom</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>

<span class="c1"># Classe que representa uma explosão de meteoro</span>
<span class="k">class</span> <span class="nc">Explosion</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="c1"># Construtor da classe.</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">assets</span><span class="p">):</span>
        <span class="c1"># Construtor da classe mãe (Sprite).</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Armazena a animação de explosão</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">explosion_anim</span> <span class="o">=</span> <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;explosion_anim&#39;</span><span class="p">]</span>

        <span class="c1"># Inicia o processo de animação colocando a primeira imagem na tela.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Armazena o índice atual na animação</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">explosion_anim</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">]</span>  <span class="c1"># Pega a primeira imagem</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">center</span>  <span class="c1"># Posiciona o centro da imagem</span>

        <span class="c1"># Guarda o tick da primeira imagem, ou seja, o momento em que a imagem foi mostrada</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_update</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span>

        <span class="c1"># Controle de ticks de animação: troca de imagem a cada self.frame_ticks milissegundos.</span>
        <span class="c1"># Quando pygame.time.get_ticks() - self.last_update &gt; self.frame_ticks a</span>
        <span class="c1"># próxima imagem da animação será mostrada</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame_ticks</span> <span class="o">=</span> <span class="mi">50</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Verifica o tick atual.</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span>
        <span class="c1"># Verifica quantos ticks se passaram desde a ultima mudança de frame.</span>
        <span class="n">elapsed_ticks</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_update</span>

        <span class="c1"># Se já está na hora de mudar de imagem...</span>
        <span class="k">if</span> <span class="n">elapsed_ticks</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_ticks</span><span class="p">:</span>
            <span class="c1"># Marca o tick da nova imagem.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_update</span> <span class="o">=</span> <span class="n">now</span>

            <span class="c1"># Avança um quadro.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># Verifica se já chegou no final da animação.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">explosion_anim</span><span class="p">):</span>
                <span class="c1"># Se sim, tchau explosão!</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Se ainda não chegou ao fim da explosão, troca de imagem.</span>
                <span class="n">center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">center</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">explosion_anim</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">center</span>

<span class="k">def</span> <span class="nf">game_screen</span><span class="p">(</span><span class="n">window</span><span class="p">):</span>
    <span class="c1"># Variável para o ajuste de velocidade</span>
    <span class="n">clock</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">Clock</span><span class="p">()</span>

    <span class="n">assets</span> <span class="o">=</span> <span class="n">load_assets</span><span class="p">()</span>

    <span class="c1"># Criando um grupo de meteoros</span>
    <span class="n">all_sprites</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Group</span><span class="p">()</span>
    <span class="n">all_meteors</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Group</span><span class="p">()</span>
    <span class="n">all_bullets</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Group</span><span class="p">()</span>
    <span class="n">groups</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">groups</span><span class="p">[</span><span class="s1">&#39;all_sprites&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_sprites</span>
    <span class="n">groups</span><span class="p">[</span><span class="s1">&#39;all_meteors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_meteors</span>
    <span class="n">groups</span><span class="p">[</span><span class="s1">&#39;all_bullets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_bullets</span>

    <span class="c1"># Criando o jogador</span>
    <span class="n">player</span> <span class="o">=</span> <span class="n">Ship</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="n">assets</span><span class="p">)</span>
    <span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">player</span><span class="p">)</span>
    <span class="c1"># Criando os meteoros</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
        <span class="n">meteor</span> <span class="o">=</span> <span class="n">Meteor</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span>
        <span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">meteor</span><span class="p">)</span>
        <span class="n">all_meteors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">meteor</span><span class="p">)</span>

    <span class="n">DONE</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">PLAYING</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">EXPLODING</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">PLAYING</span>

    <span class="n">keys_down</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">lives</span> <span class="o">=</span> <span class="mi">3</span>

    <span class="c1"># ===== Loop principal =====</span>
    <span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">music</span><span class="o">.</span><span class="n">play</span><span class="p">(</span><span class="n">loops</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">state</span> <span class="o">!=</span> <span class="n">DONE</span><span class="p">:</span>
        <span class="n">clock</span><span class="o">.</span><span class="n">tick</span><span class="p">(</span><span class="n">FPS</span><span class="p">)</span>

        <span class="c1"># ----- Trata eventos</span>
        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">pygame</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
            <span class="c1"># ----- Verifica consequências</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">QUIT</span><span class="p">:</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">DONE</span>
            <span class="c1"># Só verifica o teclado se está no estado de jogo</span>
            <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">PLAYING</span><span class="p">:</span>
                <span class="c1"># Verifica se apertou alguma tecla.</span>
                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">KEYDOWN</span><span class="p">:</span>
                    <span class="c1"># Dependendo da tecla, altera a velocidade.</span>
                    <span class="n">keys_down</span><span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_LEFT</span><span class="p">:</span>
                        <span class="n">player</span><span class="o">.</span><span class="n">speedx</span> <span class="o">-=</span> <span class="mi">8</span>
                    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_RIGHT</span><span class="p">:</span>
                        <span class="n">player</span><span class="o">.</span><span class="n">speedx</span> <span class="o">+=</span> <span class="mi">8</span>
                    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_SPACE</span><span class="p">:</span>
                        <span class="n">player</span><span class="o">.</span><span class="n">shoot</span><span class="p">()</span>
                <span class="c1"># Verifica se soltou alguma tecla.</span>
                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">KEYUP</span><span class="p">:</span>
                    <span class="c1"># Dependendo da tecla, altera a velocidade.</span>
                    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="n">keys_down</span> <span class="ow">and</span> <span class="n">keys_down</span><span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_LEFT</span><span class="p">:</span>
                            <span class="n">player</span><span class="o">.</span><span class="n">speedx</span> <span class="o">+=</span> <span class="mi">8</span>
                        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_RIGHT</span><span class="p">:</span>
                            <span class="n">player</span><span class="o">.</span><span class="n">speedx</span> <span class="o">-=</span> <span class="mi">8</span>

        <span class="c1"># ----- Atualiza estado do jogo</span>
        <span class="c1"># Atualizando a posição dos meteoros</span>
        <span class="n">all_sprites</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">PLAYING</span><span class="p">:</span>
            <span class="c1"># Verifica se houve colisão entre tiro e meteoro</span>
            <span class="n">hits</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">groupcollide</span><span class="p">(</span><span class="n">all_meteors</span><span class="p">,</span> <span class="n">all_bullets</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">collide_mask</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">meteor</span> <span class="ow">in</span> <span class="n">hits</span><span class="p">:</span> <span class="c1"># As chaves são os elementos do primeiro grupo (meteoros) que colidiram com alguma bala</span>
                <span class="c1"># O meteoro e destruido e precisa ser recriado</span>
                <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;destroy_sound&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">play</span><span class="p">()</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">Meteor</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span>
                <span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
                <span class="n">all_meteors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

                <span class="c1"># No lugar do meteoro antigo, adicionar uma explosão.</span>
                <span class="n">explosao</span> <span class="o">=</span> <span class="n">Explosion</span><span class="p">(</span><span class="n">meteor</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">center</span><span class="p">,</span> <span class="n">assets</span><span class="p">)</span>
                <span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">explosao</span><span class="p">)</span>

                <span class="c1"># Ganhou pontos!</span>
                <span class="n">score</span> <span class="o">+=</span> <span class="mi">100</span>
                <span class="k">if</span> <span class="n">score</span> <span class="o">%</span> <span class="mi">1000</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">lives</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># Verifica se houve colisão entre nave e meteoro</span>
            <span class="n">hits</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">spritecollide</span><span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="n">all_meteors</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">collide_mask</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hits</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># Toca o som da colisão</span>
                <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;boom_sound&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">play</span><span class="p">()</span>
                <span class="n">player</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
                <span class="n">lives</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="n">explosao</span> <span class="o">=</span> <span class="n">Explosion</span><span class="p">(</span><span class="n">player</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">center</span><span class="p">,</span> <span class="n">assets</span><span class="p">)</span>
                <span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">explosao</span><span class="p">)</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">EXPLODING</span>
                <span class="n">keys_down</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">explosion_tick</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span>
                <span class="n">explosion_duration</span> <span class="o">=</span> <span class="n">explosao</span><span class="o">.</span><span class="n">frame_ticks</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">explosao</span><span class="o">.</span><span class="n">explosion_anim</span><span class="p">)</span> <span class="o">+</span> <span class="mi">400</span>
        <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="n">EXPLODING</span><span class="p">:</span>
            <span class="n">now</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">now</span> <span class="o">-</span> <span class="n">explosion_tick</span> <span class="o">&gt;</span> <span class="n">explosion_duration</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">lives</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">state</span> <span class="o">=</span> <span class="n">DONE</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">state</span> <span class="o">=</span> <span class="n">PLAYING</span>
                    <span class="n">player</span> <span class="o">=</span> <span class="n">Ship</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="n">assets</span><span class="p">)</span>
                    <span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">player</span><span class="p">)</span>

        <span class="c1"># ----- Gera saídas</span>
        <span class="n">window</span><span class="o">.</span><span class="n">fill</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>  <span class="c1"># Preenche com a cor branca</span>
        <span class="n">window</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">assets</span><span class="p">[</span><span class="s1">&#39;background&#39;</span><span class="p">],</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="c1"># Desenhando meteoros</span>
        <span class="n">all_sprites</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>

        <span class="c1"># Desenhando o score</span>
        <span class="n">text_surface</span> <span class="o">=</span> <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;score_font&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:08d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">score</span><span class="p">),</span> <span class="kc">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">text_rect</span> <span class="o">=</span> <span class="n">text_surface</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
        <span class="n">text_rect</span><span class="o">.</span><span class="n">midtop</span> <span class="o">=</span> <span class="p">(</span><span class="n">WIDTH</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">10</span><span class="p">)</span>
        <span class="n">window</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">text_surface</span><span class="p">,</span> <span class="n">text_rect</span><span class="p">)</span>

        <span class="c1"># Desenhando as vidas</span>
        <span class="n">text_surface</span> <span class="o">=</span> <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;score_font&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">9829</span><span class="p">)</span> <span class="o">*</span> <span class="n">lives</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">text_rect</span> <span class="o">=</span> <span class="n">text_surface</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
        <span class="n">text_rect</span><span class="o">.</span><span class="n">bottomleft</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">HEIGHT</span> <span class="o">-</span> <span class="mi">10</span><span class="p">)</span>
        <span class="n">window</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">text_surface</span><span class="p">,</span> <span class="n">text_rect</span><span class="p">)</span>

        <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>  <span class="c1"># Mostra o novo frame para o jogador</span>

<span class="n">game_screen</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>

<span class="c1"># ===== Finalização =====</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>  <span class="c1"># Função do PyGame que finaliza os recursos utilizados</span>
</code></pre></div>
</td></tr></table>

</details>
<ul>
<li>Linhas 22 a 46: função que carrega os assets. É exatamente o mesmo código de antes, mas agora dentro de uma função;</li>
<li>Linhas 192 a 320: função que executa o loop principal. É exatamente o mesmo código de antes, mas agora dentro de uma função.</li>
</ul>
<h2 id="separando-o-codigo-em-arquivos-diferentes">Separando o código em arquivos diferentes<a class="headerlink" href="#separando-o-codigo-em-arquivos-diferentes" title="Permanent link">&para;</a></h2>
<p>Abra o arquivo <code class="highlight"><span class="n">jogo_21</span><span class="o">.</span><span class="n">py</span></code>. Onde está todo aquele código? O código do arquivo <code class="highlight"><span class="n">jogo_20</span><span class="o">.</span><span class="n">py</span></code> foi separado em 5 arquivos:</p>
<ul>
<li><code class="highlight"><span class="n">jogo_21</span><span class="o">.</span><span class="n">py</span></code> - possui apenas a lógica mais geral do jogo: inicializa o pygame, chama a tela do jogo e finaliza o pygame;</li>
</ul>
<details class="cite"><summary><code>referencia/jogo_v21.py</code></summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># ===== Inicialização =====</span>
<span class="c1"># ----- Importa e inicia pacotes</span>
<span class="kn">import</span> <span class="nn">pygame</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">config</span> <span class="kn">import</span> <span class="n">WIDTH</span><span class="p">,</span> <span class="n">HEIGHT</span>
<span class="kn">from</span> <span class="nn">game_screen</span> <span class="kn">import</span> <span class="n">game_screen</span>


<span class="n">pygame</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>

<span class="c1"># ----- Gera tela principal</span>
<span class="n">window</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_mode</span><span class="p">((</span><span class="n">WIDTH</span><span class="p">,</span> <span class="n">HEIGHT</span><span class="p">))</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s1">&#39;Navinha&#39;</span><span class="p">)</span>

<span class="n">game_screen</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>

<span class="c1"># ===== Finalização =====</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>  <span class="c1"># Função do PyGame que finaliza os recursos utilizados</span>
</code></pre></div>
</td></tr></table>

</details>
<ul>
<li><code class="highlight"><span class="n">game_screen</span><span class="o">.</span><span class="n">py</span></code> - função com o loop principal do jogo;</li>
</ul>
<details class="cite"><summary><code>referencia/game_screen.py</code></summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pygame</span>
<span class="kn">from</span> <span class="nn">config</span> <span class="kn">import</span> <span class="n">FPS</span><span class="p">,</span> <span class="n">WIDTH</span><span class="p">,</span> <span class="n">HEIGHT</span><span class="p">,</span> <span class="n">BLACK</span><span class="p">,</span> <span class="n">YELLOW</span><span class="p">,</span> <span class="n">RED</span>
<span class="kn">from</span> <span class="nn">assets</span> <span class="kn">import</span> <span class="n">load_assets</span><span class="p">,</span> <span class="n">DESTROY_SOUND</span><span class="p">,</span> <span class="n">BOOM_SOUND</span><span class="p">,</span> <span class="n">BACKGROUND</span><span class="p">,</span> <span class="n">SCORE_FONT</span>
<span class="kn">from</span> <span class="nn">sprites</span> <span class="kn">import</span> <span class="n">Ship</span><span class="p">,</span> <span class="n">Meteor</span><span class="p">,</span> <span class="n">Bullet</span><span class="p">,</span> <span class="n">Explosion</span>


<span class="k">def</span> <span class="nf">game_screen</span><span class="p">(</span><span class="n">window</span><span class="p">):</span>
    <span class="c1"># Variável para o ajuste de velocidade</span>
    <span class="n">clock</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">Clock</span><span class="p">()</span>

    <span class="n">assets</span> <span class="o">=</span> <span class="n">load_assets</span><span class="p">()</span>

    <span class="c1"># Criando um grupo de meteoros</span>
    <span class="n">all_sprites</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Group</span><span class="p">()</span>
    <span class="n">all_meteors</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Group</span><span class="p">()</span>
    <span class="n">all_bullets</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Group</span><span class="p">()</span>
    <span class="n">groups</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">groups</span><span class="p">[</span><span class="s1">&#39;all_sprites&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_sprites</span>
    <span class="n">groups</span><span class="p">[</span><span class="s1">&#39;all_meteors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_meteors</span>
    <span class="n">groups</span><span class="p">[</span><span class="s1">&#39;all_bullets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_bullets</span>

    <span class="c1"># Criando o jogador</span>
    <span class="n">player</span> <span class="o">=</span> <span class="n">Ship</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="n">assets</span><span class="p">)</span>
    <span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">player</span><span class="p">)</span>
    <span class="c1"># Criando os meteoros</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
        <span class="n">meteor</span> <span class="o">=</span> <span class="n">Meteor</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span>
        <span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">meteor</span><span class="p">)</span>
        <span class="n">all_meteors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">meteor</span><span class="p">)</span>

    <span class="n">DONE</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">PLAYING</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">EXPLODING</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">PLAYING</span>

    <span class="n">keys_down</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">lives</span> <span class="o">=</span> <span class="mi">3</span>

    <span class="c1"># ===== Loop principal =====</span>
    <span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">music</span><span class="o">.</span><span class="n">play</span><span class="p">(</span><span class="n">loops</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">state</span> <span class="o">!=</span> <span class="n">DONE</span><span class="p">:</span>
        <span class="n">clock</span><span class="o">.</span><span class="n">tick</span><span class="p">(</span><span class="n">FPS</span><span class="p">)</span>

        <span class="c1"># ----- Trata eventos</span>
        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">pygame</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
            <span class="c1"># ----- Verifica consequências</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">QUIT</span><span class="p">:</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">DONE</span>
            <span class="c1"># Só verifica o teclado se está no estado de jogo</span>
            <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">PLAYING</span><span class="p">:</span>
                <span class="c1"># Verifica se apertou alguma tecla.</span>
                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">KEYDOWN</span><span class="p">:</span>
                    <span class="c1"># Dependendo da tecla, altera a velocidade.</span>
                    <span class="n">keys_down</span><span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_LEFT</span><span class="p">:</span>
                        <span class="n">player</span><span class="o">.</span><span class="n">speedx</span> <span class="o">-=</span> <span class="mi">8</span>
                    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_RIGHT</span><span class="p">:</span>
                        <span class="n">player</span><span class="o">.</span><span class="n">speedx</span> <span class="o">+=</span> <span class="mi">8</span>
                    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_SPACE</span><span class="p">:</span>
                        <span class="n">player</span><span class="o">.</span><span class="n">shoot</span><span class="p">()</span>
                <span class="c1"># Verifica se soltou alguma tecla.</span>
                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">KEYUP</span><span class="p">:</span>
                    <span class="c1"># Dependendo da tecla, altera a velocidade.</span>
                    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="n">keys_down</span> <span class="ow">and</span> <span class="n">keys_down</span><span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_LEFT</span><span class="p">:</span>
                            <span class="n">player</span><span class="o">.</span><span class="n">speedx</span> <span class="o">+=</span> <span class="mi">8</span>
                        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_RIGHT</span><span class="p">:</span>
                            <span class="n">player</span><span class="o">.</span><span class="n">speedx</span> <span class="o">-=</span> <span class="mi">8</span>

        <span class="c1"># ----- Atualiza estado do jogo</span>
        <span class="c1"># Atualizando a posição dos meteoros</span>
        <span class="n">all_sprites</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">PLAYING</span><span class="p">:</span>
            <span class="c1"># Verifica se houve colisão entre tiro e meteoro</span>
            <span class="n">hits</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">groupcollide</span><span class="p">(</span><span class="n">all_meteors</span><span class="p">,</span> <span class="n">all_bullets</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">collide_mask</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">meteor</span> <span class="ow">in</span> <span class="n">hits</span><span class="p">:</span> <span class="c1"># As chaves são os elementos do primeiro grupo (meteoros) que colidiram com alguma bala</span>
                <span class="c1"># O meteoro e destruido e precisa ser recriado</span>
                <span class="n">assets</span><span class="p">[</span><span class="n">DESTROY_SOUND</span><span class="p">]</span><span class="o">.</span><span class="n">play</span><span class="p">()</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">Meteor</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span>
                <span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
                <span class="n">all_meteors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

                <span class="c1"># No lugar do meteoro antigo, adicionar uma explosão.</span>
                <span class="n">explosao</span> <span class="o">=</span> <span class="n">Explosion</span><span class="p">(</span><span class="n">meteor</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">center</span><span class="p">,</span> <span class="n">assets</span><span class="p">)</span>
                <span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">explosao</span><span class="p">)</span>

                <span class="c1"># Ganhou pontos!</span>
                <span class="n">score</span> <span class="o">+=</span> <span class="mi">100</span>
                <span class="k">if</span> <span class="n">score</span> <span class="o">%</span> <span class="mi">1000</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">lives</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># Verifica se houve colisão entre nave e meteoro</span>
            <span class="n">hits</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">spritecollide</span><span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="n">all_meteors</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">collide_mask</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hits</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># Toca o som da colisão</span>
                <span class="n">assets</span><span class="p">[</span><span class="n">BOOM_SOUND</span><span class="p">]</span><span class="o">.</span><span class="n">play</span><span class="p">()</span>
                <span class="n">player</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
                <span class="n">lives</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="n">explosao</span> <span class="o">=</span> <span class="n">Explosion</span><span class="p">(</span><span class="n">player</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">center</span><span class="p">,</span> <span class="n">assets</span><span class="p">)</span>
                <span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">explosao</span><span class="p">)</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">EXPLODING</span>
                <span class="n">keys_down</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">explosion_tick</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span>
                <span class="n">explosion_duration</span> <span class="o">=</span> <span class="n">explosao</span><span class="o">.</span><span class="n">frame_ticks</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">explosao</span><span class="o">.</span><span class="n">explosion_anim</span><span class="p">)</span> <span class="o">+</span> <span class="mi">400</span>
        <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="n">EXPLODING</span><span class="p">:</span>
            <span class="n">now</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">now</span> <span class="o">-</span> <span class="n">explosion_tick</span> <span class="o">&gt;</span> <span class="n">explosion_duration</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">lives</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">state</span> <span class="o">=</span> <span class="n">DONE</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">state</span> <span class="o">=</span> <span class="n">PLAYING</span>
                    <span class="n">player</span> <span class="o">=</span> <span class="n">Ship</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="n">assets</span><span class="p">)</span>
                    <span class="n">all_sprites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">player</span><span class="p">)</span>

        <span class="c1"># ----- Gera saídas</span>
        <span class="n">window</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">BLACK</span><span class="p">)</span>  <span class="c1"># Preenche com a cor branca</span>
        <span class="n">window</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">assets</span><span class="p">[</span><span class="n">BACKGROUND</span><span class="p">],</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="c1"># Desenhando meteoros</span>
        <span class="n">all_sprites</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>

        <span class="c1"># Desenhando o score</span>
        <span class="n">text_surface</span> <span class="o">=</span> <span class="n">assets</span><span class="p">[</span><span class="n">SCORE_FONT</span><span class="p">]</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:08d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">score</span><span class="p">),</span> <span class="kc">True</span><span class="p">,</span> <span class="n">YELLOW</span><span class="p">)</span>
        <span class="n">text_rect</span> <span class="o">=</span> <span class="n">text_surface</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
        <span class="n">text_rect</span><span class="o">.</span><span class="n">midtop</span> <span class="o">=</span> <span class="p">(</span><span class="n">WIDTH</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">10</span><span class="p">)</span>
        <span class="n">window</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">text_surface</span><span class="p">,</span> <span class="n">text_rect</span><span class="p">)</span>

        <span class="c1"># Desenhando as vidas</span>
        <span class="n">text_surface</span> <span class="o">=</span> <span class="n">assets</span><span class="p">[</span><span class="n">SCORE_FONT</span><span class="p">]</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">9829</span><span class="p">)</span> <span class="o">*</span> <span class="n">lives</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">RED</span><span class="p">)</span>
        <span class="n">text_rect</span> <span class="o">=</span> <span class="n">text_surface</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
        <span class="n">text_rect</span><span class="o">.</span><span class="n">bottomleft</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">HEIGHT</span> <span class="o">-</span> <span class="mi">10</span><span class="p">)</span>
        <span class="n">window</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">text_surface</span><span class="p">,</span> <span class="n">text_rect</span><span class="p">)</span>

        <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>  <span class="c1"># Mostra o novo frame para o jogador</span>
</code></pre></div>
</td></tr></table>

</details>
<ul>
<li><code class="highlight"><span class="n">sprites</span><span class="o">.</span><span class="n">py</span></code> - definição das classes do jogo;</li>
</ul>
<details class="cite"><summary><code>referencia/sprites.py</code></summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">pygame</span>
<span class="kn">from</span> <span class="nn">config</span> <span class="kn">import</span> <span class="n">WIDTH</span><span class="p">,</span> <span class="n">HEIGHT</span><span class="p">,</span> <span class="n">METEOR_WIDTH</span><span class="p">,</span> <span class="n">METEOR_HEIGHT</span><span class="p">,</span> <span class="n">SHIP_WIDTH</span><span class="p">,</span> <span class="n">SHIP_HEIGHT</span>
<span class="kn">from</span> <span class="nn">assets</span> <span class="kn">import</span> <span class="n">SHIP_IMG</span><span class="p">,</span> <span class="n">PEW_SOUND</span><span class="p">,</span> <span class="n">METEOR_IMG</span><span class="p">,</span> <span class="n">BULLET_IMG</span><span class="p">,</span> <span class="n">EXPLOSION_ANIM</span>


<span class="k">class</span> <span class="nc">Ship</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">assets</span><span class="p">):</span>
        <span class="c1"># Construtor da classe mãe (Sprite).</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">assets</span><span class="p">[</span><span class="n">SHIP_IMG</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">from_surface</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">centerx</span> <span class="o">=</span> <span class="n">WIDTH</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">bottom</span> <span class="o">=</span> <span class="n">HEIGHT</span> <span class="o">-</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groups</span> <span class="o">=</span> <span class="n">groups</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assets</span> <span class="o">=</span> <span class="n">assets</span>

        <span class="c1"># Só será possível atirar uma vez a cada 500 milissegundos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_shot</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shoot_ticks</span> <span class="o">=</span> <span class="mi">500</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Atualização da posição da nave</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span>

        <span class="c1"># Mantem dentro da tela</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">right</span> <span class="o">&gt;</span> <span class="n">WIDTH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">WIDTH</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">left</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">shoot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Verifica se pode atirar</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span>
        <span class="c1"># Verifica quantos ticks se passaram desde o último tiro.</span>
        <span class="n">elapsed_ticks</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_shot</span>

        <span class="c1"># Se já pode atirar novamente...</span>
        <span class="k">if</span> <span class="n">elapsed_ticks</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">shoot_ticks</span><span class="p">:</span>
            <span class="c1"># Marca o tick da nova imagem.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_shot</span> <span class="o">=</span> <span class="n">now</span>
            <span class="c1"># A nova bala vai ser criada logo acima e no centro horizontal da nave</span>
            <span class="n">new_bullet</span> <span class="o">=</span> <span class="n">Bullet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assets</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">centerx</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="s1">&#39;all_sprites&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_bullet</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="s1">&#39;all_bullets&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_bullet</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assets</span><span class="p">[</span><span class="n">PEW_SOUND</span><span class="p">]</span><span class="o">.</span><span class="n">play</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Meteor</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">assets</span><span class="p">):</span>
        <span class="c1"># Construtor da classe mãe (Sprite).</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">assets</span><span class="p">[</span><span class="n">METEOR_IMG</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">from_surface</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">WIDTH</span><span class="o">-</span><span class="n">METEOR_WIDTH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="n">METEOR_HEIGHT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Atualizando a posição do meteoro</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span>
        <span class="c1"># Se o meteoro passar do final da tela, volta para cima e sorteia</span>
        <span class="c1"># novas posições e velocidades</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">top</span> <span class="o">&gt;</span> <span class="n">HEIGHT</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">right</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">left</span> <span class="o">&gt;</span> <span class="n">WIDTH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">WIDTH</span><span class="o">-</span><span class="n">METEOR_WIDTH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="n">METEOR_HEIGHT</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">speedx</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>

<span class="c1"># Classe Bullet que representa os tiros</span>
<span class="k">class</span> <span class="nc">Bullet</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="c1"># Construtor da classe.</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">assets</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">centerx</span><span class="p">):</span>
        <span class="c1"># Construtor da classe mãe (Sprite).</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">assets</span><span class="p">[</span><span class="n">BULLET_IMG</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">from_surface</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>

        <span class="c1"># Coloca no lugar inicial definido em x, y do constutor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">centerx</span> <span class="o">=</span> <span class="n">centerx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">bottom</span> <span class="o">=</span> <span class="n">bottom</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span>  <span class="c1"># Velocidade fixa para cima</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># A bala só se move no eixo y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedy</span>

        <span class="c1"># Se o tiro passar do inicio da tela, morre.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">bottom</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>

<span class="c1"># Classe que representa uma explosão de meteoro</span>
<span class="k">class</span> <span class="nc">Explosion</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="c1"># Construtor da classe.</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">assets</span><span class="p">):</span>
        <span class="c1"># Construtor da classe mãe (Sprite).</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Armazena a animação de explosão</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">explosion_anim</span> <span class="o">=</span> <span class="n">assets</span><span class="p">[</span><span class="n">EXPLOSION_ANIM</span><span class="p">]</span>

        <span class="c1"># Inicia o processo de animação colocando a primeira imagem na tela.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Armazena o índice atual na animação</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">explosion_anim</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">]</span>  <span class="c1"># Pega a primeira imagem</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">center</span>  <span class="c1"># Posiciona o centro da imagem</span>

        <span class="c1"># Guarda o tick da primeira imagem, ou seja, o momento em que a imagem foi mostrada</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_update</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span>

        <span class="c1"># Controle de ticks de animação: troca de imagem a cada self.frame_ticks milissegundos.</span>
        <span class="c1"># Quando pygame.time.get_ticks() - self.last_update &gt; self.frame_ticks a</span>
        <span class="c1"># próxima imagem da animação será mostrada</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame_ticks</span> <span class="o">=</span> <span class="mi">50</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Verifica o tick atual.</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span>
        <span class="c1"># Verifica quantos ticks se passaram desde a ultima mudança de frame.</span>
        <span class="n">elapsed_ticks</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_update</span>

        <span class="c1"># Se já está na hora de mudar de imagem...</span>
        <span class="k">if</span> <span class="n">elapsed_ticks</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_ticks</span><span class="p">:</span>
            <span class="c1"># Marca o tick da nova imagem.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_update</span> <span class="o">=</span> <span class="n">now</span>

            <span class="c1"># Avança um quadro.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># Verifica se já chegou no final da animação.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">explosion_anim</span><span class="p">):</span>
                <span class="c1"># Se sim, tchau explosão!</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Se ainda não chegou ao fim da explosão, troca de imagem.</span>
                <span class="n">center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">center</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">explosion_anim</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">center</span>
</code></pre></div>
</td></tr></table>

</details>
<ul>
<li><code class="highlight"><span class="n">assets</span><span class="o">.</span><span class="n">py</span></code> - função de carregamento de assets do jogo;</li>
</ul>
<details class="cite"><summary><code>referencia/assets.py</code></summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pygame</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">config</span> <span class="kn">import</span> <span class="n">METEOR_WIDTH</span><span class="p">,</span> <span class="n">METEOR_HEIGHT</span><span class="p">,</span> <span class="n">SHIP_WIDTH</span><span class="p">,</span> <span class="n">SHIP_HEIGHT</span><span class="p">,</span> <span class="n">IMG_DIR</span><span class="p">,</span> <span class="n">SND_DIR</span><span class="p">,</span> <span class="n">FNT_DIR</span>


<span class="n">BACKGROUND</span> <span class="o">=</span> <span class="s1">&#39;background&#39;</span>
<span class="n">METEOR_IMG</span> <span class="o">=</span> <span class="s1">&#39;meteor_img&#39;</span>
<span class="n">METEOR_IMG</span> <span class="o">=</span> <span class="s1">&#39;meteor_img&#39;</span>
<span class="n">SHIP_IMG</span> <span class="o">=</span> <span class="s1">&#39;ship_img&#39;</span>
<span class="n">SHIP_IMG</span> <span class="o">=</span> <span class="s1">&#39;ship_img&#39;</span>
<span class="n">BULLET_IMG</span> <span class="o">=</span> <span class="s1">&#39;bullet_img&#39;</span>
<span class="n">EXPLOSION_ANIM</span> <span class="o">=</span> <span class="s1">&#39;explosion_anim&#39;</span>
<span class="n">SCORE_FONT</span> <span class="o">=</span> <span class="s1">&#39;score_font&#39;</span>
<span class="n">BOOM_SOUND</span> <span class="o">=</span> <span class="s1">&#39;boom_sound&#39;</span>
<span class="n">DESTROY_SOUND</span> <span class="o">=</span> <span class="s1">&#39;destroy_sound&#39;</span>
<span class="n">PEW_SOUND</span> <span class="o">=</span> <span class="s1">&#39;pew_sound&#39;</span>


<span class="k">def</span> <span class="nf">load_assets</span><span class="p">():</span>
    <span class="n">assets</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">assets</span><span class="p">[</span><span class="n">BACKGROUND</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">IMG_DIR</span><span class="p">,</span> <span class="s1">&#39;starfield.png&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span>
    <span class="n">assets</span><span class="p">[</span><span class="n">METEOR_IMG</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">IMG_DIR</span><span class="p">,</span> <span class="s1">&#39;meteorBrown_med1.png&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">convert_alpha</span><span class="p">()</span>
    <span class="n">assets</span><span class="p">[</span><span class="n">METEOR_IMG</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">assets</span><span class="p">[</span><span class="s1">&#39;meteor_img&#39;</span><span class="p">],</span> <span class="p">(</span><span class="n">METEOR_WIDTH</span><span class="p">,</span> <span class="n">METEOR_HEIGHT</span><span class="p">))</span>
    <span class="n">assets</span><span class="p">[</span><span class="n">SHIP_IMG</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">IMG_DIR</span><span class="p">,</span> <span class="s1">&#39;playerShip1_orange.png&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">convert_alpha</span><span class="p">()</span>
    <span class="n">assets</span><span class="p">[</span><span class="n">SHIP_IMG</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">assets</span><span class="p">[</span><span class="s1">&#39;ship_img&#39;</span><span class="p">],</span> <span class="p">(</span><span class="n">SHIP_WIDTH</span><span class="p">,</span> <span class="n">SHIP_HEIGHT</span><span class="p">))</span>
    <span class="n">assets</span><span class="p">[</span><span class="n">BULLET_IMG</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">IMG_DIR</span><span class="p">,</span> <span class="s1">&#39;laserRed16.png&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">convert_alpha</span><span class="p">()</span>
    <span class="n">explosion_anim</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">):</span>
        <span class="c1"># Os arquivos de animação são numerados de 00 a 08</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">IMG_DIR</span><span class="p">,</span> <span class="s1">&#39;regularExplosion0</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">))</span>
        <span class="n">explosion_anim</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="n">assets</span><span class="p">[</span><span class="n">EXPLOSION_ANIM</span><span class="p">]</span> <span class="o">=</span> <span class="n">explosion_anim</span>
    <span class="n">assets</span><span class="p">[</span><span class="n">SCORE_FONT</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">Font</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">FNT_DIR</span><span class="p">,</span> <span class="s1">&#39;PressStart2P.ttf&#39;</span><span class="p">),</span> <span class="mi">28</span><span class="p">)</span>

    <span class="c1"># Carrega os sons do jogo</span>
    <span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">music</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SND_DIR</span><span class="p">,</span> <span class="s1">&#39;tgfcoder-FrozenJam-SeamlessLoop.ogg&#39;</span><span class="p">))</span>
    <span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">music</span><span class="o">.</span><span class="n">set_volume</span><span class="p">(</span><span class="mf">0.4</span><span class="p">)</span>
    <span class="n">assets</span><span class="p">[</span><span class="n">BOOM_SOUND</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">Sound</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SND_DIR</span><span class="p">,</span> <span class="s1">&#39;expl3.wav&#39;</span><span class="p">))</span>
    <span class="n">assets</span><span class="p">[</span><span class="n">DESTROY_SOUND</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">Sound</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SND_DIR</span><span class="p">,</span> <span class="s1">&#39;expl6.wav&#39;</span><span class="p">))</span>
    <span class="n">assets</span><span class="p">[</span><span class="n">PEW_SOUND</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">Sound</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SND_DIR</span><span class="p">,</span> <span class="s1">&#39;pew.wav&#39;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">assets</span>
</code></pre></div>
</td></tr></table>

</details>
<ul>
<li><code class="highlight"><span class="n">config</span><span class="o">.</span><span class="n">py</span></code>- constantes.</li>
</ul>
<details class="cite"><summary><code>referencia/config.py</code></summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">path</span>

<span class="c1"># Estabelece a pasta que contem as figuras e sons.</span>
<span class="n">IMG_DIR</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s1">&#39;assets&#39;</span><span class="p">,</span> <span class="s1">&#39;img&#39;</span><span class="p">)</span>
<span class="n">SND_DIR</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s1">&#39;assets&#39;</span><span class="p">,</span> <span class="s1">&#39;snd&#39;</span><span class="p">)</span>
<span class="n">FNT_DIR</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s1">&#39;assets&#39;</span><span class="p">,</span> <span class="s1">&#39;font&#39;</span><span class="p">)</span>

<span class="c1"># Dados gerais do jogo.</span>
<span class="n">WIDTH</span> <span class="o">=</span> <span class="mi">480</span> <span class="c1"># Largura da tela</span>
<span class="n">HEIGHT</span> <span class="o">=</span> <span class="mi">600</span> <span class="c1"># Altura da tela</span>
<span class="n">FPS</span> <span class="o">=</span> <span class="mi">60</span> <span class="c1"># Frames por segundo</span>

<span class="c1"># Define tamanhos</span>
<span class="n">METEOR_WIDTH</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">METEOR_HEIGHT</span> <span class="o">=</span> <span class="mi">38</span>
<span class="n">SHIP_WIDTH</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">SHIP_HEIGHT</span> <span class="o">=</span> <span class="mi">38</span>

<span class="c1"># Define algumas variáveis com as cores básicas</span>
<span class="n">WHITE</span> <span class="o">=</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
<span class="n">BLACK</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">RED</span> <span class="o">=</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">GREEN</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">BLUE</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
<span class="n">YELLOW</span> <span class="o">=</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># Estados para controle do fluxo da aplicação</span>
<span class="n">INIT</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">GAME</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">QUIT</span> <span class="o">=</span> <span class="mi">2</span>
</code></pre></div>
</td></tr></table>

</details>
<p>Lembra quando precisamos de uma função da biblioteca de matemática e damos um <code class="highlight"><span class="kn">import</span> <span class="nn">math</span></code>? Quando queremos utilizar um valor ou função que foi definida em outro arquivo também usamos o <code class="highlight"><span class="kn">import</span></code>. Essa divisão em arquivos facilita o desenvolvimento concorrente do jogo pelos membros da equipe.</p>
<h2 id="adicionando-uma-tela-inicial">Adicionando uma tela inicial<a class="headerlink" href="#adicionando-uma-tela-inicial" title="Permanent link">&para;</a></h2>
<p>Essa refatoração toda não foi em vão. No <code class="highlight"><span class="n">jogo_v22</span><span class="o">.</span><span class="n">py</span></code> vemos como essa refatoração ajudou a desenvolver uma nova tela de jogo! Vemos também o truque da máquina de estados para organizar a aplicação principal. Agora não temos muitas, linhas, mas as mudanças estão nas linhas 17 a 24.</p>
<details class="cite"><summary><code>referencia/jogo_v22.py</code></summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># ===== Inicialização =====</span>
<span class="c1"># ----- Importa e inicia pacotes</span>
<span class="kn">import</span> <span class="nn">pygame</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">config</span> <span class="kn">import</span> <span class="n">WIDTH</span><span class="p">,</span> <span class="n">HEIGHT</span><span class="p">,</span> <span class="n">INIT</span><span class="p">,</span> <span class="n">GAME</span><span class="p">,</span> <span class="n">QUIT</span>
<span class="kn">from</span> <span class="nn">init_screen</span> <span class="kn">import</span> <span class="n">init_screen</span>
<span class="kn">from</span> <span class="nn">game_screen</span> <span class="kn">import</span> <span class="n">game_screen</span>


<span class="n">pygame</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>

<span class="c1"># ----- Gera tela principal</span>
<span class="n">window</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_mode</span><span class="p">((</span><span class="n">WIDTH</span><span class="p">,</span> <span class="n">HEIGHT</span><span class="p">))</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s1">&#39;Navinha&#39;</span><span class="p">)</span>

<span class="n">state</span> <span class="o">=</span> <span class="n">INIT</span>
<span class="k">while</span> <span class="n">state</span> <span class="o">!=</span> <span class="n">QUIT</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">INIT</span><span class="p">:</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">init_screen</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="n">GAME</span><span class="p">:</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">game_screen</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">QUIT</span>

<span class="c1"># ===== Finalização =====</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>  <span class="c1"># Função do PyGame que finaliza os recursos utilizados</span>
</code></pre></div>
</td></tr></table>

</details>
<div class="admonition example">
<h3 id="exercicio-19">EXERCÍCIO 19<a class="headerlink" href="#exercicio-19" title="Permanent link">&para;</a></h3>
<p>Modifique o <code class="highlight"><span class="n">jogo_v22</span><span class="o">.</span><span class="n">py</span></code> para adicionar uma tela de game over.</p>
</div>
<h1 id="referencias">Referências<a class="headerlink" href="#referencias" title="Permanent link">&para;</a></h1>
<ul>
<li><a href="https://www.pygame.org/docs/">https://www.pygame.org/docs/</a></li>
<li><a href="http://kidscancode.org/blog/2016/08/pygame_shmup_part_1/">http://kidscancode.org/blog/2016/08/pygame_shmup_part_1/</a></li>
</ul>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../09-arquivos/" title="09 - Arquivos" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                09 - Arquivos
              </div>
            </div>
          </a>
        
        
          <a href="../../tutoriais/terminal-win/" title="Windows" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Windows
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.592d4e23.min.js"></script>
      <script src="../../assets/javascripts/bundle.806ca5c4.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.01088dc6.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
      
        <script src="../../translate-admonitions.js"></script>
      
    
  </body>
</html>